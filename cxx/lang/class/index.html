<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Overview: The Class Construct | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=active>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=hoverable>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=hoverable>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/cxx/>C/C++</a>/<a href=/cxx/lang/>C++ Language</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>Overview: The Class Construct</h1><p class=aux-text style=margin-top:0>Published at: October 6, 2023
| Last modification: July 3, 2024</p><div style=line-height:2em><span class="page-tag tag-cxx">C++</span>
<span class="page-tag tag-programming-language">Programming Language</span></div></div><div><h2 id=constructor>constructor</h2><p>Within a class member specification, the declaration of a non-static, non-template member function is a constructor declaration if</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>S</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>  S();              <span style=color:#75715e>// declares the constructor
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e></span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>S<span style=color:#f92672>::</span>S() { }          <span style=color:#75715e>// defines the constructor
</span></span></span></code></pre></div><button>copy</button></div><p>The constructor is considered a function with no name.</p><h2 id=smf>Special Member Functions (SMF)</h2><p>(c++20 11.4.3.1) A class have</p><ul><li>at most 1 default constructor,</li><li>at most 1 copy constructor,</li><li>at most 1 move constructor,</li><li>at most 1 copy assignment operator,</li><li>at most 1 move assignment operator, and</li><li>prospective destructors</li></ul><p>all of which are known as <em>special member functions</em> of that class.</p><h2 id=glossary>glossary</h2><p><strong>user-declared</strong>: A SMF is said to be user-declared if the user types an constructor declaration in the program source.</p><h4 id=default-ctor>default ctor</h4><p>A default ctor is a ctor whose every parameter has a default argument, including one with an empty parameter list.</p><p>If there is not any user-declared ctor (i.e. no declaration of ad-hoc ctor, no copy, no move ctor), the compiler treats it as if there is a declaration:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>class</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#75715e>/*non-explicit*/</span> ClassName() <span style=color:#f92672>=</span> <span style=color:#66d9ef>default</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}</span></span></code></pre></div><button>copy</button></div><p>This declaration can&rsquo;t have corresponding implementation in the user&rsquo;s source.</p><h4 id=copy-ctor--move-ctor>copy ctor / move ctor</h4><p>For <code>class X</code>, its copy / move ctor is a non-template ctor</p><ul><li>whose first parameter is of type (possibly cv-qualified) lvalue-reference / rvalue-reference <code>X</code> , i.e <code>(cv) X&</code> / <code>(cv) X&&</code>, and</li><li>all other parameters, if any, has a default argument.</li></ul><h4 id=copy--move-assignment-operator>copy / move assignment operator</h4><p>For <code>class X</code>, its copy / move assignment operator <code>X::operator=</code> is a non-template non-static member function
<em>with exactly 1 parameter</em> of type (possibly cv-qualified) lvalue-reference / rvalue-reference to <code>X</code>, i.e <code>(cv) X&</code> / <code>(cv) X&&</code>.</p><h4 id=destructor>destructor</h4><p>C++20 allows multiple destructors declaration <code>~T(void)</code> appeared in class body.
The main purpose is to allow different dtor implementations based on whether the class&rsquo;s template parameters satisfy some concept.</p><p>The good old <em>destructor</em> is now defined as the result of overload resolution with empty argument list.
If overload resolution failed (e.g. more/less than 1 pdtors survives), the program is ill-formed.</p><p><a href=https://stackoverflow.com/questions/14187006/is-calling-destructor-manually-always-a-sign-of-bad-design>Dtor can be called manually.</a></p><h2 id=compiler-generated-declaration--definition-of-special-member-functions>compiler-generated declaration & definition of special member functions</h2><p>C++ compiler needs to transfer legacy C <code>struct</code> into class system, as well as provides reasonable setup for simple data class.
Thus some default fallback must be provided for certain critical member functions.
The generation of declaration and definition happens during compilation of <em>every</em> translation unit that includes the class header file.</p><p>For <code>X</code> in (defctor, copy ctor, move ctor, <code>copy=</code>, and <code>move=</code>):</p><ul><li>Declaration of <code>X</code> is either<ul><li><em>implicitly-declared</em> (generated by compiler), or</li><li><em>user-declared</em> (user-written)</li></ul></li><li>Definition of <code>X</code> is one of<ul><li><em>user-defined</em> (literal function body)</li><li><em>explicitly-defaulted</em> (literal <code>=default</code>)</li><li><em>implicitly-defined</em> (compiler-generated blank definition)</li><li><em>deleted</em>, due to either<ul><li>an literal <code>=delete</code>, or</li><li>compiler-generated deleted definition</li></ul></li></ul></li></ul><p>Note that <code>user-declared</code> declaration and <code>user-defined</code> definition means each other. i.e. program is ill-formed if</p><ul><li>user doesn&rsquo;t provides an definition for the declaration he write; or</li><li>user provides an definition for the declaration generated by compiler.</li></ul><p>However, do use the right words for declaration when declaration only is of concern.
<code>cppreference.com</code> mix the usage and cause confusion. c++20 spec is more disciplined on dictioning.</p><table><thead><tr><th>SMF</th><th>form (<code>[]</code> means being conditional)</th><th>is <em>implicitly-declared</em> if &mldr;</th><th>has <em>deleted</em> definition if &mldr;</th></tr></thead><tbody><tr><td>defctor</td><td>(non-explicit) <code>[constexpr] inline public T::T() noexcept(true)</code></td><td>no user-declared ctor of any type is found.</td><td>1) has reference or <code>const</code> data member 2) &mldr;</td></tr><tr><td>copy ctor</td><td>(non-explicit) <code>[constexpr] inline public T::T([const] T&) noexcept(true)</code></td><td>no user-declared copy ctor is found.</td><td></td></tr><tr><td>move ctor</td><td>(non-explicit) <code>[constexpr] inline public T::T(T&&) noexcept(true)</code></td><td>none of user-declared 1) copy ctor, 2) move ctor, 3) <code>copy=</code> 4) <code>move=</code> 5) dtor, is found</td><td></td></tr><tr><td><code>copy=</code></td><td><code>[constexpr] inline public T& T::operator=([const] T&)</code></td><td>no user-declared <code>copy=</code> is found.</td><td></td></tr><tr><td><code>move=</code></td><td><code>[constexpr] inline public T& T::operator=(T&&)</code></td><td>none of user-declared 1) copy ctor, 2) move ctor, 3) <code>copy=</code> 4) <code>move=</code> 5) dtor, is found</td><td></td></tr><tr><td>1 pdtor</td><td><code>inline public ~T()</code></td><td>no user-declared prospective destructor is found</td><td></td></tr></tbody></table><h2 id=trivial-ness-of-special-member-functions>Trivial-ness of special member functions</h2><table><thead><tr><th>SMF</th><th>is <em>trivial</em>, if &mldr;</th><th>precisely, if &mldr;</th></tr></thead><tbody><tr><td>defctor</td><td>it&rsquo;s effective no-op</td><td></td></tr><tr><td>copy ctor</td><td>it simply copy every data member</td><td></td></tr><tr><td>move ctor</td><td></td><td></td></tr><tr><td><code>copy=</code></td><td>it simply copy every data member</td><td></td></tr><tr><td><code>move=</code></td><td></td><td></td></tr><tr><td>pdtor</td><td></td><td></td></tr></tbody></table><h2 id=inheritance-type>Inheritance Type</h2><ol><li>liskov doesn&rsquo;t work for protected / private inheritance.</li><li>public / protected members of private Base equivalently become private access inside Derived.</li><li>private members of Base always become inaccessible in Derived, regardless of inheritance type.</li></ol><h2 id=virtual-member-function--abstract-class>virtual member function & abstract class</h2><p>An abstract class is defined to be a class with 1 or more pure virtual member functions, either owned or inherited.</p><p>By the design of C++, the purpose of PVMF, as well as abstract class, is to force subclasses to override its PVMF with an implementation, with the side-effect of preventing itself and non-implementing derived class from being instantiated.</p><p>Such design leads to several consequences:</p><ul><li>One can&rsquo;t have abstract class without introducing PVMF.<ul><li>one way to prevent instantiation without PVMF is to make all ctors <code>protected</code></li><li>another way, suggested by scott (effective c++ 2005 item7), is to have pure virtual dtor, since abstract class is always meant to be polymorphism base class. However, when abstract class itself also owns resources to be cleaned, this might lead to over-complicated design.</li></ul></li><li>A class can provide implementation for its own PVMF, which will never be called unless subclass explicitly does so via <code>Base::Function(...)</code>.<ul><li>Not very common / useful, but base class can put some reusable logics / reasonable default here, accessible by all subclasses.</li><li>The class, including non-overrriding subclasses, are still abstract classes, thus can&rsquo;t be instantiated.</li><li>Again the purpose of PVMF is to force subclasses to override it. (well &mldr; Unfortunately ?) it can&rsquo;t prevent base class from providing an implementation.</li></ul></li></ul><h2 id=inherited-virtual-ness>inherited virtual-ness</h2><p>TLDR</p><ul><li>virtual-ness is inherited, for both member functions and destructor, regardless of the presence of <code>virtual</code> keyword when overriding. Do always keep it, for the sake of readability.</li><li>Maximize the use of c++11&rsquo;s <code>final</code> and <code>override</code>.</li></ul><p>The longer:</p><blockquote><p>A non-static member function is a virtual function if it is first declared with the keyword virtual or if it
overrides a virtual member function declared in a base class.
<cite>c++20 11.7.2.1</cite></p></blockquote><p>c++11 introduced a non-terminator <code>virt-specifier-seq</code> which expand to <code>final</code> or <code>override</code> or both in arbitrary order.
Using them allows inheritance problem to be detected at compilation time.</p><ul><li>Compiler complains if <code>override</code>-marked function doesn&rsquo;t really override.<ul><li>Explicit expression of intent.</li></ul></li><li>Compiler complains if <code>final</code>-marked function is overriden somewhere.<ul><li>Prior to this feature, standard c++ can&rsquo;t prevent further overriding in more derived class.</li></ul></li></ul><p>Problems are</p><ol><li>Inherited virtual-ness means c++ allows derived class to omit <code>virtual</code> keyword when overriding, which is horrible for readability;</li><li><code>final</code> and <code>override</code> are not mandatory; doesn&rsquo;t solve (1) from langauge level.</li></ol><p>It&rsquo;s impossible for new spec to fix these problems due to backward compatibility.
Compiler flags / code prettier that force <code>virt-specifier-seq</code> and <code>virtual</code> keyword is recommended.</p><h2 id=class-member-initialization>Class Member Initialization</h2><ol><li><p>If the constructor is for the most-derived class, virtual bases are initialized in the order in which they appear in depth-first left-to-right traversal of the base class declarations (left-to-right refers to the appearance in base-specifier lists)</p></li><li><p>Then, direct bases are initialized in left-to-right order as they appear in this class&rsquo;s base-specifier list</p></li><li><p>Then, on-static data members are initialized in the order of their declaration in the class definition, not of <code>member-init-list</code>:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#66d9ef>int</span> a;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#66d9ef>int</span> b;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    A(<span style=color:#66d9ef>int</span> x)<span style=color:#f92672>:</span> b(x), a(b){} <span style=color:#75715e>// warning: a(b) but b is not initializerd
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>B</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#66d9ef>int</span> b;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#66d9ef>int</span> a;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    B(<span style=color:#66d9ef>int</span> x)<span style=color:#f92672>:</span> a(b), b(x){} <span style=color:#75715e>// Okay
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#75715e></span>}</span></span></code></pre></div><button>copy</button></div><p>Always type the <code>member-init-list</code> in the identical order as declared members in the class body.</p></li><li><p>Finally, the body of the constructor is executed</p></li></ol><h2 id=rule-of-0><code>Rule of 0</code></h2><h3 id=tldr>TLDR</h3><p>Big 5: copy ctor, move ctor, copy assignment, move assignment, destructor</p><ul><li>Make a clear separation in mind between (1) resource-managing class, a.k.a (not precise, but) RAII class and (2) everything else (e.g. business related class)</li><li>(1) should having no more public APIs other than the big 5, optionally a raw resource getter, and an potentially-throwing <code>close()</code>. One seldom needs to write their own (1). STL containers and smart pointer with custom deleter should suffice. But rare cases like RAII wrapper around <code>std::FILE*</code> exists, and smart pointer can&rsquo;t satisfy exception handling.</li><li>In (2), Never write the big 5;</li></ul><h2 id=the-longer>The longer</h2><p>Modern C++ code should follows the ultimate <em>rule of zero</em>:</p><blockquote><p>Classes that have custom destructors, copy/move constructors or copy/move assignment operators should deal exclusively with ownership (which follows from the Single Responsibility Principle).</p><p>Other classes should not have custom destructors, copy/move constructors or copy/move assignment operators.</p></blockquote><p>This rule also appears in the C++ Core Guidelines:</p><blockquote><p>CCG C.20: If you can avoid defining default operations, do.</p></blockquote><h2 id=when-you-do-need-to-invent-an-raii-class>When you DO need to invent an RAII class</h2><del>Pre C++11:
- *the law of the big 2*: for implementing sane copy semantics, copy ctor and `copy=` should be both user-defined if either is.
- *rule of three*: for implementing sane copy semantics and RAII, copy ctor, `copy=`, and dtor should be all user-defined if any is.<p>If all data member is already RAII-managed, rule of 3 could downgrade to law of big 2, i.e. dtor can be omitted.
e.g. a class holding only a <code>unique_ptr</code> with proper deleter as data member can omit dtor.</p><p>Though both titled &ldquo;copy&rdquo;, copy ctor and <code>copy=</code> differs</p><ul><li>copy ctor <em>initialize</em> data member in <code>mem-initializer-list</code>.<ul><li>For data member with well-designed copy ctor, this simply delegates to their copy ctor.</li></ul></li><li>copy assignment operator first destructs currently owned resources, then copy rhs&rsquo;s resources into self<ul><li>if designed properlly, this simply delegates to data member&rsquo;s copy assignment operator.</li></ul></li></ul><p>Since C++11:</p><ul><li><em>the law of the big 4</em>:<ul><li>for implementing sane copy semantics, copy ctor and <code>copy=</code> should be both user-defined if either is.</li><li>for implementing sane move semantics, move ctor and <code>move=</code> should be both user-defined if either is.</li><li>it&rsquo;s common to design move-only class, so</li></ul></li><li><em>rule of three</em>: for implementing sane copy semantics and RAII, copy ctor, <code>copy=</code>, and dtor should be all user-defined if any is.</del></li></ul><h2 id=misc-consideration>misc consideration</h2><ul><li>Copy ctor is no more than a factory method. It can always be replaced by something like a <code>clone()</code>.</li><li>Copy assignment is literally a normal member function named <code>operator=</code>.</li></ul><p><a href=https://stackoverflow.com/questions/45754226/what-is-the-rule-of-four-and-a-half>https://stackoverflow.com/questions/45754226/what-is-the-rule-of-four-and-a-half</a>
<a href=https://stackoverflow.com/questions/3279543/what-is-the-copy-and-swap-idiom>https://stackoverflow.com/questions/3279543/what-is-the-copy-and-swap-idiom</a></p><h2 id=operator-overload>Operator Overload</h2><table><thead><tr><th>member</th><th>signature</th></tr></thead><tbody><tr><td>copy=</td><td>constexpr T& operator=(const T& other);</td></tr><tr><td>move=</td><td>constexpr T& operator=(T&& other);</td></tr><tr><td>prefix++</td><td>constexpr T& operator++()</td></tr><tr><td>postfix++</td><td>constexpr T operator(int)</td></tr><tr><td>prefix&ndash;</td><td>constexpr T& operator&ndash;()</td></tr><tr><td>postfix&ndash;</td><td>constexpr T operator&ndash;(int)</td></tr></tbody></table><h3 id=cast-operator>cast operator</h3><h3 id=literal-operator-user-define-literals>literal operator (user-define literals)</h3><p>C++11 allows integer, floating-point, character, and string literals to produce objects of user-defined type by appending a user-defined suffix.
This can be viewed as a fancy factory method which only takes a single literal as argument.</p><p>2 syntaxes for defining user-defined literal suffix for a class. Rules:</p><ol><li>literal operator must be free function, for it&rsquo;s not associated with any instance. (can be friend)</li><li>User-defined literal suffix must start with an underscore, except those from standard library which don&rsquo;t start with underscore.</li><li>Identifiers start with an underscore followed by an uppercase letter is reserved by spec, and canont be used in the first syntax.</li><li>The second syntax is designed to lift #3&rsquo;s restriction: keyword and reserved identifiers are allowed. Example being <code>std::complex</code> has <code>operator""if(arg)</code> to form a <code>0 + arg i</code> floating complex number.</li></ol><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>MyType</span> {};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e>// user-defined literal suffix should start with an underscore followed by an lowercase letter.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#75715e></span>MyType <span style=color:#66d9ef>operator</span><span style=color:#e6db74>&#34;&#34;</span> _x(<span style=color:#75715e>/* parameter-list */</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#75715e>// By omitting the middle space, user are allowed to use language keyword and reserved identifiers as suffix
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#75715e></span>MyType <span style=color:#66d9ef>operator</span><span style=color:#e6db74>&#34;&#34;</span>_X(<span style=color:#75715e>/* parameter-list */</span>);</span></span></code></pre></div><button>copy</button></div><p>For <code>parameter-list</code>, only 5 are allowed:</p><ul><li><code>unsigned long long int</code></li><li><code>long double</code></li><li><code>char</code></li><li><code>const char *</code></li><li><code>const char *, size_t</code></li></ul><p>Lexically:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>MyType</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    MyType <span style=color:#66d9ef>operator</span> <span style=color:#e6db74>&#34;&#34;</span> _X(<span style=color:#66d9ef>int</span> lit);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#75715e>// integer to user-defined types
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e>// decimal-literal ud-suffix (1)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#75715e></span><span style=color:#ae81ff>42</span>_X
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#75715e>// octal-literal ud-suffix	(2)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#75715e></span><span style=color:#ae81ff>052</span>_X
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#75715e>// hex-literal ud-suffix	(3)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#75715e></span><span style=color:#ae81ff>0x2a</span>_X
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#75715e>// binary-literal ud-suffix	(4)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#75715e></span><span style=color:#ae81ff>0b00101010</span>_X
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#75715e>// floating point to user-defined types
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#75715e>// fractional-constant exponent-part(optional) ud-suffix	(5)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#75715e></span><span style=color:#ae81ff>1.23</span>_X
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#ae81ff>1.23E42</span>_X
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#75715e>// digit-sequence exponent-part ud-suffix	(6)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#75715e></span><span style=color:#ae81ff>123E42</span>_X
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#75715e>// character-literal ud-suffix	(7)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#75715e></span><span style=color:#e6db74>&#39;f&#39;</span>_X
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#75715e>// string-literal ud-suffix	(8)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#75715e></span><span style=color:#e6db74>&#34;foo&#34;</span>_X</span></span></code></pre></div><button>copy</button></div><p>Argument to literal operator will never be custom type from some namespace. So ADL is never a thing. Program is ill-formed if normal unqualified lookup failed for literal operator.</p></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>