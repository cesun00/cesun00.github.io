<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Miscellaneous C++ consideration | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=active>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=hoverable>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=hoverable>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/cxx/>C/C++</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>Miscellaneous C++ consideration</h1><p class=aux-text style=margin-top:0>Published at: August 5, 2023
| Last modification: November 25, 2023</p><div style=line-height:2em><span class="page-tag tag-cxx">C++</span>
<span class="page-tag tag-programming-language">Programming Language</span></div></div><div><h2 id=ownership>Ownership</h2><p>Ownership of resources is the responsibility to destroy those resources at proper time.</p><p>In any design, resource owning class should follow RAII, and follow the Single Resonsibility Principle:
it shouldn&rsquo;t have any public API other than</p><ul><li>the 6 reasonable special member functions</li><li>a raw resourece accessor, as described in scott&rsquo;s <code>Item 15: Provide access to raw resources in resource-managing classes.</code></li></ul><h2 id=use-make_uniqueshared-helpers-instead-of-smart-pointer-constructor>use <code>make_(unique|shared)</code> helpers instead of smart pointer constructor</h2><p><a href=https://stackoverflow.com/a/22571331/8311608>https://stackoverflow.com/a/22571331/8311608</a></p><p>Overload a operator as a non-member function and declare it as friend to grant access to internal data members
<a href=https://stackoverflow.com/questions/2828280/friend-functions-and-operator-overloading-what-is-the-proper-way-to-overlo>https://stackoverflow.com/questions/2828280/friend-functions-and-operator-overloading-what-is-the-proper-way-to-overlo</a></p><h2 id=reference_wrapper><code>reference_wrapper</code></h2><h2 id=dynamic-dispatch-vptr-and-vtable>dynamic dispatch: <code>vptr</code> and <code>vtable</code></h2><p>A polymorphism class is a class containing at least 1 virtual function.</p><p>To support dynamic dispatch for polymorphism class, compiler</p><ul><li>creates an array of function pointers called <code>vtable</code> (virtual table), <strong>per class</strong>;</li><li>embeds 1 pointer called <code>vptr</code> (virtual pointer) <strong>in each instance</strong>, pointing to the <code>vtable</code> of its class</li></ul><h2 id=use-make_uniqueshared-helpers-instead-of-smart-pointer-constructor-1>use <code>make_(unique|shared)</code> helpers instead of smart pointer constructor</h2><p><a href=https://stackoverflow.com/a/22571331/8311608>https://stackoverflow.com/a/22571331/8311608</a></p><p>Overload an operator as a non-member function and declare it as friend to grant access to internal data members
<a href=https://stackoverflow.com/questions/2828280/friend-functions-and-operator-overloading-what-is-the-proper-way-to-overlo>https://stackoverflow.com/questions/2828280/friend-functions-and-operator-overloading-what-is-the-proper-way-to-overlo</a></p><h2 id=be-cautious-instantiating-class-in-a-loop>be cautious instantiating class in a loop</h2><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>Foo</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    Foo() { puts(<span style=color:#e6db74>&#34;constructed!&#34;</span>); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#f92672>~</span>Foo() { puts(<span style=color:#e6db74>&#34;DE-structed!&#34;</span>); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bar</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    Foo foo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#75715e>// do something with foo
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;i<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>10</span>;i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>        bar();        
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>}</span></span></code></pre></div><button>copy</button></div><p>If the compiler decided the instantiation can&rsquo;t be optimized out, the ctor and dtor will be called every single loop.
Do know if you really need a new instance every loop.</p><h2 id=c-shift>c++ shift</h2><p><a href=https://en.cppreference.com/w/cpp/language/operator_arithmetic#Bitwise_shift_operators>https://en.cppreference.com/w/cpp/language/operator_arithmetic#Bitwise_shift_operators</a></p><p>unlike java which has the unsigned right shift <code>>>></code> operator&mldr;</p><p>TODO: show mapping between shift operators and x86_64 instructions</p><h2 id=most-vexing-parse>Most Vexing Parse</h2><h2 id=volatile-in-c-is-useless><code>volatile</code> in C++ is useless</h2><p><a href=https://stackoverflow.com/questions/2484980/why-is-volatile-not-considered-useful-in-multithreaded-c-or-c-programming>https://stackoverflow.com/questions/2484980/why-is-volatile-not-considered-useful-in-multithreaded-c-or-c-programming</a></p><p>TLDR: <code>volatile</code> variable only guarantees</p><ol><li>read/write of that variable is actually from/to main memory (i.e. they penetrate the cache)</li><li>read/write of that variable happens in the source text order</li></ol><p>ABSOLUTELY NO GUARANTEE ABOUT:</p><ol><li>atomicity of read/write</li><li>forbidding instruction reordering. i.e. compiler still reorders instructions.
&ldquo;Assume that we use a volatile variable as a flag to indicate whether or not some data is ready to be read. In our code, we simply set the flag after preparing the data, so all looks fine. But what if the instructions are reordered so the flag is set first?&rdquo;</li><li>cache flush or jvm piggyback whatever</li></ol><p>Uninherited static data member in base class in the deadly diamond</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;iostream&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>  <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>int</span> c;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#66d9ef>int</span> A<span style=color:#f92672>::</span>c<span style=color:#f92672>=</span><span style=color:#ae81ff>42</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>B</span> <span style=color:#f92672>:</span> A {};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>C</span> <span style=color:#f92672>:</span> A{};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>D</span> <span style=color:#f92672>:</span> B,C {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>  <span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>foo</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>                                     <span style=color:#75715e>// nothing to do with inheritance here
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> (<span style=color:#f92672>&amp;</span>B<span style=color:#f92672>::</span>A<span style=color:#f92672>::</span>c) <span style=color:#f92672>==</span> <span style=color:#f92672>&amp;</span>(C<span style=color:#f92672>::</span>A<span style=color:#f92672>::</span>c); <span style=color:#75715e>// this is just global namespace resolution...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#75715e></span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>  <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>bar</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#66d9ef>return</span> (<span style=color:#f92672>&amp;</span>B<span style=color:#f92672>::</span>A<span style=color:#f92672>::</span>c) <span style=color:#f92672>==</span> <span style=color:#f92672>&amp;</span>(C<span style=color:#f92672>::</span>A<span style=color:#f92672>::</span>c);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>  D d;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>  std<span style=color:#f92672>::</span>cout<span style=color:#f92672>&lt;&lt;</span>std<span style=color:#f92672>::</span>boolalpha <span style=color:#f92672>&lt;&lt;</span> D<span style=color:#f92672>::</span>bar() <span style=color:#f92672>&lt;&lt;</span> d.foo();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>}</span></span></code></pre></div><button>copy</button></div><h2 id=ways-to-lazy-init>ways to Lazy Init</h2><p>Lazy initialization refer to the fact that:</p><p>If our only intention is to lazy initialize a data member or local variable, since C++ 17 we can use the std::optional. This free us from the usage of heap memory (to be more precise, the usage of a pointer to separate heap memory, since the host class itself might be already in the heap, in which case you can&rsquo;t avoid the heap anyway), and express our intention of lazy init explicitly.</p><p>A deeper implication is that, it also enable a variable to escape its scope:</p><h3 id=pointer-or-unique_ptr>pointer or <code>unique_ptr</code></h3><p>pro: little space on stack
con: pay for heap allocation and pointer indirection per access.</p><h3 id=non-initializer-object-stack-only>non-initializer object (stack only)</h3><h3 id=stdoptional><code>std::optional</code></h3><p><code>std::optional</code> can be used to pre-occupy stack space without initialize it.</p><p>This is equivalent to</p><div class=codeblock-hook><pre tabindex=0><code>struct foo {
    char value[100];
};

void foo() {
    foo a; // TODO: no init
    std::optional&lt;foo&gt; b;
}</code></pre><button>copy</button></div><h2 id=abstract-class-are-considered-complete-type>Abstract class are considered complete type:</h2><p><a href=https://stackoverflow.com/questions/16597389/are-c-abstract-classes-incomplete-types>https://stackoverflow.com/questions/16597389/are-c-abstract-classes-incomplete-types</a></p><h2 id=integer-promotion>Integer Promotion</h2><p>Each integer type, signed or unsigned, is assigned a <em>rank</em>, described as follows:</p><ol><li>Rank increases with the growth of integer precision (i.e. width).</li><li>rank of <code>signed x</code> equals rank <code>unsigned x</code> - its unsigned counterpart</li></ol><div class=codeblock-hook><pre tabindex=0><code>         ^       (signed)            (unsigned)
         |       long long       =   unsigned long long
rank     |       long            =   unsigned long
increase |       int             =   ...
         |       short               ...
         |       char</code></pre><button>copy</button></div><p><strong>integer promotion</strong> is the implicit conversion from any integer type (signed or unsigned) whose rank is less than <code>int</code>,</p><ol><li><p>to <code>int</code> if that&rsquo;s large enough to hold the original numeric value.</p><p>e.g. For <code>unsigned char a = 42, b = 55;</code>, <code>int c = a + b</code> first promotes both <code>a</code> and <code>b</code> to <code>signed int</code>, even there were <code>unsigned char</code>.</p></li><li><p>otherwise, to <code>unsigned int</code>.</p></li></ol><h2 id=lambda>Lambda</h2><p>TODO: size of lambda object? pass by value or reference? code storage?</p><p>Lambda&rsquo;s design follows a one-type-per-instance policy. No lambda objects share the same type even if their bodies are identical.</p><p>The only way to refer to the type of an labmda is through <code>decltype()</code> of the lambda object.</p><h3 id=generic-lambda>generic lambda</h3><p>Generic lambda is a syntax sugar for function template.
Unlike normal labmda which gets into <code>.text</code> immediately, it gets instantiated (generates code) only upon invocation.</p><h2 id=argument-dependent-koeing-lookup>Argument-Dependent (Koeing) Lookup</h2><p>Namespaces form lexical scopes of names, same as functions and whatever constructs involving a pair of brace <code>{}</code>.</p><p>If the declaration of a name can&rsquo;t be found in the current scope, compiler repetitively perform lookup in scope one level up.
If compiler finished examining the default global namespace and still no declaration of such name is found, program is ill-formed (with some compiler-specific exceptions that will assume the declaration and hope linker find the symbol later; ignore this mess for now).</p><p>This is the common name lookup we are all familiar with.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>namespace</span> foo {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bar</span>();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    bar();      <span style=color:#75715e>// compiler complains `bar` can&#39;t be found - as expected
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#75715e></span>}</span></span></code></pre></div><button>copy</button></div><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>namespace</span> foo {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>bar</span> { };
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>baz</span>(<span style=color:#66d9ef>int</span> c) { std<span style=color:#f92672>::</span>puts(<span style=color:#e6db74>&#34;foo::baz(int)&#34;</span>); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>zoo</span>(bar obj) { std<span style=color:#f92672>::</span>puts(<span style=color:#e6db74>&#34;foo::zoo(foo::bar)&#34;</span>); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#75715e>//main.cpp:17:5: error: ‘baz’ was not declared in this scope; did you mean ‘foo::baz’?
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#75715e></span>    <span style=color:#75715e>//   17 |     baz(42);
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#75715e></span>    <span style=color:#75715e>//      |     ^~~
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#75715e></span>    <span style=color:#75715e>//      |     foo::baz
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#75715e></span>    baz(<span style=color:#ae81ff>42</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#75715e>// works just fine - WTF?
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#75715e></span>    zoo(foo<span style=color:#f92672>::</span>bar{});
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}</span></span></code></pre></div><button>copy</button></div><h1 id=conversion-transitivity-graph>Conversion Transitivity Graph</h1><p>There is a conversion from type X to type Y if any of the following holds:</p><ol><li>fpop</li><li>fpop</li><li>fpop</li></ol><h2 id=value>VALUE</h2><p>7.1.1 An expression is a sequence of operators and operands that specifies a computation. An expression can result in a value and can cause side effects.</p><p>Value is one of the 13 entities.</p><p>A value is the result of evaluating an expression.</p><p>It doesn&rsquo;t make sense to take the address of 3+5,</p><p>// and there is absolute no reason for compiler to arrange storage for such a result. At runtime the wildest thing compiler can write for you is just call the ADD instruction and put the result in the EAX register of x86_64.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>p <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>(<span style=color:#ae81ff>3</span><span style=color:#f92672>+</span><span style=color:#ae81ff>5</span>) <span style=color:#75715e>// WTF
</span></span></span></code></pre></div><button>copy</button></div><h1 id=interchangability-of-reference-and-object--reference-collapsing>Interchangability of Reference and Object / Reference Collapsing</h1><blockquote><p>If an expression initially has the type “reference to T” (9.3.3.2, 9.4.3), the type is adjusted to T prior to any further analysis.
<cite>c++20 7.2.2.1</cite></p></blockquote><p>That&rsquo;s why when you request an object but get a reference, everything works fine.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo</span>(<span style=color:#66d9ef>int</span> c){}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#66d9ef>int</span> a <span style=color:#f92672>=</span> <span style=color:#ae81ff>42</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#66d9ef>int</span> <span style=color:#f92672>&amp;</span>b <span style=color:#f92672>=</span> a; <span style=color:#75715e>// variable b has type &#34;reference to int&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#75715e></span>    foo(b); <span style=color:#75715e>// expression `b` has type `int`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#75715e></span>}</span></span></code></pre></div><button>copy</button></div><h2 id=const-member-function>const member function</h2><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;cstdio&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>X</span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo</span>() <span style=color:#66d9ef>const</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>        puts(<span style=color:#e6db74>&#34;foo const&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>        puts(<span style=color:#e6db74>&#34;foo non-const&#34;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>};
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    X x;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#66d9ef>const</span> X cx;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    x.foo();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    cx.foo();
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>}</span></span></code></pre></div><button>copy</button></div><p>TODO:: REALLY? A NON CONST object should be able to call a CONST member function.</p><p><code>void foo() const</code> can only be called on a const qualified <code>foo</code> instance. <code>const</code> effectively take part in the overload resolution.</p><p>Inside the <code>const</code> qualified member function, <code>*this</code> is const qualified, which means among other member functions, only <code>const</code> qualified member functions can be called;</p><p>Really, &ldquo;const member function promised not to change its object&rdquo;, is a consequence, not its motivation.</p><p><a href=https://en.cppreference.com/w/cpp/language/overload_resolution>https://en.cppreference.com/w/cpp/language/overload_resolution</a></p><blockquote><p>If any candidate function is a member function (static or non-static), but not a constructor, it is treated as if it has an extra parameter (implicit object parameter) which represents the object for which they are called and appears before the first of the actual parameters.</p></blockquote><p>Similarly, the object on which a member function is being called is prepended to the argument list as the implied object argument.</p><p>For member functions of class X, the type of the implicit object parameter is affected by cv-qualifications and ref-qualifications of the member function as described in member functions.</p><p>TODO: see ref-qualified member funciton, and relate to the implied object parameter/argument as well.</p><h2 id=polymorphismn>polymorphismn</h2><p><em>polymorphism</em> refers to the fact that a single &ldquo;interface&rdquo; works for different argument types.</p><p>Depending on your interpretation of what &ldquo;interface&rdquo; is / includes, polymorphism can further be divide into:</p><ol><li><p>ad-hoc polymorphism.</p><p>You write multiple pieces of source code but keep the same interface, in order to make that interface works for multiple types.</p><p>Almost always this means function overload. Here &ldquo;interface&rdquo; is cunningly interpreted to contains only the function name used for invocation, without parameter types and count, etc.</p></li><li><p>parameteric polymorphism (a.k.a static / compile-time polymorphism)</p><p>You write a single piece of source code, thus having a single interface, and make it works for multiple argument types by</p></li><li><p>subtyping (a.k.a runtime polymorphism)</p><p>You write a single piece of source code, thus having a single interface, and make it works for multiple argument types by</p></li></ol><h1 id=function-name-as-pointer-type>Function name as pointer type</h1><h2 id=c>C</h2><p>C99 states that</p><blockquote><p>(6.7.5.3.8) A declaration of a parameter as ‘‘function returning type’’ shall be adjusted to ‘‘pointer to
function returning type’’, as in 6.3.2.1.</p></blockquote><p>This means the following both compile and are equivalent:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo1</span>(<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>f</span>(<span style=color:#66d9ef>void</span>)) {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo2</span>(<span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>f)(<span style=color:#66d9ef>void</span>)) {}</span></span></code></pre></div><button>copy</button></div><p>Function parameter declaration is the only place where function type name can be spell without an parentheses-enclosed asterisk.
e.g. the following variable declarations are illegal:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo</span>(<span style=color:#66d9ef>void</span>){}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e>// WRONG
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>f1</span>(<span style=color:#66d9ef>void</span>) <span style=color:#f92672>=</span> foo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#66d9ef>void</span> (f2)(<span style=color:#66d9ef>void</span>) <span style=color:#f92672>=</span> foo;</span></span></code></pre></div><button>copy</button></div><p>Also:</p><blockquote><p>(6.3.2.1.4) Except when it is the
operand of the sizeof operator or the unary & operator, a function designator with
type ‘‘function returning type’’ is converted to an expression that has type ‘‘pointer to
function returning type’’.</p></blockquote><p>This means the following both compile and are equivalent:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo</span>(<span style=color:#66d9ef>void</span>) {}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>f1)(<span style=color:#66d9ef>void</span>) <span style=color:#f92672>=</span> foo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    <span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>f2)(<span style=color:#66d9ef>void</span>) <span style=color:#f92672>=</span> <span style=color:#f92672>&amp;</span>foo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>}</span></span></code></pre></div><button>copy</button></div><p>Combined, this is a well-formed c99 program:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>foo</span>() {<span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;foo&#34;</span>);}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bar1</span>(<span style=color:#66d9ef>void</span> <span style=color:#a6e22e>f</span>(<span style=color:#66d9ef>void</span>)) { <span style=color:#a6e22e>f</span>(); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>bar2</span>(<span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>f)(<span style=color:#66d9ef>void</span>)) { <span style=color:#a6e22e>f</span>(); }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#a6e22e>bar1</span>(foo);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#a6e22e>bar1</span>(<span style=color:#f92672>&amp;</span>foo);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#a6e22e>bar2</span>(foo);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#a6e22e>bar2</span>(<span style=color:#f92672>&amp;</span>foo);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>}</span></span></code></pre></div><button>copy</button></div><h2 id=c-1>C++</h2><h1 id=compile-time-dependency>compile-time dependency</h1><p>A translation unit accesses functionalities (functions, classes, type definitions, etc) from other translation units by including headers containing declaration of those functionalities. The most common scenario is a client program including headers from third-party libraries.</p><p>A client&rsquo;s translation unit is said to have compile-time dependency on a library header if modification in the library header (due to the library being updated) potentially induces a recompilation of the translation unit. Otherwise, it suffices to update the whole program by simply relinking.</p><p>Compile-time dependency happens when library headers expose non-(runtime-)polymorphic types (i.e. &ldquo;concrete&rdquo; types rather than references and pointers) used by clients.</p><p>Library designed <code>Foo</code> to hold some data and expose an iterator, with the hope that clients use <code>Foo</code> as a collection of items without caring about the <em>implementation details</em>, specifically, type of the underlying data container (thus type of iterator), in this case <code>vector</code>.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e>// library header
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Foo</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>public</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#66d9ef>using</span> iterator <span style=color:#f92672>=</span> std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;::</span>iterator;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>    iterator <span style=color:#a6e22e>begin</span>() <span style=color:#66d9ef>const</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>    iterator <span style=color:#a6e22e>end</span>() <span style=color:#66d9ef>const</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#66d9ef>private</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    std<span style=color:#f92672>::</span>vector<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span> data;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>};</span></span></code></pre></div><button>copy</button></div><p>Client now can write code without mentioning <code>vector</code> at all. But compiler need to know that <code>iterator</code> resolve to <code>std::vector&lt;int>::iterator</code> when the client translation unit get compiled. If later the library author decides to change <code>std::vector</code> to <code>std::list</code> (thus <code>iterator</code>), client&rsquo;s old object file won&rsquo;t link with the new library object file, because the library object file doesn&rsquo;t expose the old symbol name anymore after mangling due to the change of type.</p><p><em>By introducing compile-time dependency, library author relinquishes the freedom of transparently changing part of library that were meant to be implementation details, and bother the client of at least a recompilation.</em></p><h2 id=type-erasure-not-quite-the-java-sense>&ldquo;type erasure&rdquo;, not quite the Java sense</h2><p>C++ community coined the word &ldquo;type erasure&rdquo; to mean rewriting statically polymorphic code into runtime polymorphic code.</p><p>e.g. A function template can take whatever type arguments as long as the instantiation is successful. To type-erase the function template is to put commonality of those types into an base class, and write an ordinary function taking parameter of the base class pointer / reference.</p><p>Such rewrite <a href=https://stackoverflow.com/questions/13670671/abstract-iterator-for-underlying-collections>is not trivial</a>. For this reason, unlike java, you will almost never see someone use &ldquo;abstract&rdquo; base iterator in C++.</p><p>Pros:</p><ol><li>eliminate compile-time dependency</li></ol><p>Cons:</p><ol><li>introduce virtual pointer</li></ol></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>