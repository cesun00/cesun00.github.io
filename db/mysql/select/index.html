<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>SELECT and Optimization Techniques | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=hoverable>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=active>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=hoverable>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/db/>Database</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>SELECT and Optimization Techniques</h1><p class=aux-text style=margin-top:0>Published at: August 26, 2023
| Last modification: October 31, 2023</p><div style=line-height:2em><span class="page-tag tag-database">database</span>
<span class="page-tag tag-mysql">mysql</span>
<span class="page-tag tag-sql">sql</span></div></div><div><p>The notorious query statement being excessively versatile.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> [<span style=color:#66d9ef>DISTINCT</span>] ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>FROM</span> ... PARTITION ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>WHERE</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#66d9ef>HAVING</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>WINDOW ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> ... [<span style=color:#66d9ef>DESC</span>]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#66d9ef>LIMIT</span> ...</span></span></code></pre></div><button>copy</button></div><h2 id=display-huge-number-of-columns-in-terminal>display huge number of columns in terminal</h2><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> <span style=color:#66d9ef>user</span><span style=color:#960050;background-color:#1e0010>\</span><span style=color:#66d9ef>G</span></span></span></code></pre></div><button>copy</button></div><p><a href=https://stackoverflow.com/questions/924729/how-to-best-display-in-terminal-a-mysql-select-returning-too-many-fields>https://stackoverflow.com/questions/924729/how-to-best-display-in-terminal-a-mysql-select-returning-too-many-fields</a></p><h2 id=pattern-matching>Pattern Matching</h2><h3 id=not-like>[NOT] LIKE</h3><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> ... <span style=color:#66d9ef>FROM</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>WHERE</span> <span style=color:#f92672>&lt;</span><span style=color:#66d9ef>column</span><span style=color:#f92672>&gt;</span> [<span style=color:#66d9ef>NOT</span>] <span style=color:#66d9ef>LIKE</span> <span style=color:#f92672>&lt;</span>pattern<span style=color:#f92672>&gt;</span></span></span></code></pre></div><button>copy</button></div><p>Only 2 meta char allowed:</p><ul><li><code>%</code> matches any number of characters, including zero.</li><li><code>_</code> matches any single character.</li></ul><h3 id=regex>Regex</h3><p><a href=https://dev.mysql.com/doc/refman/8.0/en/regexp.html>https://dev.mysql.com/doc/refman/8.0/en/regexp.html</a></p><ul><li><code>REGEXP</code>/<code>RLIKE</code> operators</li><li><code>REGEXP_LIKE()</code> function</li></ul><p>case-insensitive by default;</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> pet <span style=color:#66d9ef>where</span> <span style=color:#66d9ef>owner</span> REGEXP <span style=color:#e6db74>&#39;^b&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#f92672>+</span><span style=color:#75715e>------+-------+---------+------+------------+-------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e></span><span style=color:#f92672>|</span> name <span style=color:#f92672>|</span> <span style=color:#66d9ef>owner</span> <span style=color:#f92672>|</span> species <span style=color:#f92672>|</span> sex  <span style=color:#f92672>|</span> birth      <span style=color:#f92672>|</span> death <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#f92672>+</span><span style=color:#75715e>------+-------+---------+------+------------+-------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#75715e></span><span style=color:#f92672>|</span> Fang <span style=color:#f92672>|</span> Benny <span style=color:#f92672>|</span> dog     <span style=color:#f92672>|</span> m    <span style=color:#f92672>|</span> <span style=color:#ae81ff>1990</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>27</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span>  <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#f92672>|</span> Slim <span style=color:#f92672>|</span> Benny <span style=color:#f92672>|</span> snake   <span style=color:#f92672>|</span> m    <span style=color:#f92672>|</span> <span style=color:#ae81ff>1996</span><span style=color:#f92672>-</span><span style=color:#ae81ff>04</span><span style=color:#f92672>-</span><span style=color:#ae81ff>29</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span>  <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#f92672>+</span><span style=color:#75715e>------+-------+---------+------+------------+-------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#75715e></span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>000</span> sec)</span></span></code></pre></div><button>copy</button></div><p>3 ways to make regex pattern matching case-sensitive:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> pet <span style=color:#66d9ef>WHERE</span> REGEXP_LIKE(name, <span style=color:#e6db74>&#39;^b&#39;</span> <span style=color:#66d9ef>COLLATE</span> utf8mb4_0900_as_cs);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> pet <span style=color:#66d9ef>WHERE</span> REGEXP_LIKE(name, BINARY <span style=color:#e6db74>&#39;^b&#39;</span>);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> pet <span style=color:#66d9ef>WHERE</span> REGEXP_LIKE(name, <span style=color:#e6db74>&#39;^b&#39;</span>, <span style=color:#e6db74>&#39;c&#39;</span>); </span></span></code></pre></div><button>copy</button></div><p>For MariaDB:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>MariaDB [menagerie]<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> pet <span style=color:#66d9ef>where</span> <span style=color:#66d9ef>owner</span> REGEXP BINARY <span style=color:#e6db74>&#39;^b&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>Empty <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>000</span> sec)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>MariaDB [menagerie]<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> pet <span style=color:#66d9ef>where</span> <span style=color:#66d9ef>owner</span> REGEXP BINARY <span style=color:#e6db74>&#39;^B&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f92672>+</span><span style=color:#75715e>------+-------+---------+------+------------+-------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e></span><span style=color:#f92672>|</span> name <span style=color:#f92672>|</span> <span style=color:#66d9ef>owner</span> <span style=color:#f92672>|</span> species <span style=color:#f92672>|</span> sex  <span style=color:#f92672>|</span> birth      <span style=color:#f92672>|</span> death <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>+</span><span style=color:#75715e>------+-------+---------+------+------------+-------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#75715e></span><span style=color:#f92672>|</span> Fang <span style=color:#f92672>|</span> Benny <span style=color:#f92672>|</span> dog     <span style=color:#f92672>|</span> m    <span style=color:#f92672>|</span> <span style=color:#ae81ff>1990</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>27</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span>  <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f92672>|</span> Slim <span style=color:#f92672>|</span> Benny <span style=color:#f92672>|</span> snake   <span style=color:#f92672>|</span> m    <span style=color:#f92672>|</span> <span style=color:#ae81ff>1996</span><span style=color:#f92672>-</span><span style=color:#ae81ff>04</span><span style=color:#f92672>-</span><span style=color:#ae81ff>29</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>NULL</span>  <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f92672>+</span><span style=color:#75715e>------+-------+---------+------+------------+-------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#75715e></span><span style=color:#ae81ff>2</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>001</span> sec)</span></span></code></pre></div><button>copy</button></div><h2 id=aggregate-functions>Aggregate Functions</h2><p>List of all available aggregate functions:
<a href=https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html>https://dev.mysql.com/doc/refman/8.0/en/aggregate-functions.html</a></p><p>Selecting aggregate functions without a <code>GROUP BY</code> clause behaves as if there is a single group containing all rows.</p><h3 id=group-by-rules>GROUP BY rules</h3><p>TL;DR: turn on <code>ONLY_FULL_GROUP_BY</code>, and use <code>ANY_VALUE()</code> when necessary.</p><p>One rule for using aggregate functions is that, apart from the aggregate functions themselves, all field selected should also appear in the <code>GROUP BY</code> caluse. e.g.:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> t;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>------+------+------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> a    <span style=color:#f92672>|</span> b    <span style=color:#f92672>|</span> <span style=color:#66d9ef>c</span>    <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>------+------+------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>100</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>200</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>200</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>300</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>100</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>200</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>500</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span> <span style=color:#ae81ff>3300</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>------+------+------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#ae81ff>8</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#66d9ef>SELECT</span> a,b,<span style=color:#66d9ef>MAX</span>(<span style=color:#66d9ef>C</span>),<span style=color:#66d9ef>MIN</span>(<span style=color:#66d9ef>C</span>) <span style=color:#66d9ef>FROM</span> t <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> a,b;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>------+------+--------+--------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> a    <span style=color:#f92672>|</span> b    <span style=color:#f92672>|</span> <span style=color:#66d9ef>MAX</span>(<span style=color:#66d9ef>C</span>) <span style=color:#f92672>|</span> <span style=color:#66d9ef>MIN</span>(<span style=color:#66d9ef>C</span>) <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>------+------+--------+--------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>200</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>100</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>300</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>200</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>200</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>100</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>   <span style=color:#ae81ff>3300</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>500</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>------+------+--------+--------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#ae81ff>4</span> <span style=color:#66d9ef>rows</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>set</span> (<span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>00</span> sec)</span></span></code></pre></div><button>copy</button></div><p>One exception to this rule is when the non-aggregate selected columns functionally depend on the <code>GROUP BY</code> columns:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#f92672>#</span> find how many languages <span style=color:#66d9ef>is</span> spoken <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>each</span> country
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>SELECT</span> co.Name, <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>FROM</span> countrylanguage cl, country co
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#66d9ef>WHERE</span> cl.CountryCode <span style=color:#f92672>=</span> co.Code
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> co.Code;</span></span></code></pre></div><button>copy</button></div><p>Here <code>Code</code> is the primary key of table <code>country</code>. We are grouping by <code>Code</code> but we have a non-aggregate selected column <code>Name</code>. This is well-defined, since <code>Code</code> uniquely identify a country thus its name.</p><p>However, even if a non-aggregate selected column doesn&rsquo;t functionally depends on the <code>GROUP BY</code> columns, evil mysql still accept such query by default (controlled by <code>ONLY_FULL_GROUP_BY</code>), but the result is undefined.</p><h2 id=having-clause>HAVING Clause</h2><p><code>HAVING</code> works on the result of the grouping, while <code>WHERE</code> clause works on-the-fly while scanning each rows.</p><p>There are lots of way to abuse the <code>HAVING</code> clause. Without aggregate functions and <code>GROUP BY</code>, <code>HAVING</code> is the same as <code>WHERE</code> (at least mysql behaves the same, not sure about the performance, anyway don&rsquo;t do this, and use <code>WHERE</code> instead):</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>SELECT</span> Name, Population <span style=color:#66d9ef>FROM</span> city <span style=color:#66d9ef>HAVING</span> Population<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>9600000</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-----------------+------------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> Name            <span style=color:#f92672>|</span> Population <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-----------------+------------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> São Paulo       <span style=color:#f92672>|</span>    <span style=color:#ae81ff>9968485</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> Jakarta         <span style=color:#f92672>|</span>    <span style=color:#ae81ff>9604900</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> Mumbai (Bombay) <span style=color:#f92672>|</span>   <span style=color:#ae81ff>10500000</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> Shanghai        <span style=color:#f92672>|</span>    <span style=color:#ae81ff>9696300</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> Seoul           <span style=color:#f92672>|</span>    <span style=color:#ae81ff>9981619</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-----------------+------------+</span></span></span></code></pre></div><button>copy</button></div><p>Other ways include selecting non-aggregate columns without putting them or their functional dependency into <code>GROUP BY</code>:</p><pre><code>```sql
SELECT * FROM city HAVING Population = MAX(Population);
# Empty set (0.01 sec)

SELECT * FROM city HAVING Population &gt; AVG(Population);
# +------+-------+-------------+----------+------------+
# | ID   | Name  | CountryCode | District | Population |
# +------+-------+-------------+----------+------------+
# |    1 | Kabul | AFG         | Kabol    |    1780000 |
# +------+-------+-------------+----------+------------+
```
</code></pre><p>Those results are apparently wrong. What those queries mean is very different from what they mean in English. Again without a <code>GROUP BY</code>, there is only a single big group, and only the result of the aggregate function (which is not selected) makes sense.</p><p>Aggregate function is allowed in <code>HAVING</code> clause, and forbidden in <code>WHERE</code> clause. <strong>But whatever aggregate functions are used in <code>HAVING</code> clause, they must appear as well in the <code>SELECT</code> columns.</strong> <code>HAVING</code> condition is applied on the result of grouping, and aggregate function inside <code>HAVING</code> clause won&rsquo;t be done if they haven&rsquo;t already been done as part of the <code>SELECT</code> scanning. That is, aggregate functions in <code>HAVING</code> are just references, not commands. Actually a symbol is preferred:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>SELECT</span> CountryCode, <span style=color:#66d9ef>SUM</span>(Population) <span style=color:#66d9ef>AS</span> Pop
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>FROM</span> city <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> CountryCode <span style=color:#66d9ef>HAVING</span> Pop <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>70000000</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-------------+-----------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> CountryCode <span style=color:#f92672>|</span> Pop       <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-------------+-----------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> BRA         <span style=color:#f92672>|</span>  <span style=color:#ae81ff>85876862</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> CHN         <span style=color:#f92672>|</span> <span style=color:#ae81ff>175953614</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> IND         <span style=color:#f92672>|</span> <span style=color:#ae81ff>123298526</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> JPN         <span style=color:#f92672>|</span>  <span style=color:#ae81ff>77965107</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> USA         <span style=color:#f92672>|</span>  <span style=color:#ae81ff>78625774</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-------------+-----------+</span></span></span></code></pre></div><button>copy</button></div><p>For the 2 erroneous examples above to work, a subquery is required:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> city <span style=color:#66d9ef>WHERE</span> Population <span style=color:#f92672>=</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>MAX</span>(Population) <span style=color:#66d9ef>FROM</span> city);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> city <span style=color:#66d9ef>WHERE</span> Population <span style=color:#f92672>&gt;</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>AVG</span>(Population) <span style=color:#66d9ef>FROM</span> city);</span></span></code></pre></div><button>copy</button></div><h2 id=join>Join</h2><p>The <code>ON</code> clause specify a bool expression e.g. <code>SELECT * FROM t0 JOIN t1 ON t0.b = t1.b</code>; while the <code>USING</code> clause specify the names of columns that must exist in both table, e.g. <code>SELECT * FROM t0 JOIN t1 USING(b);</code>. Those 2 examples are effectively the same, except that the <code>USING</code> one don&rsquo;t produce column <code>b</code> twice.</p><ul><li><p><code>[INNER|CROSS] JOIN [ON|USING ...]</code></p><p>If the <code>ON|USING ...</code> clause is absent, whole cartesian product will be output, i.e. the same as the comma concatenation of 2 tables in the <code>FROM</code> clause.</p><p>If the <code>ON|USING ...</code> clause is presented, among all rows in the cartesian product, only those that matches the condition will be output.</p><p><code>STRAIGHT_JOIN</code>: TODO</p></li><li><p><code>LEFT [OUTER] JOIN ON|USING ...</code></p><p><code>ON|USING ...</code> clause must be presented.</p><p>For each row in the left table, for each row in the right table that matches the condition, a joined row is output. If no row from the right table matches, a joined row (current left table column , null row table column) will be output.</p></li><li><p><code>RIGHT [OUTER] JOIN ON ...</code></p><p>Same as <code>LEFT JOIN</code> but the other direction. Note that by exchanging position of the 2 tables, a <code>RIGHT JOIN</code> can always become <code>LEFT JOIN</code>.</p></li><li><p><code>NATURAL [INNER] JOIN</code></p><p>Equivalent to <code>... t0 JOIN t1 USING(&lt;all common column names in t0 and t1>)</code>.</p></li><li><p><code>NATURAL LEFT [OUTER] JOIN</code></p></li><li><p><code>NATURAL RIGHT [OUTER] JOIN</code></p></li><li><p>It&rsquo;s not a thing: <code>OUTER JOIN</code>/<code>FULL JOIN</code>/<code>FULL OUTER JOIN</code></p><p>Mysql does not support <code>FULL JOIN</code>, <code>OUTER JOIN</code>, or <code>FULL OUTER JOIN</code> whatsoever. The fact that the SQL langauge was standardized too late is to blame.</p><p>When people use this type of join in Microsoft SQL Server, what they get is a inner join but:</p><ol><li>a row from left table matching no row from right table still produce a row with columns from right table <code>NULL</code>;</li><li>a row from right table matching no row from left table still produce a row with columns from left table <code>NULL</code>;</li></ol><p>This is feels like a combination of <code>LEFT JOIN</code> + <code>RIGHT JOIN</code>.</p><p>There is a way to emulate this in MySQL:
<a href=https://stackoverflow.com/questions/4796872/how-to-do-a-full-outer-join-in-mysql>https://stackoverflow.com/questions/4796872/how-to-do-a-full-outer-join-in-mysql</a></p></li></ul><h3 id=join-vs-from-cartesian-where><code>JOIN</code> vs <code>FROM cartesian WHERE</code></h3><p>Note that the performance of the following query should be the same:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>FROM</span> t0,t1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>WHERE</span> t0.xxx <span style=color:#f92672>=</span> t1.xxx;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#66d9ef>SELECT</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#66d9ef>FROM</span> t0 <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> t1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#66d9ef>ON</span> t0.xxx <span style=color:#f92672>=</span> t1.xxx;</span></span></code></pre></div><button>copy</button></div><p>Ref: <a href=https://stackoverflow.com/questions/121631/inner-join-vs-where>https://stackoverflow.com/questions/121631/inner-join-vs-where</a></p><h2 id=limit-and-pagination>LIMIT and Pagination</h2><p>The <code>LIMIT</code> clause is extensively used to implement pagination. 3 syntax exist:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> ... <span style=color:#66d9ef>FROM</span> ...  <span style=color:#66d9ef>LIMIT</span> n; 				<span style=color:#f92672>#</span> <span style=color:#66d9ef>get</span> the <span style=color:#66d9ef>first</span> n <span style=color:#66d9ef>rows</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>SELECT</span> ... <span style=color:#66d9ef>FROM</span> ...  <span style=color:#66d9ef>LIMIT</span> <span style=color:#66d9ef>off</span>,n; 			<span style=color:#f92672>#</span> skip the <span style=color:#66d9ef>first</span> <span style=color:#66d9ef>off</span>, <span style=color:#66d9ef>then</span> <span style=color:#66d9ef>get</span> n <span style=color:#66d9ef>rows</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>SELECT</span> ... <span style=color:#66d9ef>FROM</span> ...  <span style=color:#66d9ef>LIMIT</span> n <span style=color:#66d9ef>OFFSET</span> <span style=color:#66d9ef>off</span>;	<span style=color:#f92672>#</span> ditto but sane syntax</span></span></code></pre></div><button>copy</button></div><p><a href=https://stackoverflow.com/a/3799223/8311608>Some best practice</a> recommends that <code>LIMIT</code> clause always be used with the <code>ORDER BY</code> clause, even if it&rsquo;s on the clustered index which is no-op, e.g. the example above.</p><p>Designating <code>page_idx</code> (1-indexed) and <code>page_size</code> for what they obviously mean, rows of a page can be queried by:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>LIMIT</span> page_size <span style=color:#66d9ef>OFFSET</span> (page_idx <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>*</span> page_size;</span></span></code></pre></div><button>copy</button></div><h3 id=limit-when-order-by-columns-have-duplicated-values>LIMIT when ORDER BY columns have duplicated values</h3><p><a href=https://dev.mysql.com/doc/refman/8.0/en/limit-optimization.html>https://dev.mysql.com/doc/refman/8.0/en/limit-optimization.html</a></p><p>A peculiar phenomenon when combining <code>ORDER BY</code> and <code>LIMIT</code> is that a query may return rows in a different order comparing to <code>ORDER BY</code> <strong>without</strong> <code>LIMIT</code>, when those <code>ORDER BY</code> columns have identical values on multiple rows:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> ratings <span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> category;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----+----------+--------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> id <span style=color:#f92672>|</span> category <span style=color:#f92672>|</span> rating <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----+----------+--------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>4</span>.<span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>7</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>6</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>5</span>.<span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>7</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>2</span>.<span style=color:#ae81ff>7</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----+----------+--------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> ratings <span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> category <span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----+----------+--------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> id <span style=color:#f92672>|</span> category <span style=color:#f92672>|</span> rating <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----+----------+--------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>4</span>.<span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>1</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>4</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>3</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>7</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>6</span> <span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span> <span style=color:#f92672>|</span>    <span style=color:#ae81ff>3</span>.<span style=color:#ae81ff>5</span> <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----+----------+--------+</span></span></span></code></pre></div><button>copy</button></div><p>Since the order of rows returned is non-deterministic when <code>ORDER BY</code> columns have identical values on multiple rows, relying on such behavior is insane already, set aside wondering why <code>LIMIT</code> changes the order. Anyway, just knowledge for fun.</p><h2 id=limit--offset-is-slow>LIMIT &mldr; OFFSET is slow</h2><p>MySQL cannot seek directly to the <code>OFFSET ...</code> row on the disk, cause it&rsquo;s not sure how many rows are there in each page (recall that each page is not necessarily full, actually usually half to 15/16 full).</p><p>This means that even a <code>LIMIT ... OFFSET ...</code> query even <code>ORDER BY</code> the clustered index will brings a full table scan up to the <code>offset+limit</code>.</p><p>The correct way is to write a range condition on the PK based on the page # and row per page:</p><p><a href=https://stackoverflow.com/questions/4481388/why-does-mysql-higher-limit-offset-slow-the-query-down>https://stackoverflow.com/questions/4481388/why-does-mysql-higher-limit-offset-slow-the-query-down</a></p><h2 id=considerations-for-order-by>Considerations for <code>ORDER BY</code></h2><ol><li><p>You can <code>ORDER BY</code> multiple columns. The ordering of the first designated column has the highest priority.</p></li><li><p>When the <code>ORDER BY</code> columns have identical values on mutiple rows, the order of those rows upon return is not deterministic. <code>ORDER BY</code> more columns you care to solve this problem. There is even no guarantee that, the first 5 rows returned by <code>ORDER BY</code></p></li><li><p>When a query is <code>ORDER BY</code> indexed columns, there is no need to really sort anything.</p></li><li><p>When a query is <code>ORDER BY</code> columns not all of which are indexed, a real sorting algorithm is required, and is known as the <code>filesort</code> operation.</p></li></ol><h2 id=temporary-table>Temporary Table</h2><p>Being the non-scalar counterpart of a <a href=../mysql-variable>user-defined variable</a>, a temporary table is used to store the result set of a query that could be useful later.</p><p>Note that <code>CREATE VIEW</code> with <code>ALGORITHM = TEMPTABLE</code> also create a temporary table (TODO).</p><h2 id=locking-select>Locking SELECT</h2><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>FROM</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>WHERE</span> ...
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#66d9ef>FOR</span> [SHARED<span style=color:#f92672>|</span><span style=color:#66d9ef>UPDATE</span>]</span></span></code></pre></div><button>copy</button></div><ul><li>For <code>FOR SHARED</code> select, a S lock will be acquired for all rows involved in the result (consider join), and a IS lock will be acquired for all tables containing those rows.</li><li>For <code>FOR UPDATE</code> select, a X lock will be acquired for all rows involved in the result (consider join), and a IX lock will be acquired for all tables containing those rows.</li></ul><p>For rules regarding whether any such lock acquisition will block, see:
<a href=https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html#innodb-intention-locks>https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html#innodb-intention-locks</a></p><h2 id=subquery>subquery</h2><p>A subquery is a SELECT statement within another statement.</p><p>A subquery can return a scalar (a single value), a single row, a single column, or a table (one or more rows of one or more columns). These are called scalar, column, row, and table subqueries.</p><h2 id=with-clause>with clause</h2><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e>-- INVALID SQL: foo must be re-mentioned in `from` clause
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#75715e></span><span style=color:#66d9ef>with</span> foo <span style=color:#66d9ef>as</span> (<span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> x <span style=color:#66d9ef>where</span> x.<span style=color:#66d9ef>type</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>13</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> bar <span style=color:#66d9ef>where</span> bar.name <span style=color:#f92672>=</span> foo.name</span></span></code></pre></div><button>copy</button></div></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>