<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>MySQL DevOps / Technical Interals | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=hoverable>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=active>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=hoverable>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/db/>Database</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>MySQL DevOps / Technical Interals</h1><p class=aux-text style=margin-top:0>Published at: August 12, 2023
| Last modification: December 10, 2023</p><div style=line-height:2em><span class="page-tag tag-database">database</span>
<span class="page-tag tag-mysql">mysql</span>
<span class="page-tag tag-sql">sql</span></div></div><div><h2 id=data-dictionary>data dictionary</h2><p>MySQL &ldquo;data dictionary&rdquo; is the runtime structure where all important metadata (e.g. views, stored procedure, triggers, user tables columns structure &mldr;) in the current server instance are stored.</p><p>Modern version of MySQL persists the data dictionary also as InnoDB tables, thus providing the same transaction ability and crash-recovery as ordinary user tables. These tables are hidden, and is in the <code>mysql</code> schema. They can only be seen in a debug build (<code>cmake -DWITH_DEBUG=1</code>). The tablespace storing data directory is <code>mysql.ibd</code>, whose name is hardcoded and can&rsquo;t be change.</p><p>Another related schema is the <code>information_schema</code>. It&rsquo;s not a real schema, as it has no corresponding files or schema directory on the filesystem. All tables inside are read-only views (<code>Table_type = SYSTEM VIEW</code>), and can&rsquo;t have triggers. The design feels like the linux pseudo filesystems e.g. <code>/sys</code> or <code>/proc</code>.</p><p>Selecting from views <code>information_schema</code> is meant to be a more consistent way to show metainfo about other databases, comparing to the <code>SHOW</code> family. For example:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e>-- both show all schemas
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#75715e></span><span style=color:#66d9ef>SHOW</span> DATABASES;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>///</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#66d9ef>SHOW</span> TABLES;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#66d9ef>SELECT</span></span></span></code></pre></div><button>copy</button></div><h2 id=doublewrite-buffer>Doublewrite Buffer</h2><p>Before writing to the persistent storage, InnoDB first flush data to a on-disk buffer known as the doublewrite buffer. The primary reason for such design is to prevent &ldquo;torn page&rdquo;. If all changes are directly written to persistent files, a power outage may leave the changes partially written, and there is no way to recover or even discover such error/inconsistency.</p><p>Instead, changes are first written to the doublwrite buffer, which won&rsquo;t be invalidated until the real write succeed. If a fatal failure happen, InnoDB can use what is left in the doublewrite buffer to recover the state.</p><p>Before MySQL 8.0.20, the doublewrite buffer resides inside the system tablespace (<code>ibdata1</code> by default), but now a dedicated doublewrite buffer file is used.</p><p>Some related system variables are:</p><ul><li><code>innodb_doublewrite</code>: boolean for enabling/disabling doublewrite.</li><li><code>innodb_doublewrite_dir</code>: directory to put doublewrite buffer files in; <code>NULL</code> fallback to <code>innodb_data_home_dir</code>, whose being <code>NULL</code> in turn fallback to server data directory (for me <code>/var/lib/mysqld/</code>)</li><li><code>innodb_doublewrite_files</code>: integer; the # of doublewrite buffer files for each buffer pool instance;</li></ul><p>Extra IO to the doublewriter buffer isn&rsquo;t as expensive as one might think, since</p><h2 id=tablespace>Tablespace</h2><p>A tablespace is logical collection of tables and/or indexes (both are b+tree anyway).</p><p>Tablespace is also the unit of disk page management. All pages in the same tablespace are of the same size (default 16KiB).</p><p>1 tablespace corresponds to exactly 1 file under the mysql data directory <code>/var/lib/mysql/</code>. The only exception being the unique system tablespace, which can have more than 1 files, and contains other stuffs like the change buffer. See <a href=https://dev.mysql.com/doc/refman/5.6/en/innodb-system-tablespace.html#innodb-resize-system-tablespace>this</a> for configuring multiple files for the system tablespace.</p><p>Table <code>information_schema.INNODB_TABLESPACES</code> provides info about all tablespaces in the current server instance, except the system tablespace (<code>NAME=innodb_system</code>, the missing 1 below). Table <code>information_schema.FILES</code> show all files managed by the server:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> FILE_ID,FILE_NAME,FILE_TYPE,TABLESPACE_NAME
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>FROM</span> FILES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>WHERE</span> TABLESPACE_NAME <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>IN</span> (<span style=color:#66d9ef>SELECT</span> NAME <span style=color:#66d9ef>FROM</span> INNODB_TABLESPACES);
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>---------+-----------+------------+-----------------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> FILE_ID <span style=color:#f92672>|</span> FILE_NAME <span style=color:#f92672>|</span> FILE_TYPE  <span style=color:#f92672>|</span> TABLESPACE_NAME <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>---------+-----------+------------+-----------------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>0</span> <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>ibdata1 <span style=color:#f92672>|</span> TABLESPACE <span style=color:#f92672>|</span> innodb_system   <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>---------+-----------+------------+-----------------+</span></span></span></code></pre></div><button>copy</button></div><p>To query file(s) used by any tablespace, issue:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>SELECT</span> FILES.TABLESPACE_NAME, FILE_NAME
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#66d9ef>FROM</span> INNODB_TABLESPACES <span style=color:#66d9ef>AS</span> ts <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> FILES 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#66d9ef>ON</span> ts.NAME <span style=color:#f92672>=</span> FILES.TABLESPACE_NAME;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----------------------------+----------------------------------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> TABLESPACE_NAME            <span style=color:#f92672>|</span> FILE_NAME                        <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----------------------------+----------------------------------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> mysql                      <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>mysql.ibd                      <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> innodb_temporary           <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>ibtmp1                         <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> innodb_undo_001            <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>undo_001                       <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> innodb_undo_002            <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>undo_002                       <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> sys<span style=color:#f92672>/</span>sys_config             <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>sys<span style=color:#f92672>/</span>sys_config.ibd             <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> world<span style=color:#f92672>/</span>city                 <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>world<span style=color:#f92672>/</span>city.ibd                 <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> world<span style=color:#f92672>/</span>country              <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>world<span style=color:#f92672>/</span>country.ibd              <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> world<span style=color:#f92672>/</span>countrylanguage      <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>world<span style=color:#f92672>/</span>countrylanguage.ibd      <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> classicmodels<span style=color:#f92672>/</span>customers    <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>classicmodels<span style=color:#f92672>/</span>customers.ibd    <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> classicmodels<span style=color:#f92672>/</span>employees    <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>classicmodels<span style=color:#f92672>/</span>employees.ibd    <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> classicmodels<span style=color:#f92672>/</span>offices      <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>classicmodels<span style=color:#f92672>/</span>offices.ibd      <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> classicmodels<span style=color:#f92672>/</span>orderdetails <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>classicmodels<span style=color:#f92672>/</span>orderdetails.ibd <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> classicmodels<span style=color:#f92672>/</span>orders       <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>classicmodels<span style=color:#f92672>/</span>orders.ibd       <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> classicmodels<span style=color:#f92672>/</span>payments     <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>classicmodels<span style=color:#f92672>/</span>payments.ibd     <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> classicmodels<span style=color:#f92672>/</span>productlines <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>classicmodels<span style=color:#f92672>/</span>productlines.ibd <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> classicmodels<span style=color:#f92672>/</span>products     <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>classicmodels<span style=color:#f92672>/</span>products.ibd     <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> foo<span style=color:#f92672>/</span><span style=color:#66d9ef>user</span>                   <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>foo<span style=color:#f92672>/</span><span style=color:#66d9ef>user</span>.ibd                   <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> foo<span style=color:#f92672>/</span>bar                    <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>foo<span style=color:#f92672>/</span>bar.ibd                    <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>----------------------------+----------------------------------+</span></span></span></code></pre></div><button>copy</button></div><p>3 types of tablespace are presented in the current 8.0.23 MySQL release:</p><ol><li><p>System Tablespace</p><p>The system tablespace stores all important core/runtime information about the server instance itself. Only a single system tablespace instance exists. It contains:</p><ol><li>the change buffer, persisted (CB is itself in memory).</li><li>(optionally) user tables and indexes.</li><li>(legacy) Prior to MysQL 8.0, the data dictionary.</li><li>(legacy) Prior to MySQL 5.6, <strong>all other InnoDB tables</strong>.</li><li>(legacy) Prior to MySQL 8.0.20, the doublewrite buffer.</li></ol><p>The persistent file(s) for the system tablespace is(are) specified by <code>@@innodb_data_file_path</code>.</p></li><li><p>File-per-table Tablespaces</p><p>If <code>innodb_file_per_table</code> is set true, each created table are in their own tablespace. This essentially means that each table corresponds to a file on your filesystem. Such organization allows some useful features to be realized (off-page column);</p><ol><li>clustered index(es) and secondary index(es) of 1 or more tables;</li></ol></li><li><p>General tablespaces</p><p>A General tablespace can be created by users using the SQL syntax:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>CREATE</span> TABLESPACE ...</span></span></code></pre></div><button>copy</button></div><p>One important general tablespace being the mysql data dictionary:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#66d9ef>SELECT</span> NAME,ts.ROW_FORMAT,SPACE_TYPE,FS_BLOCK_SIZE,FILE_SIZE,ALLOCATED_SIZE,FILE_NAME
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>FROM</span> INNODB_TABLESPACES <span style=color:#66d9ef>AS</span> ts <span style=color:#66d9ef>INNER</span> <span style=color:#66d9ef>JOIN</span> FILES <span style=color:#66d9ef>ON</span> ts.NAME<span style=color:#f92672>=</span>FILES.TABLESPACE_NAME
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#66d9ef>WHERE</span> SPACE_TYPE<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;General&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-------+------------+------------+---------------+-----------+----------------+-------------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> NAME  <span style=color:#f92672>|</span> ROW_FORMAT <span style=color:#f92672>|</span> SPACE_TYPE <span style=color:#f92672>|</span> FS_BLOCK_SIZE <span style=color:#f92672>|</span> FILE_SIZE <span style=color:#f92672>|</span> ALLOCATED_SIZE <span style=color:#f92672>|</span> FILE_NAME   <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-------+------------+------------+---------------+-----------+----------------+-------------+
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span><span style=color:#75715e></span><span style=color:#f92672>#</span> <span style=color:#f92672>|</span> mysql <span style=color:#f92672>|</span> <span style=color:#66d9ef>Any</span>        <span style=color:#f92672>|</span> <span style=color:#66d9ef>General</span>    <span style=color:#f92672>|</span>          <span style=color:#ae81ff>4096</span> <span style=color:#f92672>|</span>  <span style=color:#ae81ff>25165824</span> <span style=color:#f92672>|</span>       <span style=color:#ae81ff>25169920</span> <span style=color:#f92672>|</span> .<span style=color:#f92672>/</span>mysql.ibd <span style=color:#f92672>|</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span><span style=color:#f92672>#</span> <span style=color:#f92672>+</span><span style=color:#75715e>-------+------------+------------+---------------+-----------+----------------+-------------+</span></span></span></code></pre></div><button>copy</button></div></li></ol><h2 id=raw-disk-partition>Raw Disk Partition</h2><p><a href=https://dev.mysql.com/doc/refman/8.0/en/innodb-system-tablespace.html#innodb-raw-devices>https://dev.mysql.com/doc/refman/8.0/en/innodb-system-tablespace.html#innodb-raw-devices</a></p><p>It is possible to let InnoDB take over a whole disk partition without filesystem and use that as the <strong>system tablespace</strong>. Other tablespaces are not supported.</p><p>Whether that will bring a performance boost is uncertain. Filesystem overheads are usually very low.</p></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>