<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Name Service Switch (NSS) | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=hoverable>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=hoverable>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=active>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/linux/>GNU/Linux</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>Name Service Switch (NSS)</h1><p class=aux-text style=margin-top:0>Published at: September 11, 2023
| Last modification: June 21, 2024</p><div style=line-height:2em></div></div><div><p>The Name Service Switch (NSS) is a convention in *NIX systems stating that the lookup order of certain administrative
information should be configurable in a <code>/etc/nsswitch.conf</code> file.</p><p>The NSS workflow introduced in this article was first invented by the Ultrix developer in 1984 but the config file was <code>/etc/svc.conf</code>.
Oracle Solaris was released in 1992 and was the first to call this pattern <a href=https://docs.oracle.com/cd/E19455-01/806-1386/index.html>Name Service Switch</a>.</p><p>GNU/Linux was actually late to the party. GNU glibc implemented NSS in version 2.4 (2006-03-06).
Before that, a keyword <code>order</code> existed in the <code>/etc/host.conf</code> file to control DNS lookup order.
(This file is still important nowadays for other configs).</p><p>It&rsquo;s a common misunderstanding in the Linux world that NSS is a subsystem of GNU glibc. It is not.
The glibc is only one software, among others, that respects the <code>nsswitch.conf</code> config file for some APIs it provides.</p><h2 id=etcnsswitchconf-file><code>/etc/nsswitch.conf</code> file</h2><p>Administrative information is organized into databases.
A local admin decides the sources of data, each known as a <em>service</em>,
when a database is queried by configuring the <code>/etc/nsswitch.conf</code> file.</p><p>By convention, each line of this takes the format:</p><div class=codeblock-hook><pre tabindex=0><code>&lt;database name&gt;:          service1 service2 ...</code></pre><button>copy</button></div><p>It is then the supporting software&rsquo;s responsibility to parse the file and determine
what to do with each line.</p><p>Below are 2 example <code>nsswitch.conf</code> files:</p><div class=columns-flex-container><div style=flex:1><h3 id=archlinux-stock>ArchLinux stock</h3><div class=codeblock-hook><pre tabindex=0><code class=language-nss data-lang=nss># Name Service Switch configuration file.
# See nsswitch.conf(5) for details.

passwd: files systemd
group: files [SUCCESS=merge] systemd
shadow: files systemd
gshadow: files systemd

publickey: files

hosts: mymachines resolve [!UNAVAIL=return] files myhostname dns
networks: files

protocols: files
services: files
ethers: files
rpc: files

netgroup: files</code></pre><button>copy</button></div></div><div style=flex:1><h3 id=redhat-vm>Redhat VM</h3><div class=codeblock-hook><pre tabindex=0><code class=language-conf data-lang=conf>passwd:         files sss
group:          files sss
shadow:         files sss
gshadow:        files sss

hosts:          files mdns4_minimal [NOTFOUND=return] dns mymachines
networks:       files

protocols:      db files
services:       db files
ethers:         db files
rpc:            db files

netgroup:       sss
automount:      sss</code></pre><button>copy</button></div></div></div><h2 id=glibcs-behavior>glibc&rsquo;s behavior</h2><p>For glibc, the following database names are recognized:</p><div class=raw-html><table><thead><tr><td>database name</td><td><code>file</code> service source (see below)</td><td>remarks</td></tr></thead><tbody><tr><td>aliases</td><td><code>/etc/aliases</code></td><td>Mail aliases</td></tr><tr><td>ethers</td><td></td><td><code>/etc/ethers</code></td><td>Ethernet numbers.</td></tr><tr><td>group</td><td><code>/etc/group</code></td><td>Groups of users</td></tr><tr><td>hosts</td><td><code>/etc/hosts</code></td><td>Host names and numbers</td></tr><tr><td>initgroups</td><td><code>/etc/group</code></td><td>Supplementary group access list</td></tr><tr><td>netgroup</td><td></td><td><code>/etc/netgroup</code></td><td>Network-wide list of hosts and users, used for access rules. C libraries before glibc 2.1 supported
netgroups only over NIS.</td></tr><tr><td>networks</td><td><code>/etc/networks</code></td><td>Network names and numbers</td></tr><tr><td>passwd</td><td><code>/etc/passwd</code></td><td>User passwords</td></tr><tr><td>protocols</td><td><code>/etc/protocols</code></td><td>Network protocols</td></tr><tr><td>publickey</td><td></td><td><code>/etc/publickey</code></td><td>Public and secret keys for Secure_RPC used by NFS and NIS+.</td></tr><tr><td>rpc</td><td><code>/etc/rpc</code></td><td>Remote procedure call names and numbers</td></tr><tr><td>services</td><td><code>/etc/services</code></td><td>Network services</td></tr><tr><td>shadow</td><td>shadow-utils <code>getspnam(3)</code></td><td><code>/etc/shadow</code></td><td>Shadow user passwords</td></tr></tbody></table></div><p>For each <code>SERVICE</code> mentioned for a given database, glibc will <code>dlopen(3)</code> a shared object named <code>libnss_SERVICE.so.X</code>,
whose code is responsible for providing actual answers to queries against the database.</p><p>These are some commonly seen services and their shared objects:</p><div class=raw-html><table><thead><tr><td>service</td><td>shared object</td><td>from package</td><td>semantics</td></tr></thead><tbody><tr><td>compat</td><td><code>/lib/libnss_compat.so.X</code></td><td>glibc</td><td></td></tr><tr><td>db</td><td><code>/lib/libnss_db.so.X</code></td><td>glibc</td><td>TODO</td></tr><tr><td>dns</td><td><code>/lib/libnss_dns.so.X</code></td><td>glibc</td><td>TODO</td></tr><tr><td>files</td><td><code>/lib/libnss_files.so.X</code></td><td>glibc</td><td>TODO</td></tr><tr><td>hesiod</td><td><code>/lib/libnss_hesiod.so.X</code></td><td>glibc</td><td>TODO</td></tr><tr><td>nis</td><td><code>/lib/libnss_nis.so.X</code></td><td><a href=https://github.com/thkukuk/libnss_nis></a></td></tr><tr><td>nisplus</td><td><code>/lib/libnss_nisplus.so.X</code></td><td><p>Isolated from <a href=https://github.com/thkukuk/libnss_nisplus></a></p><p>This module is now deprecated. Its maintanence ceased.</p></td></tr><tr><td>sss</td><td><code>libnss_sss.so.2</code></td><td><a href=https://archlinux.org/packages/extra/x86_64/sssd/>sssd</a></td><td></td></tr><tr><td>mdns*_*</td><td><pre>
libnss_mdns4_minimal.so.2
libnss_mdns4.so.2
libnss_mdns6_minimal.so.2
libnss_mdns6.so.2
libnss_mdns_minimal.so.2
libnss_mdns.so.2
                </pre></td><td><a href=https://archlinux.org/packages/extra/x86_64/nss-mdns/>nss-mdns</a></td><td>TODO</td></tr><tr><td>systemd</td><td><code>libnss_systemd.so.2</code></td><td></td><td></td></tr></tbody></table></div><p>On my system, these are installed:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e># /usr/lib $ ls -ahl $(find -name &#39;libnss_*&#39;)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>18</span> Feb  <span style=color:#ae81ff>2</span> 01:38 ./libnss_compat.so -&gt; libnss_compat.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root  43K Feb  <span style=color:#ae81ff>2</span> 01:38 ./libnss_compat.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>14</span> Feb  <span style=color:#ae81ff>2</span> 01:38 ./libnss_db.so -&gt; libnss_db.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root  35K Feb  <span style=color:#ae81ff>2</span> 01:38 ./libnss_db.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root  14K Feb  <span style=color:#ae81ff>2</span> 01:38 ./libnss_dns.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root  14K Feb  <span style=color:#ae81ff>2</span> 01:38 ./libnss_files.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>18</span> Feb  <span style=color:#ae81ff>2</span> 01:38 ./libnss_hesiod.so -&gt; libnss_hesiod.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root  23K Feb  <span style=color:#ae81ff>2</span> 01:38 ./libnss_hesiod.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root 163K Mar  <span style=color:#ae81ff>4</span> 01:04 ./libnss_myhostname.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root 349K Mar  <span style=color:#ae81ff>4</span> 01:04 ./libnss_mymachines.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root 175K Mar  <span style=color:#ae81ff>4</span> 01:04 ./libnss_resolve.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root 379K Mar  <span style=color:#ae81ff>4</span> 01:04 ./libnss_systemd.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root  27K Feb <span style=color:#ae81ff>19</span> 22:36 ./libnss_winbind.so.2
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root  23K Feb <span style=color:#ae81ff>19</span> 22:36 ./libnss_wins.so.2</span></span></code></pre></div><button>copy</button></div><p>The listed order of services is significant. For a given database, its listed services form a <a href=https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern>Chain-of-responsibility pattern</a>. Besides answers to the query (if any), a service also returns an enum value indicating the status of this lookup.
The <code>enum</code> is defined glibc&rsquo;s <code>nss/nss.h</code>:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e>/* Possible results of lookup using a nss_* function.  */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#66d9ef>enum</span> nss_status
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>  NSS_STATUS_TRYAGAIN <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>  NSS_STATUS_UNAVAIL,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>  NSS_STATUS_NOTFOUND,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>  NSS_STATUS_SUCCESS,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>  NSS_STATUS_RETURN
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>};</span></span></code></pre></div><button>copy</button></div><p>Glibc decides what to do with the answer produced by a service depending on the returned status enum.
By default:</p><table><thead><tr><th>enum nss_status</th><th>cause glibc to &mldr;</th></tr></thead><tbody><tr><td><code>NSS_STATUS_TRYAGAIN</code></td><td>ignore the answer, and consult the next service down the chain</td></tr><tr><td><code>NSS_STATUS_UNAVAIL</code></td><td>ignore the answer, and consult the next service down the chain</td></tr><tr><td><code>NSS_STATUS_NOTFOUND</code></td><td>ignore the answer, and consult the next service down the chain</td></tr><tr><td><code>NSS_STATUS_SUCCESS</code></td><td>return the answer immediately</td></tr><tr><td><code>NSS_STATUS_RETURN</code></td><td>GLIBC INTERNAL USE ONLY.</td></tr></tbody></table><p>These default behavior can be overridden by an extended syntax supported by glibc and Solaris:</p><div class=codeblock-hook><pre tabindex=0><code>&lt;database name&gt;:          service1 [status=action] service2 [status=action] ...</code></pre><button>copy</button></div><p><code>action</code> will be taken when the return status of the <em>previous</em> service matches <code>status</code>, instead of the default behavior.
A <code>!</code> preceding <code>status</code>, e.g. <code>[!UNAVAIL=return]</code>, negates the condition.</p><p>Permitted values of <code>status</code> are:</p><div class=codeblock-hook><pre tabindex=0><code>STATUS =&gt; success | notfound | unavail | tryagain</code></pre><button>copy</button></div><p>which corresponds to the macros above in an obvious way.</p><p>Permitted values of <code>action</code> are:</p><div class=codeblock-hook><pre tabindex=0><code>ACTION =&gt; return | continue | merge</code></pre><button>copy</button></div><p>where <code>return</code> means to return the answer of the previous service immediately, and <code>continue</code> discards that answer
and consult the next service.</p><p><code>merge</code> is only valid as <code>[SUCCESS=merge]</code>, and causes the answers from both the previous service and the next service to be merged before returning to the API caller.</p><h2 id=considerations-for-other-software>Considerations for Other Software</h2><p>Newly written applications usually choose to use their own configuration files for things like lookup orders.
There is no good reason to keep using <code>nsswitch.conf</code> unless you are hailing to the tradition.</p><p>Historical applications respect <code>/etc/nsswitch.conf</code> for various reasons.
Most of them were written for Solaris and OpenBSD and were later ported to GNU/Linux.</p><p>An application that uses <code>nsswitch.conf</code> for certain lookup order configurations
must parse the file on its own for a line that contains the database name they care about.
It&rsquo;s completely under such applications&rsquo; jurisdiction what to do with text in that line.</p><p>In all situations, glibc provides no utility that helps such an application to work with such parsing.</p><p>For example</p><ul><li>The <code>shadow-utils</code> package <a href=https://github.com/sudo-project/sudo/blob/f0823c70c6c220322cae3a7dae9500df252f990c/plugins/sudoers/sudo_nss.c#L162>parses for a line containing <code>subid</code> database</a>, then tries <code>dlopen()</code> a <code>libsubid_SERVICE.so</code>
for each mentioned <code>SERVICE</code>.</li><li>The <code>sudo</code> package <a href=https://github.com/shadow-maint/shadow/blob/dc12e87fe78a79f7240b8b26ea4e33659f4c768c/lib/nss.c#L66>parses for a line containing <code>sudoers</code> database</a>, where each <code>SERVICE</code> corresponds to a different function
that returns the desired data - no other object is involved.</li></ul><p>Common databases and their supporting software included:</p><table><thead><tr><th>database name</th><th>supported by</th><th>semantics</th></tr></thead><tbody><tr><td>gshadow</td><td>shadow-utils</td><td></td></tr><tr><td>sudoers</td><td></td><td></td></tr><tr><td>sudoers</td><td></td><td></td></tr><tr><td>sudoers</td><td></td><td></td></tr></tbody></table><h2 id=etcdefaultnss><code>/etc/default/nss</code></h2><h2 id=rant--misc>Rant & Misc</h2><p>I&rsquo;d like to point out the fact that these databases are disparate in their nature, yet still managed by the same NSS subsystem.
and the <em>Name Service</em> Switch name doesn&rsquo;t reflect its current API.</p><p>Also, this article only talks about glibc&rsquo;s . Other packages such as the sudo and shadow-utils</p><p>The <code>database</code> keyword of <code>getent(1)</code> program accepts more database names then noted here.
Not all these databases are</p><hr><p>In the *NIX programming environment, certain administrative configurations of the local machine should be queried at run time,
instead of being hardcoded (if even possible at all). Examples are:</p><ol><li><p>user or group information</p></li><li><p>the TCP or UDP port an application-layer protocol should use (IANA assignment)</p><p>If you are the server author, say redis, in this case it&rsquo;s indeed possible to hardcode the port number and protocol to use,
instead of querying the IANA assignment <code>redis 6379/tcp</code></p><p><a href=https://unix.stackexchange.com/a/593722/245241>https://unix.stackexchange.com/a/593722/245241</a></p></li><li><p>the numeric ID of an IP-layer protocol (e.g. TCP or UDP)</p></li><li><p>resolve a domain name to its IP address</p></li></ol><p>This is handled by</p><p>The reason for its name, i.e. <em>Name Service</em> Switch, despite the fact that</p><p>mapping from a to its corresponding value (e.g. a , etc.) is required.</p><p>Despite</p><p>The approach taken by GNU GLIBC implementation is providing</p><p>There is an attempt in that unify the interface of all such query, knwon .
To the author, whether this is an premature optimization or over-engineering remains to be a question,
but this article still introduce it as-is since it&rsquo;s simply out there available.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># ls /usr/lib/libnss* -al</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1258120</span> Feb <span style=color:#ae81ff>18</span> 01:14 /usr/lib/libnss3.so     <span style=color:#75715e># Network Security Service</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root      <span style=color:#ae81ff>16</span> Feb <span style=color:#ae81ff>18</span> 01:14 /usr/lib/libnssckbi.so -&gt; p11-kit-trust.so      <span style=color:#75715e>#libnssckbi</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root   <span style=color:#ae81ff>14288</span> Feb <span style=color:#ae81ff>18</span> 01:14 /usr/lib/libnsssysinit.so   <span style=color:#75715e># Network Security Services-sysinit</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root  <span style=color:#ae81ff>178368</span> Feb <span style=color:#ae81ff>18</span> 01:14 /usr/lib/libnssutil3.so     <span style=color:#75715e># Network Security Services</span></span></span></code></pre></div><button>copy</button></div></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>