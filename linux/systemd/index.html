<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Systemd Overview | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=hoverable>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=hoverable>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=active>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/linux/>GNU/Linux</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>Systemd Overview</h1><p class=aux-text style=margin-top:0>Published at: July 11, 2023
| Last modification: December 20, 2023</p><div style=line-height:2em></div></div><div><h2 id=overview>Overview</h2><ul><li>unit: vertex in the dependency graph</li><li>job: a request for state change to a unit; each unit has a job queue.</li></ul><p>11 types of units:</p><table><thead><tr><th>unit type</th><th>man page</th><th></th><th>Notable instance</th></tr></thead><tbody><tr><td>Service</td><td><code>systemd.service(5)</code></td><td>- which start and control daemons and the processes they consist of.</td><td>privoxy.service</td></tr><tr><td>Socket</td><td><code>systemd.socket(5)</code></td><td>Start another <code>.service</code> unit when certain socket has incoming traffic, i.e. <code>inetd</code> replacement</td><td><code>dbus.socket</code></td></tr><tr><td></td><td></td><td>- which encapsulate local IPC or network sockets in the system, useful for socket-based activation.</td><td></td></tr><tr><td></td><td></td><td>- For details about socket units, see &mldr; , for details on socket-based activation and other forms of activation, see daemon(7).</td><td></td></tr><tr><td>Target</td><td><code>systemd.target(5)</code></td><td><code>.target</code> solely exists to be pulled in as dependencies of other units. Serve as synchronization points during parallel boot-up.</td><td><code>graphical.target</code></td></tr><tr><td>Device</td><td><code>systemd.device(5)</code></td><td>- expose kernel devices in systemd and may be used to implement device-based activation.</td><td><code>sys-devices-pci0000:00-0000:00:02.4-0000:04:00.0-nvme-nvme1-nvme1n1-nvme1n1p2.device</code></td></tr><tr><td>Mount</td><td><code>systemd.mount(5)</code></td><td>Mount a (real or virtual) filesystem.</td><td>-.mount</td></tr><tr><td>Automount</td><td><code>systemd.automount(5)</code></td><td>On-demand mounting: start a <code>.mount</code> unit when certain path is accessed. (parallelized boot-up)</td><td>roc-sys-fs-binfmt_misc.automount</td></tr><tr><td>Timer</td><td><code>systemd.timer(5)</code></td><td>- are useful for triggering activation of other units based on timers.</td><td>fuck.timer</td></tr><tr><td>Swap</td><td><code>systemd.swap(5)</code></td><td>- are very similar to mount units and encapsulate memory swap partitions or files of the operating system.</td><td>fuck.swap</td></tr><tr><td>Path</td><td><code>systemd.path(5)</code></td><td>Watch certain FS path, and start other units when watched FS object change.</td><td></td></tr><tr><td>Slice</td><td><code>systemd.slice(5)</code></td><td>- may be used to group units which manage system processes (such as service and scope units)</td><td>system.slice</td></tr><tr><td></td><td></td><td>- in a hierarchical tree for resource management purposes.</td><td></td></tr><tr><td>Scope</td><td><code>systemd.scope(5)</code></td><td>- are similar to service units, but manage foreign processes instead of starting them as well.</td><td>init.scope</td></tr></tbody></table><h2 id=unit-lifecycle>Unit lifecycle</h2><h3 id=activeness>activeness</h3><p>All types of systemd unit share these generic states (activeness):</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>    &lt;----- deactivating &lt;-----
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    |                        |
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>inactive -&gt; activating -&gt; active
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>                |
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>                V
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>              failed</span></span></code></pre></div><button>copy</button></div><h3 id=loaded-ness>loaded-ness</h3><p>A unit are said to be &ldquo;loaded into memory&rdquo; or simply &ldquo;loaded&rdquo; if</p><ul><li>it&rsquo;s in <em>active</em> state</li><li>it has an job queue</li><li></li><li>some other loaded unit(s) depend on it</li></ul><p>To the end user, this is rather a transparent (and weird and poor) design,
since not-yet-loaded unit will be loaded upon they are inspected e.g. by <code>systemctl status &lt;not-yet-loaded unit></code>, and immediately unloaded then, since it&rsquo;s not needed anymore.
This is why you always see <code>loaded</code> in the output of the above command.</p><p><em>(Rant: Systmed people you&rsquo;re exposing a burdening internal concept that doesn&rsquo;t matter to end user and making schodinger&rsquo;s cat!)</em></p><h2 id=dependency--the-workflow-engine>Dependency & The workflow engine</h2><ul><li><p><em>requirement</em> dependency</p><p><strong>UNORDERED</strong> edge established via</p><ul><li><code>Requires=</code>,<code>RequiredBy=</code></li><li><code>Requisite=</code>, <code>RequisiteOf=</code></li><li><code>Wants=</code>, <code>WantedBy=</code>, and</li><li><code>Conflicts=</code>, <code>ConflictedBy=</code></li></ul></li><li><p><em>ordering</em> dependency</p><p>ordered edge established via <code>Before=</code> and <code>After=</code></p></li></ul><p>Unit file declare dependency on other units in its <code>[Install]</code> section.</p><p>Booting:</p><ol><li>Start from <code>default.target</code>, compute the transitive closure following all directed edges formed by <em>forward requirement dependencies</em>.</li><li></li></ol><p>Then systemd tries to parallelly start as much units as possible,
but repsect all the ordering dependencies.</p><blockquote><p>Also note that the majority of dependencies are implicitly created and maintained by systemd.
In most cases, it should be unnecessary to declare additional dependencies manually, however it is possible to do this.</p></blockquote><h3 id=explicit-dependencies>Explicit Dependencies</h3><h3 id=implicit-dependencies>Implicit Dependencies</h3><h3 id=transaction>Transaction</h3><h2 id=cli-cheatsheet>CLI cheatsheet</h2><h3 id=edit-vendor-unit-files>Edit vendor unit files</h3><p>Many occasions admin may find it necessary to edit vanilla unit files provided by package vendors. Best practice suggested by systemd is to use the drop-in mechanism, and not touch the original unit file.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>systemctl edit &lt;unit name&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e># Query vendor units which are extended by drop-in directories</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>systemd-delta</span></span></code></pre></div><button>copy</button></div><h3 id=dump-all-known-unit-files>Dump all known unit files</h3><div class=codeblock-hook><pre tabindex=0><code>systemctl list-unit-files</code></pre><button>copy</button></div><h3 id=dump-all-units-in-memory>Dump all units in memory</h3><p>regardless of whether the unit is from a unit file / an instantiated template / or programmatically generated.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># list active / jobs-pending / failed units</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>systemctl list-units &lt;glob pattern&gt;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>systemctl list-units --all &lt;glob pattern&gt;</span></span></code></pre></div><button>copy</button></div><h3 id=print-unit-file-by-unit-name>Print unit file by unit name</h3><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>systemctl cat efi.mount</span></span></code></pre></div><button>copy</button></div><h3 id=list-dependencies--dependants-ie-reverse-dependencies>list dependencies & dependants (i.e. reverse dependencies)</h3><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># list units that systemd-logind.service depends on</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>systemctl list-dependencies systemd-logind.service
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e># list units that depend on systemd-logind.service</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>systemctl list-dependencies systemd-logind.service --reverse
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#75715e># Plot graph</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>systemd-analyze dot systemd-logind.service | dot -Tsvg &gt; logind.svg</span></span></code></pre></div><button>copy</button></div><h2 id=cgroup-interoperability>cgroup interoperability</h2><p>Systemd has moved away from cgroup v1. Only cgroupv2 behavior is discussed.</p><p>If a unit spawn a process (e.g. service <code>ExecStart=</code>), systemd fork-exec the process into a new cgroup named after that unit.</p><p>Processes spawned by each service unit live in their own cgroup named after the service unit.
e.g. <code>/sys/fs/cgroup/system.slice/NetworkManager.service</code> is the cgroup holding the processes of gnome&rsquo;s NetworkManager.</p><h2 id=critical-units>Critical Units</h2><h2 id=defaulttarget><code>default.target</code></h2><p>The target to reach on each boot. Usually <code>[Install].aliases</code>-ed of <code>multi-user.target</code> or <code>graphical.target</code>, but it&rsquo;s the admin&rsquo;s discretion to make whatever it is.</p><h3 id=logind>logind</h3><p><code>systemd-logind.service</code> is <em>wanted</em> by <code>multi-user.target</code>:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># ls /usr/lib/systemd/system/multi-user.target.wants/</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>dbus.service  systemd-ask-password-wall.path  systemd-user-sessions.service
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>getty.target  systemd-logind.service</span></span></code></pre></div><button>copy</button></div><p>Unit file <code>/usr/lib/systemd/system/systemd-logind.service</code> defines the service. It will start the binary:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># ...</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#a6e22e>ExecStart</span><span style=color:#f92672>=</span><span style=color:#e6db74>/usr/lib/systemd/systemd-logind</span></span></span></code></pre></div><button>copy</button></div><h2 id=the-boot-target>The boot target</h2><p>systemd boot to the first target found in:</p><ol><li><p>Kernel parameter <code>systemd.unit=&lt;target name></code></p></li><li><p>Symlink of <code>/etc/systemd/system/default.target</code></p><p>Admin should change this link if changing the boot target is desired.</p></li><li><p>Symlink of <code>/usr/lib/systemd/system/default.target</code></p><p>Distro vendor provide this link, and modification is not recommended.</p></li></ol><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># query computed boot target</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>systemctl get-default
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#75715e># change or create /etc/systemd/system/default.target</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>systemctl set-default &lt;target name&gt;</span></span></code></pre></div><button>copy</button></div><h2 id=auto-generated-unit>auto-generated unit</h2><ol><li>For each mount point <code>/foo/bar</code> defined in <code>/etc/fstab</code>, a <code>foo-bar.mount</code> unit will be generated, with the exception of the root fs becoming <code>-.mount</code>.</li><li>For each device (?), . e.g. <code>sys-devices-pci0000:00-0000:00:01.1-0000:01:00.0-nvme-nvme0-nvme0n1-nvme0n1p5.device</code> is partition for my root fs, and
<code>sys-devices-pci0000:00-0000:00:01.2-0000:02:00.0-0000:03:05.0-0000:06:00.0-net-enp6s0.device</code> and <code>sys-subsystem-net-devices-enp6s0.device</code> are for the ethernet NIC.</li></ol><h2 id=compatibility-with-sysvinit>Compatibility with SysVinit</h2><ol><li><p>systemd can parse initrc scripts as an alternative config file format.</p></li><li><p>The old <code>init</code> is now symlink to the <code>systemd</code> executable:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># ls -hl `which init`</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>22</span> Apr <span style=color:#ae81ff>29</span> 03:36 /usr/bin/init -&gt; ../lib/systemd/systemd</span></span></code></pre></div><button>copy</button></div></li><li><p>Modern distros may choose not to provide the <code>telinit</code> symlink to <code>systemd</code>.</p></li><li><p>Several old executables / scripts from SysVinit is now symlink to <code>systemctl</code>:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># find -L /usr/bin -samefile `which systemctl` -exec ls -l {} +</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root      <span style=color:#ae81ff>9</span> Apr <span style=color:#ae81ff>29</span> 03:36 /usr/bin/halt -&gt; systemctl
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root      <span style=color:#ae81ff>9</span> Apr <span style=color:#ae81ff>29</span> 03:36 /usr/bin/poweroff -&gt; systemctl
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root      <span style=color:#ae81ff>9</span> Apr <span style=color:#ae81ff>29</span> 03:36 /usr/bin/reboot -&gt; systemctl
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>lrwxrwxrwx <span style=color:#ae81ff>1</span> root root      <span style=color:#ae81ff>9</span> Apr <span style=color:#ae81ff>29</span> 03:36 /usr/bin/shutdown -&gt; systemctl
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>-rwxr-xr-x <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>272768</span> Apr <span style=color:#ae81ff>29</span> 03:36 /usr/bin/systemctl</span></span></code></pre></div><button>copy</button></div></li><li><p>SysVinit runlevels that held a defined meaning (i.e., 0, 1, 3, 5, and 6) have a 1:1 mapping with a specific systemd target, but user-defined runlevels 2 and 4 don&rsquo;t have a corresponding systemd target.</p></li></ol><h2 id=unit-file-disovery--precedence>Unit file disovery & precedence</h2><p>Unit files are searched orderly in a list of paths determined at compilation time. To change it you need to change <code>src/core/systemd.pc.in::systemd_system_unit_path</code> and hack into <code>src/basic/path-lookup.c::lookup_paths_init()</code>.</p><p><code>man 5 systemd.unit $ UNIT FILE LOAD PATH</code> is hardcoded, but is generally faithful for distros that aren&rsquo;t heavily modified.</p><p>To dump the exact paths from a running instance, use</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e># for pid 1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>systemd-analyze --system unit-paths
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#75715e># for systemd user instance of current login user</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>systemd-analyze --user unit-paths
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e># or equivalently</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#75715e># for pid 1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>systemctl show --property<span style=color:#f92672>=</span>UnitPath | tr <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#e6db74>&#39;\n&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#75715e># for systemd user instance of current login user</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>systemctl --user show --property<span style=color:#f92672>=</span>UnitPath | tr <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#e6db74>&#39;\n&#39;</span></span></span></code></pre></div><button>copy</button></div><p>Conventionally, for the system instance, 2 main locations are:</p><ul><li><code>/usr/lib/systemd/system/</code>: units provided by distro vendor and later installed packages, used by the system instance.</li><li><code>/etc/systemd/system/</code>: units authored by the system admin, used by the system instance.</li></ul><p>For the user instance, are:</p><ul><li><code>~/.config/systemd/user/</code>: units authored by current user, and used by the user instance of current user.</li><li><code>/usr/lib/systemd/user/</code>: units provided by distro vendor and later installed packages, may be used by the systemd user instance of all users.</li><li><code>/etc/systemd/user/</code>: units authored by the system admin, may be used by the systemd user instance of all users.</li></ul><h2 id=unit-file-naming>unit file naming</h2><p>file name of unit files must conform to the pattern <code>prefix[@].suffix</code>:</p><ul><li>prefix is <code>[a-zA-Z0-9]</code> plus <code>[:-_.\]</code>; i.e multiple dot-separated segments is allowed, e.g. <code>dbus-org.freedesktop.network1.service</code>.</li><li>presence of <code>@</code> makes it a <em>unit template file</em>.</li><li>suffix must be one of <code>service|socket|target|device|mount|automount|timer|swap|path|slice|scope</code>, corresponding to 11 unit types, and determines which type the unit belongs to.</li></ul><h2 id=misc>misc</h2><h3 id=unit-template>unit template</h3><p>The argument (a.k.a instance name) is refered by <code>%i</code> in unit files.</p><h3 id=drop-in-directory>Drop-in Directory</h3><p>All <code>*.conf</code> inside <code>foo.service.d/</code> directory will be merged into <code>foo.service</code> (or become, if no such file exist).</p><blockquote><p>This is useful to alter or add configuration settings for a unit, without having to modify / parse existing unit files.</p></blockquote><h3 id=dependency-aux-directory>Dependency Aux Directory</h3><p>For <code>foo.service</code>,</p><ul><li>all symlinks in <code>foo.service.wants</code> are treated as <code>Wants=</code></li><li>all symlinks in <code>foo.service.requires</code> are treated as <code>Requires=</code></li></ul><blockquote><p>This functionality is useful to hook units into the start-up of other units, without having to modify their unit files.</p></blockquote><blockquote><p>The preferred way to create symlinks in the .wants/ or .requires/ directory of a unit file is by embedding the dependency in <code>[Install]</code> section of the target unit, and creating the symlink in the file system with <code>systemctl enable | preset</code>.</p></blockquote><h2 id=writing-unit-file>Writing Unit File</h2><h3 id=common-configs>Common Configs</h3><p><code>[Unit]</code> and <code>[Install]</code> sections are common for of all 11 types of units.</p><h4 id=unit-notable-options><code>[Unit]</code> notable options</h4><ul><li><p><code>Alias=foo,bar</code></p><p>space-separated list of alias name. Upon <code>systemctl enable</code>,</p></li><li><p><code>Wants=</code>, <code>WantedBy=</code></p><p>&ldquo;Start&rdquo;</p><p>space-separated list of weak dependencies on other units.</p><p>Weak dependencies should start if the configuring unit starts. But if any weak dependencies failed to start,</p></li><li><p><code>Requires=</code>, <code>RequiredBy=</code></p><p>&ldquo;What must already be running if the current unit is to be started.&rdquo;</p></li><li><p><code>Before=</code>, <code>After=</code></p><p>Order precondition check.</p><p>Unlike <code>Wants=</code>, <code>Before=</code> won&rsquo;t cause other unit to start.</p><p>Unlike <code>Requires=</code>,</p><p>Unsatisfied <code>After=</code> will simply hangs or reject. Unsatisfied <code>After=</code></p></li></ul><h4 id=install-notable-options><code>[Install]</code> notable options</h4><p><code>[Install]</code> section describes what must be performed upon unit enablement / disablement. This section is not respected in other lifecycle phases.</p><h3 id=automount>automount</h3><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>mount | grep binfmt
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#75715e># systemd-1 on /proc/sys/fs/binfmt_misc type autofs (rw,relatime,fd=30,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=13428)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>cd /proc/sys/fs/binfmt_misc/
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>ls
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e># register  status</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>/proc/sys/fs/binfmt_misc $ mount | grep binfmt
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#75715e># systemd-1 on /proc/sys/fs/binfmt_misc type autofs (rw,relatime,fd=30,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=13428)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#75715e># binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,nosuid,nodev,noexec,relatime)</span></span></span></code></pre></div><button>copy</button></div><h3 id=target>target</h3><p>It&rsquo;s a common pattern for a target unit to <code>Requires=</code> <strong>and</strong> <code>After=</code> on other target units, thus extend low-level targets with new units (service, etc.). Thus multiple target units may be active at the same time.</p><h3 id=service>Service</h3><h4 id=type><code>Type=</code></h4><p>Service unit usually starts a daemon process. In order for systemd to track the daemon process, unit author needs to manually specify the type of this service unit in <code>[Service].Type</code>:</p><ul><li><p><code>Type=simple</code> (default)</p><ol><li>systemd considers this type of service started up immediately once systemd successfully fork-exec <code>ExecStart=</code>.</li><li>The process of <code>ExecStart=</code> must not fork.</li></ol><p>Do not use this type if other services need to be ordered on this service, unless it is socket activated.</p></li><li><p><code>Type=forking</code></p><ol><li>systemd considers this type of service started up once the <code>ExecStart=</code> process itself forks and the parent has exited. <strong>This is the classic pattern for daemons.</strong></li><li>You should specify <code>PIDFile=</code> as well so systemd can keep track of the main process.</li></ol></li><li><p><code>Type=oneshot</code></p><ol><li>this is useful for scripts that do a single job and then exit.</li><li>If <code>RemainAfterExit=yes</code> (defaults to <code>no</code>), systemd will consider the service as active after the process has exited.</li></ol></li><li><p><code>Type=notify</code></p><ol><li>Like <code>Type=simple</code> in that <code>ExecStart=</code> process itself won&rsquo;t fork, but promises the daemon will send a signal to <code>systemd</code> when it is ready.</li><li>The reference implementation for this notification is provided by libsystemd-daemon.so.</li></ol></li><li><p><code>Type=dbus</code></p><ol><li>the service is considered ready when the specified <code>BusName=</code> appears on DBus&rsquo;s system bus.</li></ol></li><li><p><code>Type=idle</code></p><ol><li>Like <code>Type=simple</code>, except that systemd will delay execution of the service binary until all jobs are dispatched.</li></ol></li></ul><h3 id=slice--scope>slice / scope</h3><p>A <code>.slice</code> unit corresponds to a cgroup in the cgroupv2 hierarchy. Slice unit can be said to have parent / ascendants / child / descedants.</p><ul><li><p>Root slice unit is <code>-.slice</code>, stands for the root of cgroupv2 VFS.</p></li><li><p>If the segments of dash-separated name of a slice is the prefix of another, the latter will become child cgroup of the prior.</p><p>e.g. If both <code>user.slice</code> and <code>user-1000.slice</code> are active, <code>/sys/fs/cgroup</code> will contain nested directories <code>user.slice/user-1000.slice/</code>.</p></li></ul><p>A <code>.slice</code> unit corresponds to the presence of a cgroup in a cgroup hierarchy from systemd&rsquo;s perspective.</p><h2 id=user-mode-systemd-instance>User Mode Systemd Instance</h2><p>Systemd is designed to support user-level multi-instancing. The aim is to allow non-root users to enjoy functionalities brought by systemd, though in a unprivileged fashion, including running their own unprivileged daemons, or mount filesystems etc.</p><p>The exact timing for creation of a user-level instance depends on an option called <em>lingering</em>:</p><p>When lingering is <code>off</code> for a specific user:</p><ol><li>The default configuration of in <code>/etc/pam.d/system-login</code> asks <code>pam_systemd</code> module to fork-exec a <code>systemd --user</code> process for a user when that user login for the first time.</li><li>That process survives as long as there is some session for that user;</li><li>and will be killed as soon as the last session for the user is closed</li></ol><p>When lingering is turned on by <code>loginctl enable-linger &lt;login></code>, the systemd user instance will be started right after boot (?), and keep running after the last session closes.</p><p>The user-level systemd instance is forked from the root systemd (pid=1) process, and exec-ed with the <code>--user</code> flags:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># ps -F --ppid 1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>UID          PID    PPID  C    SZ   RSS PSR STIME TTY          TIME CMD
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>cedo        <span style=color:#ae81ff>1122</span>       <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>4580</span> <span style=color:#ae81ff>11032</span>   <span style=color:#ae81ff>1</span> 00:13 ?        00:00:00 /usr/lib/systemd/systemd --user
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>cedo        <span style=color:#ae81ff>1132</span>       <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>96046</span>  <span style=color:#ae81ff>7384</span>  <span style=color:#ae81ff>21</span> 00:13 ?        00:00:00 /usr/bin/gnome-keyring-daemon --daemonize --login</span></span></code></pre></div><button>copy</button></div></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>