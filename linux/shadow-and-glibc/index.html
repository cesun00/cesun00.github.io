<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>A history of login password management: the shadow suite, glibc, and libxcrypt | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=hoverable>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=hoverable>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=active>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/linux/>GNU/Linux</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>A history of login password management: the shadow suite, glibc, and libxcrypt</h1><p class=aux-text style=margin-top:0>Published at: October 17, 2023
| Last modification: January 30, 2024</p><div style=line-height:2em></div></div><div><p>Linux was born in 1991. By the year of 1996, most Linux distros (including Slackware 2.3, Slackware 3.0, and other popular distributions)
stored user information including passwords in the <code>/etc/passwd</code> file.
This is a line-oriented text file where each line consists of colon-separated columns. The second column stores
a crypto hash of the user password obtained from a <code>char *crypt(const char *key, const char *salt);</code> call.</p><p>This function dates back to the ages of Research UNIX.
<a href=https://man.openbsd.org/crypt>A rotor-based <code>crypt()</code> function first appeared in Version 3 AT&amp;T UNIX (Feb 1973). A DES-based <code>crypt()</code> first appeared in Version 7 AT&amp;T UNIX.</a>. On the GNU/Linux side, the DES version is implemented in the first place of glibc 1.00.
<code>UFC-crypt</code> is created by Michael Glad. GNU claims that their implementation is 30-60 times faster than the unix one.</p><p>Linux libc4/5, forked from glibc 1.09, adding MD5 support triggered by a <code>$1$</code> prefix in <code>salt</code>.</p><p>This function originated in <code>libc4</code> and <code>libc5</code>.</p><p>glibc later ..
For a very long time, this function was provided by <code>libcrypt</code> which is a part of glibc,
usually in the form of a shared object named <code>libcrypt.so.1</code>.</p><p>To add a new user with password, <code>crypt</code> is invoked with <code>key = password plaintext</code> and <code>salt = </code>.
<code>crypt</code> returns an static allocated buffer which is guaranteed to be prefixed by <code>salt</code>.
This allows
For the <code>lib5</code>, <code>salt</code> must be at least 2 character string consist of <code>a-zA-Z0-9./</code>.
For any given <code>key</code>, this allows its output to be perturb&mldr;
The glibc implementation of this function adds addition .</p><p><code>libcrypt</code> sources resided in the <code>crypt/</code> directory in the glibc source tree.
The shared object was built by default with a normal glibc build.</p><ul><li>Since glibc 2.38 (2023-07-31), explicit <code>--enable-crypt</code> and <code>--enable-nss-crypt</code> are required to build the original <code>libcrypt</code></li><li>Since glibc 2.39 (2024-01-31), <code>crypt/</code> has been removed from the source tree. The aforementioned <code>configure</code> options are no longer available. The section about <code>libcrypt</code> functions was removed from <code>manual/crypt.texi</code>.</li></ul><p>glibc maintainers recommend <code>libxcrypt</code> as the drop-in replacement for <code>libcrypt</code>:</p><blockquote><p>The replacement for libcrypt is libxcrypt, maintained separately from
GNU libc, but available under compatible licensing terms, and providing
binary backward compatibility with the former libcrypt. It is currently
distributed from <a href=https://github.com/besser82/libxcrypt/>https://github.com/besser82/libxcrypt/</a>.</p></blockquote><p>Be careful about the <code>crypt(3)</code> man page on your system.</p><ul><li>The man pages written for the legacy <code>libcrypt</code> are part of the <code>man-pages</code> project.
<a href=https://github.com/mkerrisk/man-pages/blob/ae6b221882ce71ba82fcdbe02419a225111502f0/man3/crypt.3>They still exist in the latest <code>man-pages</code> release</a>.
See <a href=https://man7.org/linux/man-pages/man3/crypt.3.html>here</a> for an online version.</li><li><code>libxcrypt</code> provides man pages titled also <code>crypt(3)</code>. See <a href=https://man7.org/linux/man-pages/man3/crypt.3.html>here</a> for an online version.</li></ul><p>Some distributions, including ArchLinux, have been disabling the build of <code>libcrypt</code> with glibc and have turned to <code>libxcrypt</code> for a long time.
<a href=https://gitlab.archlinux.org/archlinux/packaging/packages/man-pages/-/blob/07d42a77073e5b2363e0acbd00dcc11760eda2bf/PKGBUILD#L49>Such distributions may have removed the <code>man3/crypt.3</code> and related entries</a> from the upstream before building the <code>man-pages</code> package, such that only
the manuals provided by openwall <code>libxcrypt</code> are available.</p><p>Also, don&rsquo;t get confused with the <code>xcrypt(3)</code> pages.
They are documents for legacy functions in <code>rpc</code> module of glibc.</p><h2 id=libxcrypt><code>libxcrypt</code></h2><p><a href=https://github.com/besser82/libxcrypt>libxcrypt</a> from the openwall project.
Huge efforts were made to ensure that <code>libcrypt.so.2</code> can be a drop-in replacement for <code>libcrypt.so.1</code> from glibc.
Any program link against the glibc&rsquo;s <code>libcrypt</code> should run normally with <code>libxcrypt</code>.</p><h2 id=todo-more-symbols-from-libcrypt-and-libxcrypt>TODO: more symbols from libcrypt and libxcrypt</h2><p><code>encrypt(3)</code>, etc.</p><h2 id=how-does-shadow-get-into-the-game>How does <code>shadow</code> get into the game</h2><p>The apparent problem with <code>/etc/passwd</code> is that it must be readable by anyone.
If you were to change the <code>/etc/passwd</code> file so that nobody can read it, the first thing that
you would notice is that the ls -l command now displays user ID&rsquo;s instead of names.</p><p>Given the fact it stores password hashes</p><p><a href=https://github.com/shadow-maint/shadow>The shadow package</a>
is related to glibc in an interesting way.</p><div class=codeblock-hook><pre tabindex=0><code>grpconv   The `pwconv` command creates `shadow` from `passwd` and an optionally existing shadow.
grpunconv   The `pwunconv` command creates `passwd` from `passwd` and `shadow` and then removes shadow.
pwconv        The `grpconv` command creates `gshadow` from `group` and an optionally existing gshadow.
pwunconv    The `grpunconv` command creates `group` from `group` and `gshadow` and then removes gshadow.

chage
chgpasswd
chpasswd
expiry
faillog
getsubids
gpasswd
groupadd
groupdel
groupmems
groupmod
groups
grpck
lastlog
newgidmap
newuidmap
newusers
passwd      the well-known program to change a user&#39;s password
pwck
sg
useradd     user acc manipulation
userdel     
usermod</code></pre><button>copy</button></div><div class=codeblock-hook><pre tabindex=0><code>/etc/default/useradd
/etc/login.defs

/etc/pam.d/chpasswd
/etc/pam.d/groupmems
/etc/pam.d/newusers
/etc/pam.d/passwd</code></pre><button>copy</button></div><p>If you installed your distribution from a CD-ROM, you may find that,
even though the distribution did not have the Shadow Suite installed,
some of the files you need to install the Shadow Suite may be on the
CD-ROM.</p><p><a href=https://elixir.bootlin.com/glibc/latest/source/nss/shadow.h>https://elixir.bootlin.com/glibc/latest/source/nss/shadow.h</a></p><p><code>getspnam</code> was implemented in glibc <code>nss/getspnam.c</code> but shadow write man page for it.</p><p><a href=https://github.com/shadow-maint/shadow/blob/51a0d94a08920a2d3edc52919692cdbd25f07d6d/man/shadow.3.xml#L96>https://github.com/shadow-maint/shadow/blob/51a0d94a08920a2d3edc52919692cdbd25f07d6d/man/shadow.3.xml#L96</a></p><p>weriddddddd</p></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>