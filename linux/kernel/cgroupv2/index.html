<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Linux Control Group V2 (cgroup2) | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=hoverable>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=hoverable>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=active>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/linux/>GNU/Linux</a>/<a href=/linux/kernel/>The Linux Kernel</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>Linux Control Group V2 (cgroup2)</h1><p class=aux-text style=margin-top:0>Published at: December 1, 2023
| Last modification: July 25, 2024</p><div style=line-height:2em><span class="page-tag tag-cgroup">cgroup</span>
<span class="page-tag tag-kernel">kernel</span>
<span class="page-tag tag-linux">linux</span></div></div><div><p>This article gives an introduction to cgroup.</p><p>The Control Group (cgroup) is a feature of the Linux kernel that allows organizing arbitrary processes into groups such that restrictions on resources can be imposed in terms of that group by an administrator, and statistics are collected in terms of that group. Windows Desktop currently doesn&rsquo;t have such a feature.</p><p>These limitations on resources mainly include:</p><ul><li>available memory</li><li>CPU time slice</li><li>CPU association</li><li>network bandwidth</li><li>filesystem quota, etc.</li></ul><p>Cgroup is also a critical feature of the Linux kernel that allows the implementation of Docker.</p><h2 id=overview>Overview</h2><ul><li>The first cgroup implementation (now known as cgroupv1) was merged into the Linux kernel mainline in kernel version 2.6.24 (released in January 2008). The cgroupv1 model is now considered too complicated.</li><li>A complete rework, known as cgroupv2, was done around 2016 and first appeared in Linux kernel 4.5 (released on 14 March 2016), with significant changes to the interface and internal functionality.</li></ul><p>Unless otherwise noted, this article will only discuss cgroupv2.
After you understand how v2 works, <a href=#legacy-v1>a short chapter</a> should suffice to explain how v1 works.</p><h3 id=model>Model</h3><p>A cgroup is a set of arbitrary processes, not necessarily contiguous in the process tree.</p><p>Each process must belongs, and only belong to a single cgroup, i.e. cgroups divide all processes on the system into disjoint sets; although there are empty cgroup with no processes, serving only organization purposes.
To see which cgroup a certain pid belongs to, read <code>/proc/&lt;pid>/cgroup</code>, or use <code>ps -o pid,cgroup</code> which does the same thing via <code>libproc2</code>.</p><p>A child process created by <code>fork()</code> is in the same cgroup as the parent.
A process can be moved to a different cgroup without affecting the cgroup-belonging of its children.</p><p>Cgroups are hierarchical, meaning that</p><ol><li>a cgroup has a parent cgroup, and there is a root cgroup.</li><li>a cgroup can have children (a.k.a nested) cgroups.</li></ol><p>The cgroups hierarchy has nothing to do with the process tree hierarchy, i.e. the cgroup-belonging of processes can be configured arbitrarily, except that by default a child process is in the same cgroup as its parent, as mentioned above.</p><p>This hierarchy is reflected by the pseudo filesystem <code>cgroup2</code>, usually automatically mounted by systemd at <code>/sys/fs/cgroup</code>.</p><h4 id=controllers>Controllers</h4><p>Controllers (or resource controllers) are the kernel&rsquo;s abstraction of code component that enforces the resource limitation on a cgroup.
Controllers are sorely maintained by the kernel team. There is no easy way of writing a new controller without thorough knowledge on the Linux kernel codebase (as opposed to device drivers).</p><ul><li>A controller is said to be available for a cgroup, if it appears in the <code>cgroup.controller</code> file of the directory representing that cgroup.</li><li>A controller is said to be enabled on a cgroup, if it appears in the <code>cgroup.subtree_control</code> file of the directory representing that cgroup.</li><li>A controller is disabled on a cgroup, if it is not available, or available but not enabled.</li></ul><p>The cgroup hierarchy facilitates the hierarchical behavior of controllers:</p><ol><li>the limits placed on a cgroup constrain all processes in that cgroup and descendant cgroups.</li><li>a controller disabled by an ancestor cgroup can&rsquo;t be re-enabled by a descendant cgroup.</li></ol><p>All available controllers of the current running kernel can be found in the <code>cgroup.controllers</code> of the root cgroup:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>cat /sys/fs/cgroup/cgroup.controllers
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#75715e># cpuset cpu io memory hugetlb pids rdma misc</span></span></span></code></pre></div><button>copy</button></div><p>On my system, the root cgroup enables the following controller:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>cat /sys/fs/cgroup/cgroup.subtree_control</span></span></code></pre></div><button>copy</button></div><h2 id=cgroup2-vfs><code>cgroup2</code> VFS</h2><p>Linux exposes a <code>cgroup2</code> pseudo filesystem to allow administrators to query and configure cgroups.
There is no syscall designed specifically for cgroups. The cgroup2 VFS is meant to be the <em>only</em> interface to users.</p><p>A default instance of this filesystem is mounted at <code>/sys/fs/cgroup</code>:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># mount | grep cgroup</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>cgroup2 on /sys/fs/cgroup type cgroup2 <span style=color:#f92672>(</span>rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot<span style=color:#f92672>)</span></span></span></code></pre></div><button>copy</button></div><p>You can mount the same FS instance at your arbitrary mounting point by calling <code>mount(2)</code> with:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#a6e22e>mount</span>(<span style=color:#e6db74>&#34;dummy&#34;</span>, <span style=color:#e6db74>&#34;path/to/mounting/point&#34;</span>, <span style=color:#e6db74>&#34;cgroup2&#34;</span>, flags)</span></span></code></pre></div><button>copy</button></div><p>or use the equivalent <code>mount(8)</code> command.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>mount -t cgroup2 dummy <span style=color:#e6db74>${</span>MOUNT_POINT<span style=color:#e6db74>}</span></span></span></code></pre></div><button>copy</button></div><p>Each mount of <code>cgroup2</code> always rebinds the same instance.</p><h3 id=hierarchy>hierarchy</h3><p>As mentioned above, cgroups are hierarchical.</p><p>The <code>${MOUNT_POINT}</code> directory represents the nameless root cgroup, under which recursively:</p><ol><li>each directory represent a child cgroup of the cgroup represented by the current directory. <code>mkdir</code> creates a new child cgroup of the <code>pwd</code> cgroup; the kernel will populate default files after a new cgroup has been <code>mkdir</code>-ed.</li><li>a cgroup directory with no subdirectory is known as a leaf cgroup, while all others are non-leaf.</li></ol><p>Only leaf cgroups and the root cgroup can contain processes; all other cgroups are organization nodes, and represent an empty set of processes (i.e. empty <code>cgroup.procs</code> file).</p><h3 id=file-entries>File entries</h3><p>File operations on this VFS reads / changes the cgroup configuration of the running system.</p><p>In a cgroup directory,</p><ul><li><code>cgroup.*</code> files are config entries about the group itself;</li><li><code>irq.pressure</code> contains stats about interrupt requests (IRQ) happened in this cgroup reported by the PIC (programmable interrupt controller); and</li><li>all other files are controller-specific, known as the <em>interface files</em> of a controller. These files provide access to different attributes for a given controller. Some interface files of a controller exist regardless of whether or not that controller is enabled. (e.g. <code>cpu.stat</code>).</li></ul><p>The following table summarizes the <code>cgroup.*</code> files; cell with a <code>/</code> indicates read / write is not supported (i.e. the file is read-only or write-only). A merged cell indicates that reading and writing for that entry are consistent with normal files.</p><table><thead><tr><td style=width:20%>file name & existence</td><td>read</td><td>write</td></tr></thead><tbody><tr><td><p><code>cgroup.controllers</code></p><p>exists on all cgroups</p></td><td>Return names of controllers enabled by the parent cgroup of the current cgroup, and thus may be enabled for this cgroup.<p>No controller listed in this file is enabled for the current cgroup by default.
Enabling a controller means enforcing control of memory, cpu, etc. resources allocated to child cgroups, and must be done by writing to the <code>cgroup.subtree_control</code> file.</td></p><td>/</td></tr><tr><td><p><code>cgroup.subtree_control</code></p><p>exists on all cgroups</p></td><td>return the enabled controllers.</td><td><p>write to this file must be in the format of <code>+controller</code> or <code>-controller</code>; e.g.</p><div class=codeblock-hook><pre tabindex=0><code>echo &#34;+cpu +memory -io&#34; &gt; cgroup.subtree_control;</code></pre><button>copy</button></div></td></tr><tr><tr><td><p><code>cgroup.procs</code></p><p>exists on all cgroups</p></td><td>unorderly lists pids in this cgroup. As mentioned above, non-leaf nodes (except the root cgroup) have no process itself (e.g. `system.slice`)</td><td><p>migrate process <code>pid</code> to this cgroup.</p><ul><li>1 process per <code>write</code> call.</li><li>No <code>O_APPEND</code> is required for <code>open</code>.</li><li>For multi-thread process, migrating any thread migrates all other threads.</li></ul></td></tr><td><p><code>cgroup.events</code></p><p>exists on non-root cgroups</p></td><td><p>This file contains lines of <code>name value</code> pair separated by a whitespace. Defined names are:</p><ul><li><code>populated</code>: 1 if the cgroup or its descendants contains any live processes; otherwise, 0.</li><li><code>frozen</code>: 1 if the cgroup is frozen; otherwise, 0.</li></ul><p>Changes to this file can be listened by the <code>inotify(7)</code> APIs.</p></td><td>/</td></tr><tr><td><p><code>cgroup.freeze</code></p><p>exists on non-root cgroups</p></td><td colspan=2><p>Writing 1 cause this cgroup and all descendant cgroups to freeze, meaning that all belonging processes will be stopped and will not run until the cgroup be explicitly unfrozen (by writing 0).</p></td></tr><tr><td><p><code>cgroup.kill</code></p><p>exists in non-root cgroups</p></td><td>/</td><td><ul><li>Writing <code>"1"</code> sends <code>SIGKILL</code> to all processes in the cgroup and descendant cgroups.</li><li>Writing any value other than <code>"1"</code> is not allowed.</li></ul></td></tr><tr><td>cgroup.max.depth</td><td colspan=2><p>A number giving the maximum allowed <strong>depth</strong> of descendant cgroups.
Creating a new child cgroup will fail if exceeding.</p><p>A special value <code>"max"</code> is the default, and implies no limit.</p></td></tr><tr><td>cgroup.max.descendants</td><td colspan=2><p>A number giving the maximum allowed <strong>number</strong> of descendant cgroups.
Creating a new child cgroup will fail if exceeding.</p><p>A special value <code>"max"</code> is the default, and implies no limit.</p></td></tr><tr><td>cgroup.pressure</td><td colspan=2><p>A single 0 or 1 indicating whether cgroup <a href=https://docs.kernel.org/accounting/psi.html>PSI (Pressure Stall Information)</a> accounting is enabled.</p><blockquote><p>This control attribute is not hierarchical, so disable or enable PSI accounting in a cgroup does not affect PSI accounting in descendants and doesn’t need pass enablement via ancestors from root.</p></blockquote></td></tr><tr><td>cgroup.stat</td><td><p>Report</p><ul><li>Total number of visible descendant cgroups.</li><li>Total number of dying descendant cgroups.</li></ul></td><td>/</td></tr><tr><td>cgroup.threads</td><td></td><td></td></tr><tr><td><p><code>cgroup.type</code></p><p>exists on non-root cgroups</p></td><td><p>Report the current type of this cgroup, which is one of</p><ul><li><code>domain</code> : A normal valid domain cgroup.</li><li><code>domain threaded</code> : A threaded domain cgroup which is serving as the root of a threaded subtree.</li><li><code>domain invalid</code> : A cgroup which is in an invalid state. It can’t be populated or have controllers enabled. It may be allowed to become a threaded cgroup.</li><li><code>threaded</code> : A threaded cgroup which is a member of a threaded subtree.</li></ul></td><td><p>Only writing <code>"threaded"</code> is supported: it turns that cgroup into a threaded cgroup.</p></td></tr></tbody></table><h3 id=controllers-interface-files>Controllers Interface Files</h3><h4 id=cpuset><code>cpuset</code></h4><p>The <code>cpuset</code> controller limits the tasks in a cgroup to only run on a set of specified CPUs and memory nodes.
In fact, the whole idea of cgroup was originally proposed to simply implement this feature.</p><p>Interface files include:</p><table><thead><tr><td>file name</td><td>read</td><td>write</td></tr></thead><tbody><tr><td><p><code>cpuset.cpus</code></p><p>exists on non-root cpuset-enabled cgroups</p></td><td colspan=2><p>The <strong>requested</strong> CPUs to be used by tasks within this cgroup. Reading will, and writing must conform to the following format:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># cat cpuset.cpus</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>0-4,6,8-10</span></span></code></pre></div><button>copy</button></div><p><strong>Such a request may not fully succeed</strong> since hierarchy matters.
The actual CPU set allocated to this cgroup will be constrained by ancestor cgroups and whether the request CPUs are online or not; see <code>cpuset.cpus.effective</code>.</p><p>An empty file implies no restriction.</p></td></tr><tr><td><p><code>cpuset.cpus.effective</code></p><p>exists on all cpuset-enabled cgroups.</p></td><td><ul><li>if <code>cpuset.cpus</code> is empty, it lists all CPUs available to its parent (thus also available to this cgroup).</li><li>otherwise, it is a subset of <code>cpuset.cpus</code>, which is the result of the allocation request.</li></ul></td><td>/</td></tr><tr><td><p><code>cpuset.mems</code></p><p>exists on non-root cpuset-enabled cgroups.</p></td><td colspan=2><p>The requested memory nodes (for NUMA system) to be used by tasks within this cgroup.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># cat cpuset.mems</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>0-1,3</span></span></code></pre></div><button>copy</button></div><p>Again such a request may not fully succeed. See <code>cpuset.mems.effective</code>.</p><p>An empty value implies no restriction.</p></td></tr><tr><td><p><code>cpuset.mems.effective</code></p><p>exists on all cpuset-enabled cgroups</p></td><td><ul><li>if <code>cpuset.mems</code> is empty, it lists all memory nodes available to its parent (thus also available to this cgroup)</li><li>otherwise, it is a subset of <code>cpuset.mems</code>, which is the result of the allocation request.</li></ul></td><td>/</td></tr><tr><td><p><code>cpuset.cpus.exclusive</code></p><p>exists on non-root cpuset-enabled cgroups</p></td><td></td><td></td></tr><tr><td><p><code>cpuset.cpus.exclusive.effective</code></p><p>exists on all non-root cpuset-enabled cgroups</p></td><td></td><td>/</td></tr><tr><td><p><code>cpuset.cpus.isolated</code></p><p>Always, and only exist on root cgroup.</p></td><td></td><td>/</td></tr><tr><td><p><code>cpuset.cpus.partition</code></p><p>exists on non-root cpuset-enabled cgroups</p></td><td></td><td></td></tr></tbody></table><h3 id=cpu><code>cpu</code></h3><p>The <code>cpu</code> controller regulates the distribution of CPU cycles, and reports CPU usage stats.</p><table><thead><tr><td>file name</td><td>read</td><td>write</td></tr></thead><tbody><tr><td><p><code>cpu.stat</code></p><p>Always exists whether the controller is enabled or not.</p></td><td><p>Report:</p><ul><li>usage_usec</li><li>user_usec</li><li>system_usec</li></ul><p>and the following when the controller is enabled:</p><ul><li>nr_periods</li><li>nr_throttled</li><li>throttled_usec</li><li>nr_bursts</li><li>burst_usec</li></ul></td><td>/</td></tr><tr><td>cpu.weight</td><td colspan=2></td></tr><tr><td>cpu.weight.nice</td><td></td><td></td></tr><tr><td>cpu.max</td><td></td><td></td></tr><tr><td>cpu.max.burst</td><td></td><td></td></tr><tr><td>cpu.pressure</td><td></td><td></td></tr><tr><td>cpu.uclamp.min</td><td></td><td></td></tr><tr><td>cpu.uclamp.max</td><td></td><td></td></tr><tr><td>cpu.idle</td><td></td><td></td></tr></tbody></table><h3 id=io><code>io</code></h3><ul><li><code>io.stat</code>:</li><li><code>io.cost.qos</code>:</li><li><code>io.cost.model</code>:</li><li><code>io.weight</code>:</li><li><code>io.max</code>:</li><li><code>io.pressure</code>:</li><li><code>io.latency</code>:</li></ul><h3 id=memory><code>memory</code></h3><p>All memory amounts are in bytes.</p><p>Since page is the minimal unit of memory allocation,</p><ul><li>a read always returns a multiple of <code>PAGE_SIZE</code> (see <code>sysconf(3)</code>);</li><li>a write that is not a multiple of <code>PAGE_SIZE</code> will be round up.</li></ul><table><thead><tr><td>file name</td><td>read</td><td>write</td></tr></thead><tbody><tr><td><p><code>memory.current</code></p><p>exists on non-root cgroups</p></td><td>Report the physical memory used by processes in this cgroup and all its descendants.</td><td>/</td></tr><tr><td><p><code>memory.min</code></p><p>exists on non-root cgroups</p></td><td colspan=2><p>A hard limit for minimal memory page ownership. Default to <code>0</code>.</p><p>If the memory used by processes in this cgroup is smaller than this value, usually due to insufficient total physical memory,</p><ol><li>current allocated pages for these processes will never be reclaimed</li><li>pages owned by processes in other cgroups start being reclaimed or swapped out; if this is impossible, OOM killer will be invoked to kill other processes to set room.</li></ol><p>If a cgroup currently has no process, its <code>memory.min</code> is ignored.</p></td></tr><tr><td><p><code>memory.low</code></p><p>exists on non-root cgroups</p></td><td colspan=2><p>A soft (best-effort) limit for minimal memory page ownership. Default to <code>0</code>.</p></td></tr><tr><td><p><code>memory.high</code></p><p>exists on non-root cgroups</p></td><td colspan=2><p>Soft limit for physical memory page consumption. The default is <code>"max”</code> (no limit).</p><p>Going over this limit will NEVER trigger OOM killer. New allocation via <code>mmap</code> will most likely block.</p></td></tr><tr><td><p><code>memory.max</code></p><p>exists on non-root cgroups</p></td><td colspan=2><p>Hard limit for physical memory page consumption. The default is <code>"max”</code> (no limit).</p><p>Going over this value triggers OOM killer in this cgroup, and one of the tasks will be chosen as the victim.</p></td></tr><tr><td><p><code>memory.reclaim</code></p><p>exists for all cgroups</p></td><td>/</td><td></td></tr><tr><td>memory.peak</td><td></td><td></td></tr><tr><td>memory.oom.group</td><td></td><td></td></tr><tr><td>memory.events</td><td></td><td></td></tr><tr><td>memory.events.local</td><td></td><td></td></tr><tr><td>memory.stat</td><td></td><td></td></tr><tr><td>memory.numa_stat</td><td></td><td></td></tr><tr><td>memory.swap.current</td><td></td><td></td></tr><tr><td>memory.swap.high</td><td></td><td></td></tr><tr><td>memory.swap.peak</td><td></td><td></td></tr><tr><td>memory.swap.max</td><td></td><td></td></tr><tr><td>memory.swap.events</td><td></td><td></td></tr><tr><td>memory.zswap.current</td><td></td><td></td></tr><tr><td>memory.zswap.max</td><td></td><td></td></tr><tr><td>memory.zswap.writeback</td><td></td><td></td></tr><tr><td>memory.pressure</td><td></td><td></td></tr></tbody></table><h3 id=hugetlb><code>hugetlb</code></h3><ul><li><code>hugetlb.&lt;hugepagesize>.current</code>:</li><li><code>hugetlb.&lt;hugepagesize>.events.local</code>:</li><li><code>hugetlb.&lt;hugepagesize>.events</code>:</li><li><code>hugetlb.&lt;hugepagesize>.max</code>:</li><li><code>hugetlb.&lt;hugepagesize>.numa_stat</code>:</li></ul><h3 id=pids><code>pids</code></h3><ul><li><code>pids_localevents</code>:</li><li><code>pids.current</code>:</li><li><code>pids.events.local</code>:</li><li><code>pids.events</code>:</li><li><code>pids.max</code>:</li><li><code>pids.peak</code>:</li></ul><h3 id=rdma><code>rdma</code></h3><p>The rdma controller regulates RDMA (Remote direct memory access) and InfiniBand resources. Mainly used for mainframes in datacenters.</p><ul><li><code>rdma.max</code>: readonly file that reports the current resource usage in human-readable format</li><li><code>rdma.current</code>: read -write</li></ul><h3 id=misc><code>misc</code></h3><ul><li><code>misc.capacity</code>:</li><li><code>misc.current</code>:</li><li><code>misc.events.local</code>:</li><li><code>misc.events</code>:</li><li><code>misc.max</code>:</li><li><code>misc.peak</code>:</li></ul><p>The misc controller is enabled at kernel build-time with <code>CONFIG_CGROUP_MISC</code> option.</p><h3 id=umimplemented-controller-for-cgroup2>Umimplemented controller for cgroup2</h3><p>2 controllers available in cgroupv1, <code>net_cls</code> and <code>net_prio</code>, has no direct counterpart in cgroupv2.
The newly recommended workflow is to use eBPF filters (see <code>iptables(8)</code>) which hooks onto cgroupv2 pathnames.</p><h2 id=legacy-v1>Legacy V1</h2><p>We&rsquo;ll give a retrospect to cgroupv1 just in case you have to work on them as well.
Systemd used to heavily rely on cgroupv1 before 2018, but by the time of this writing, it had completely migrated to cgroupv2.</p><p>The most important difference is that cgroupv1 has multiple hierarchy, one for each controller.
Cgroupv1 also has slightly different file entries.</p><p>To use cgroupv1, you must mount the <code>cgroup</code> VFS (careful - not <code>cgroup2</code>) with a <code>-o&lt;controller></code> argument, for each controller you want to enable for the system.
Conventionally, though not mandatory, a <code>tmpfs</code> is first mounted as the parent directory of all <code>cgroup</code> VFS mounting points:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e># first mount a tmpfs</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>mkdir my_tmpfs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>mount -t tmpfs not_a_device my_tmpfs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>cd my_tmpfs
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e># then mount a cgroup VFS for each controller</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>mkdir cpu cpuacct cpuset
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>mount -t cgroup -ocpu not_a_device cpu
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>mount -t cgroup -ocpuacct not_a_device cpuacct
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>mount -t cgroup -ocpuset not_a_device cpuset</span></span></code></pre></div><button>copy</button></div><p>Within this cgroup VFS e.g. for <code>cpuset</code> controller, you can start organizing the processes into cgroups:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>cd cpuset
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>mkdir foo_group     <span style=color:#75715e># kernel populates foo_group/* files</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>echo $$ &gt; foo_group/tasks        <span style=color:#75715e># moving the shell into this `foo_group` cgroup</span></span></span></code></pre></div><button>copy</button></div><p>Cgroup v1 and v2 share some of the controller implementations, but they also have controllers that are not available in the other.
It&rsquo;s possible, though deprecated, that cgroup v1 and v2 be enabled on the same running kernel. Check <code>cgroups(8)</code> for details.</p><h2 id=process--thread--task_struct-details--cgroup-kernel-internals>Process / Thread / <code>task_struct</code> Details & Cgroup Kernel Internals</h2><p>A <code>clone(2)</code> creates a child task in the same cgroup, unless</p><ol><li>for <code>clone()</code>, <code>CLONE_NEWCGROUP</code> flag, or</li><li>for <code>clone3()</code>, <code>CLONE_INTO_CGROUP</code> and <code>clone_args.cgroup</code> is used.</li></ol><p>Linux uses glibc which implements <code>fork</code> with clone, so the discussion applies.</p><p><a href=https://github.com/torvalds/linux/blob/ef8e4d3c2ab1f47f63b6c7e578266b7e5cc9cd1b/include/linux/sched.h#L728><code>task_struct</code></a> holds a reference-counted pointer to <code>struct css_set</code>:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>struct</span> task_struct {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#75715e>#ifdef CONFIG_CGROUPS
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#75715e></span>	<span style=color:#75715e>/* Control Group info protected by css_set_lock: */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>	<span style=color:#66d9ef>struct</span> css_set __rcu		<span style=color:#f92672>*</span>cgroups;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#75715e>/* cg_list protected by css_set_lock and tsk-&gt;alloc_lock: */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>	<span style=color:#66d9ef>struct</span> list_head		cg_list;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#75715e>#endif
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#75715e></span>}</span></span></code></pre></div><button>copy</button></div><p><code>struct css_set</code> defined in <a href=https://github.com/torvalds/linux/blob/6f38be8f2ccd9babf04b9b23539108542a59fcb8/include/linux/cgroup-defs.h#L199>linux/cgroup-defs.h</a> is a set of <code>struct cgroup_subsys_state</code>, thus the name:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>struct</span> css_set {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>	<span style=color:#75715e>/*
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#75715e>	 * Set of subsystem states, one for each subsystem. This array is
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#75715e>	 * immutable after creation apart from the init_css_set during
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#75715e>	 * subsystem registration (at boot time).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>	<span style=color:#66d9ef>struct</span> cgroup_subsys_state <span style=color:#f92672>*</span>subsys[CGROUP_SUBSYS_COUNT];
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>	<span style=color:#75715e>/* reference count */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>	<span style=color:#66d9ef>refcount_t</span> refcount;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>	<span style=color:#75715e>/*
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#75715e>	 * Lists running through all tasks using this cgroup group.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#75715e>	 * mg_tasks lists tasks which belong to this cset but are in the
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#75715e>	 * process of being migrated out or in.  Protected by
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#75715e>	 * css_set_rwsem, but, during migration, once tasks are moved to
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#75715e>	 * mg_tasks, it can be read safely while holding cgroup_mutex.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>	<span style=color:#66d9ef>struct</span> list_head tasks;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>}</span></span></code></pre></div><button>copy</button></div><p>Each <code>struct cgroup_subsys_state</code> describes a subsystem that cares division of tasks.</p><p><code>css_set.tasks</code> is a linked list running through all <code>task_struct.cg_list</code> that using the <code>css_set</code>.</p></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>