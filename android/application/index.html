<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Android Application Development Overview | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=active>Android </a><a href=/cxx/ class=hoverable>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=hoverable>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=hoverable>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=hoverable>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/android/>Android</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>Android Application Development Overview</h1><p class=aux-text style=margin-top:0>Published at: January 28, 2018
| Last modification: May 9, 2024</p><div style=line-height:2em><span class="page-tag tag-android">Android</span></div></div><div><h2 id=application-fundamentals>Application Fundamentals</h2><p><a href=https://developer.android.com/guide/components/fundamentals.html>https://developer.android.com/guide/components/fundamentals.html</a></p><p>The Android operating system is a multi-user Linux system in which each app is a different user.</p><p>By default, the system assigns each app a unique Linux user ID (the ID is used only by the system and is unknown to the app). The system sets permissions for all the files in an app so that only the user ID assigned to that app can access them.
每个app通常以独立且唯一的linux uid运行，app的文件设有权限，只有app的uid有权访问</p><p>Each process has its own virtual machine (VM), so an app&rsquo;s code runs in isolation from other apps.
每个进程拥有自己的VM，独立于其他的app运行</p><p>By default, every app runs in its own Linux process. The Android system starts the process when any of the app&rsquo;s components need to be executed, and then shuts down the process when it&rsquo;s no longer needed or when the system must recover memory for other apps.
每个app在自己的linux进程中运行。Android系统在app的任意组件需要执行的时候都会启动其进程。在其完成工作或需要为别的app腾出内存的时候由Android结束进程。</p><h3 id=the-principle-of-least-privilege>The Principle of Least Privilege</h3><p>The Android system implements the principle of least privilege. That is, each app, by default, has access only to the components that it requires to do its work and no more. This creates a very secure environment in which an app cannot access parts of the system for which it is not given permission.
每个app只有权访问其完成工作必须的最小部分组件，无权访问系统中未被授权的部分。</p><p>However, there are ways for an app to share data with other apps and for an app to access system services:
但是app之间仍可以通过以下方法实现数据共享：</p><ol><li>It&rsquo;s possible to arrange for two apps to share the same Linux user ID, in which case they are able to access each other&rsquo;s files. To conserve system resources, apps with the same user ID can also arrange to run in the same Linux process and share the same VM. The apps must also be signed with the same certificate. 两个app可以共用一个linux uid，这样他们就可以访问彼此的文件。为了节约系统资源，共享uid的多个app也能被安排为运行在同一个linux进程中，并共享VM。这样的app也必须签有同样的证书。</li><li>An app can request permission to access device data such as the user&rsquo;s contacts, SMS messages, the mountable storage (SD card), camera, and Bluetooth. The user has to explicitly grant these permissions. For more information, see Working with System Permissions. app可以请求权限，比如请求访问用户的联系人或者短信或别的外部设备（SD card，摄像头，蓝牙等）。用户必须明确地进行授权。</li></ol><h2 id=app-components>App Components</h2><p>4 types of app components:</p><ul><li>Activity</li><li>Service</li><li>Broadcast Receiver</li><li>Content Provider</li></ul><h3 id=activity>Activity</h3><p><em>You implement an activity as a subclass of the <code>Activity</code> class.</em></p><h3 id=service>Service</h3><p>2 types of services:</p><ol><li>Started Services: Started services tell the system to keep them running until their work is completed.</li><li>Bound Services: Bound services run because some other app (or the system) has said that it wants to make use of the service. This is basically the service providing an API to another process.</li></ol><p>And Started Services can also be divided into 2 types:</p><ol><li>Music playback is something the user is directly aware of, so the app tells the system this by saying it wants to be foreground with a notification to tell the user about it; in this case the system knows that it should try really hard to keep that service&rsquo;s process running, because the user will be unhappy if it goes away.</li><li>A regular background service is not something the user is directly aware as running, so the system has more freedom in managing its process. It may allow it to be killed (and then restarting the service sometime later) if it needs RAM for things that are of more immediate concern to the user.</li></ol><p>A service is implemented as a subclass of Service. For more information about the Service class, see the Services developer guide.</p><p><em>Use the <code>JobScheduler</code> class to schedule action after API level 21</em>
<em>Q: &ldquo;action&rdquo; and &ldquo;service&rdquo;?</em></p><h3 id=broadcast-receivers>Broadcast Receivers</h3><p>A broadcast receiver is a component that enables the system to deliver events to the app outside of a regular user flow, allowing the app to respond to system-wide broadcast announcements.</p><p>Although broadcast receivers don&rsquo;t display a user interface, they may create a status bar notification to alert the user when a broadcast event occurs. More commonly, though, a broadcast receiver is just a gateway to other components and is intended to do a very minimal amount of work. For instance, it might schedule a <code>JobService</code> to perform some work based on the event with <code>JobScheduler</code>.</p><p><em>A broadcast receiver is implemented as a subclass of <code>BroadcastReceiver</code> and each broadcast is delivered as an <code>Intent</code> object. For more information, see the <code>BroadcastReceiver</code> class.</em></p><h3 id=content-provider>Content Provider</h3><p><em>A content provider is implemented as a subclass of ContentProvider and must implement a standard set of APIs that enable other apps to perform transactions. For more information, see the Content Providers developer guide.</em>
<em>See also: Content Resolver</em></p><h2 id=about-components>About Components</h2><p>A unique aspect of the Android system design is that any app can start another app’s component. For example, if you want the user to capture a photo with the device camera, there&rsquo;s probably another app that does that and your app can use it instead of developing an activity to capture a photo yourself. You don&rsquo;t need to incorporate or even link to the code from the camera app. Instead, you can simply start the activity in the camera app that captures a photo. When complete, the photo is even returned to your app so you can use it. To the user, it seems as if the camera is actually a part of your app.
Android系统允许直接调用其他app的某个component（<em>在其他app允许的情况下？</em>），比如在你的app中直接调用camera app进行拍照，并返回拍得的图片。</p><p>When the system starts a component, it starts the process for that app if it&rsquo;s not already running and instantiates the classes needed for the component. For example, if your app starts the activity in the camera app that captures a photo, that activity runs in the process that belongs to the camera app, not in your app&rsquo;s process. Therefore, unlike apps on most other systems, Android apps don&rsquo;t have a single entry point (there&rsquo;s no main() function).</p><p>系统启动组件的时候，会为被调用的组件启动其所属app的进程。可以看到Android App可以有多个入口组件。
<em>这里的main() function的analogy并不恰当，Component和Java的main()不是同一个abstraction layer的概念，没有单一的入口Component不代表底层JVM不从main开始执行，因此容易造成歧义</em></p><p>Because the system runs each app in a separate process with file permissions that restrict access to other apps, your app cannot directly activate a component from another app. However, the Android system can. To activate a component in another app, deliver a message to the system that specifies your intent to start a particular component. The system then activates the component for you.</p><p>出于系统安全性的考虑（独立进程，文件权限），app肯定不能直接激活别的app的组件。app通过Intent委托系统为其激活别的app的组件。</p><h2 id=activating-components>Activating components</h2><p>Activity, Service和Broadcast Receiver都由异步消息Intent启动。</p><p>Intent在运行时将两个组件绑定，是组件之间的信使。</p><p>一个Intent可以激活一个具体的组件(explicit intent)，或是仅声明需要激活的组件的类型(implicit intent)，由用户选择具体唤醒哪个组件（考虑有多个浏览图片的app时，打开图片会弹出系统对话要求选择具体的app）</p><p>当唤醒别的组件并期待一个返回结果时，返回结果也作为Intent对象返回。e.g. 要求用户选择一个联系人，则返回一个intent，包含一个指向用户所选的联系人的URI。</p><p>而ContentProvider由ContentResolver发起的资源请求唤醒。ContentResolver的存在将上层组件和ContentProvider解耦。 // for security?</p><p>不同组件的调用：</p><ol><li>Activity: pass an Intent to startActivity() or startActivityForResult() (when you want the activity to return a result).</li><li>Service:
if >= Android 5.0 (API Level 21), use <code>JobScheduler</code> class
otherwise:
start service: pass Intent to startService()
bind service: pass Intent to bindService()</li><li>BroadcastReceiver: pass Intent to methods such as <code>sendBroadcast()</code>, <code>sendOrderedBroadcast()</code>, or <code>sendStickyBroadcast()</code>.</li><li>ContentProvider: call <code>query()</code> on a <code>ContentResolver</code>.</li></ol><h2 id=androidmanifestxml>AndroidManifest.xml</h2><ol start=0><li>Declare all the components of the app</li><li>Identifies any user permissions the app requires, such as Internet access or read-access to the user&rsquo;s contacts.</li><li>Declares the minimum API Level required by the app, based on which APIs the app uses.</li><li>Declares hardware and software features used or required by the app, such as a camera, bluetooth services, or a multitouch screen.</li><li>Declares API libraries the app needs to be linked against (other than the Android framework APIs), such as the Google Maps library.</li></ol><h2 id=declaring-components>Declaring Components</h2><p>In <code>&lt;application></code>:
<code>&lt;activity></code> for activity
<code>&lt;service></code> for service
<code>&lt;receiver></code> for broadcast receiver
<code>&lt;provider></code> for content provider</p><p>activities, services, and content provider MUST be declared in the manifest file, otherwise they will never be run.</p><p>However, broadcast receiver can be either declared in the manifest or</p><ol><li>create in code at runtime as &ldquo;BroadcastReceiver&rdquo; object</li><li>register dynamically at runtime by calling &ldquo;registerReceiver()&rdquo;</li></ol><h2 id=declaring-component-capabilities>Declaring component capabilities</h2><p>如Activating components中所说，Intent有2种：explicit intent & implicit intent
explicit intent指明了希望启动的组件的class name
而implicit intent仅指定了希望启动的组件的类型，告诉系统自己寻找合适的组件。如果有多个组件满足该类型，则可以由用户自行选择。</p><h3 id=implicit-intent的安全性>implicit intent的安全性</h3><p>使用intent启动service的时候，出于安全性的考虑尽量使用explicit intent
因为如果使用implicit intent，开发者无法得知运行时到底启动了哪个服务，且用户也无法看到启动了哪个服务</p><blockquote><p>=Android 5.0 (API Level 21)的版本，如果为<code>bindService()</code>传入一个implicit intent参数，则会抛出异常
<em>不要为service声明intent filter</em></p></blockquote><p>每个app的AndroidManifest.xml声明了该app的每个组件所能接受的intent
当你的app发起一个intent的时候，Android搜索系统中所有app的manifest，来找到可响应的组件</p><p><em>Q: 对于implicit intent是寻找合适的组件；对于explicit intent是验证目标组件是否能响应发起的intent？</em>
<em>A: 只作用于implicit intent</em></p><p>在manifest的组件tag中使用<code>&lt;intent-filter></code> tag来声明一个所能接受的intent
比如，下面是一个email app中用于编写邮件的activity的声明</p><div class=codeblock-hook><pre tabindex=0><code>&lt;manifest ... &gt;
    ...
    &lt;application ... &gt;
        &lt;activity android:name=&#34;com.example.project.ComposeEmailActivity&#34;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&#34;android.intent.action.SEND&#34; /&gt;
                &lt;data android:type=&#34;*/*&#34; /&gt;
                &lt;category android:name=&#34;android.intent.category.DEFAULT&#34; /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
    &lt;/application&gt;
&lt;/manifest&gt;</code></pre><button>copy</button></div><p>则如果某个别的app向<code>startActivity()</code>传递了<code>ACTION_SEND</code>类型的intent (implicit intent?)，系统就可能会启动该activity</p><h2 id=declaring-app-requirements---声明app需求>Declaring app requirements - 声明app需求</h2><p>Android可以运行在各种各样的设备上，这些设备并没有统一的软硬件规格</p><p>在manifest中声明app的软硬件需求。这种需求大多数是informational only的，Android系统不会理会，但是例如Google Play这样的外部服务会读取这些需求并根据用户软硬件配置做出过滤。</p><div class=codeblock-hook><pre tabindex=0><code>&lt;manifest ... &gt;
    &lt;uses-feature android:name=&#34;android.hardware.camera.any&#34;
                  android:required=&#34;true&#34; /&gt;
    &lt;uses-sdk android:minSdkVersion=&#34;7&#34; android:targetSdkVersion=&#34;19&#34; /&gt;
    ...
&lt;/manifest&gt;</code></pre><button>copy</button></div><p>例如上面的例子中，app要求设备拥有相机，并声明自己使用了Android 2.1 (API Level 7)引入的API
这样，没有相机、或Android 2.1以下的设备就无法从Google Play安装该app</p><p>然而，可以声明该app使用了相机，但是并非required // <code>android:required="false"</code>
此时必须在运行时检查是否有相机，并根据结果决定是否打开/关闭特定的camera feature</p><h1 id=app-resources>App Resources</h1><h1 id=providing-resources>Providing Resources</h1><p><a href=https://developer.android.com/guide/topics/resources/providing-resources.html>https://developer.android.com/guide/topics/resources/providing-resources.html</a></p><p>&ldquo;res/&rdquo; folder用于存放资源</p><h3 id=default-resource-folders>default resource folders</h3><ol><li>animator/</li><li>anim/</li><li>color/</li><li>drawable/</li><li>mipmap/</li><li>layout/</li><li>menu/</li><li>raw/</li><li>values/</li><li>xml/</li><li>font/
<em>12. assets/</em> (?)</li></ol><p><em>Never store resource file directly in &ldquo;res/&rdquo; folder - it will cause a compiler error</em></p><h3 id=providing-alternative-resources>Providing Alternative Resources</h3><p>注意qualifier的命名规则</p><ol><li>多个qualifier用dash分隔</li><li>多个qualifier必须按照网页中表2的顺序出现</li><li>resource subfolders不能嵌套</li><li>qualifier is case-insensitive</li><li>同一个qualifier type只能有一个值
e.g. you cannot have a directory named drawable-rES-rFR/. Instead you need two resource directories, such as drawable-rES/ and drawable-rFR/</li></ol><h3 id=resource-alias>resource alias</h3><p>alias只能指向默认资源目录中的某个资源
比如希望drawable-en/中的icon指向drawable/中的icon.png
两种方式：</p><ol><li>在drawable-en/中创建icon.xml</li><li>考虑到方法1需要为每个alias创建一个xml并不是很方便，可以将alias统一写在values/目录中的xml文件中
e.g. res/drawable-en/values/中创建drawables.xml，xml文件中用多个<code>&lt;drawable></code> tag声明alias</li></ol><p><em>values/中的文件会被统一读取，根据tag进行资源化，多个文件只是根据文件名进行语义区分（比如把字符串统一放在string.xml中）</em></p><h1 id=accessing-resources>Accessing Resources</h1><h3 id=代码中访问资源>代码中访问资源</h3><ol><li><code>[&lt;package_name>.]R.&lt;resource_type>.&lt;resource_name></code>
指定了一个resource ID，该ID可以作为参数传递给很多方法</li><li>You can also retrieve individual resources using methods in Resources, which you can get an instance of with getResources().
方法1只是拿到了资源的ID，如果要获取资源本身，则使用Resources对象
You can get an instance of Resources with Context.getResources().</li></ol><p><em>You should never modify the &ldquo;R.java&rdquo; file by hand - it is generated by the &ldquo;aapt&rdquo; tool when your project is compiled. Any changes are overridden next time you compile.</em></p><h3 id=xml中访问资源>XML中访问资源</h3><p><code>@[&lt;package_name>:]&lt;resource_type>/&lt;resource_name></code></p><ul><li><code>&lt;package_name></code> is the name of the package in which the resource is located (not required when referencing resources from the same package)</li><li><code>&lt;resource_type></code> is the R subclass for the resource type</li><li><code>&lt;resource_name></code> is either the resource filename without the extension or the <code>android:name</code> attribute value in the XML element (for simple values)</li></ul><h1 id=activity-1>Activity</h1><h2 id=intent-filter---again>intent filter - again</h2><div class=codeblock-hook><pre tabindex=0><code>&lt;activity android:name=&#34;.ExampleActivity&#34; android:icon=&#34;@drawable/app_icon&#34;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&#34;android.intent.action.SEND&#34; /&gt;
        &lt;category android:name=&#34;android.intent.category.DEFAULT&#34; /&gt;
        &lt;data android:mimeType=&#34;text/plain&#34; /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;</code></pre><button>copy</button></div><p><em><category>and <data>are optional</em></p><p>Invoke the activity above using implicit intent as follow:</p><div class=codeblock-hook><pre tabindex=0><code>// Create the text message with a string
Intent sendIntent = new Intent();
sendIntent.setAction(Intent.ACTION_SEND);
sendIntent.putExtra(Intent.EXTRA_TEXT, textMessage);
sendIntent.setType(&#34;text/plain&#34;);
// Start the activity
startActivity(sendIntent);</code></pre><button>copy</button></div><p><em>如果希望一个activity不响应任何别的app发起的intent，则不写任何intent filter?</em></p><h2 id=declare-permissions---声明权限>Declare permissions - 声明权限</h2><p>在一个activity调用另一个activity的关系中，calling activity和called activity必须满足权限关系
比如你的app要调用一个叫SocialApp的app中的某个activity（e.g. 分享一个post）：</p><h3 id=called-activity-socialapp>called activity (SocialApp):</h3><div class=codeblock-hook><pre tabindex=0><code>&lt;manifest&gt;
&lt;activity android:name=&#34;....&#34;
   android:permission=”com.google.socialapp.permission.SHARE_POST”

/&gt;</code></pre><button>copy</button></div><h3 id=calling-activity-your-app>calling activity (your app):</h3><div class=codeblock-hook><pre tabindex=0><code>&lt;manifest&gt;
   &lt;uses-permission android:name=&#34;com.google.socialapp.permission.SHARE_POST&#34; /&gt;
&lt;/manifest&gt;</code></pre><button>copy</button></div><p><em>Q: 难道仅仅是字符串相同就能称为所谓的满足权限？</em></p><h1 id=activity-lifecycle-callbacks>Activity Lifecycle callbacks</h1><p>Activity在Lifecycle的不同stage之间进行transition，app可以通过6个核心callbacks来得知这些转变的发生</p><h2 id=oncreate>onCreate()</h2><p>You must implement this callback, which fires when the system first creates the activity.</p><p>TODO:
perform basic application startup logic that should happen only once for the entire life of the activity
e.g.</p><ul><li>bind data to lists</li><li>initialize background threads</li><li>instantiate some class-scope variables</li><li>&mldr;</li></ul><p><code>setContentView()</code> must be called here to define the UI</p><ol><li>pass the layout xml file resource ID, or</li><li>Create <code>View</code>s in code, build a hierarchy by insert <code>View</code>s into ViewGroup. Pass the root ViewGroup to setContentView()</li></ol><h2 id=onstart>onStart()</h2><p>The onStart() call makes the activity visible to the user, as the app prepares for the activity to enter the foreground and become interactive.</p><p>TODO e.g.</p><ul><li>initializes the code that maintains the UI</li><li>might also register a BroadcastReceiver that monitors changes that are reflected in the UI</li></ul><h2 id=onresume>onResume()</h2><p>If the activity returns to the Resumed state from the Paused state, the system once again calls onResume() method. For this reason, you should implement onResume() to initialize components that you release during onPause().</p><p>TODO:</p><ul><li>initialize components that you release during onPause()</li><li>perform any other initializations that must occur each time the activity enters the Resumed state</li></ul><p>e.g.
begin animations and initialize components that the activity only uses when it has user focus.</p><h2 id=onpause>onPause()</h2><p>The system calls this method as the first indication that the user is leaving your activity (though it does not always mean the activity is being destroyed).</p><p>Use the onPause() method to pause operations such animations and music playback that should not continue while the Activity is in the Paused state, and that you expect to resume shortly.</p><p><strong>TODO</strong>: You can use the onPause() method to release system resources, such as broadcast receivers, handles to sensors (like GPS), or any resources that may affect battery life while your activity is paused and the user does not need them.</p><p><strong>NOT TODO</strong>: onPause() execution is very brief, and does not necessarily afford enough time to perform save operations. For this reason, you should not use onPause() to save application or user data, make network calls, or execute database transactions; such work may not complete before the method completes. Instead, you should perform heavy-load shutdown operations during onStop().</p><h2 id=onstop>onStop()</h2><p>Fired when your activity is no longer visible to the user.</p><p>In the onStop() method, the app should release almost all resources that aren&rsquo;t needed while the user is not using it.</p><p><em>e.g. if you registered a BroadcastReceiver in onStart() to listen for changes that might affect your UI, you can unregister the broadcast receiver in onStop(), as the user can no longer see the UI.</em></p><p>When your activity enters the Stopped state, the Activity object is kept resident in memory: It maintains all state and member information, but is not attached to the window manager. When the activity resumes, the activity recalls this information. You don’t need to re-initialize components that were created during any of the callback methods leading up to the Resumed state. The system also keeps track of the current state for each View object in the layout, so if the user entered text into an EditText widget, that content is retained so you don&rsquo;t need to save and restore it.</p><h2 id=activity-memory-ejection>Activity Memory Ejection</h2><p>系统从不单独杀死Activity，而是总是以进程为单位杀死Activities，以及进程中的所有内容。
目的：腾出内存。
系统杀死特定进程的可能性取决于该进程的状态，此处“进程状态”取决于该进程中正在运行的Activity的状态。
<em>Q: 此处的进程状态应该取决于Activities Stack最上层的Activity的状态？还是所有Activities的状态都会评估？</em></p><p>用户同样可以主动通过设置中的Application Manager杀死进程。</p><h2 id=activity进入destroyed的两种不同情况>Activity进入Destroyed的两种不同情况</h2><ol><li>用户按下返回键，或者activity自己调用了finish()。此时从系统的角度来看，该Activity这一概念就用不存在了，因为Activity的行为表示了它不再有用。</li><li>系统出于系统限制，杀死了Activity（而不是正常的app行为）（e.g. 为了腾出内存），此时尽管内存中Activity的实例已经不存在了，但是系统知道它曾经存在过，并仍然为其保存了部分状态，这样用户再次返回到该Activity时，系统会用保存的状态重新创建一个Activity实例。保存下来的being destroyed时的状态称为instance state，具体是一个Bundle对象，是键值对的集合。</li></ol><p><em>isFinishing()可以判断向Destroyed状态的transition是否由app通过finish()主动发起,
尽管这一方法通常用在onPause()中，判断现在进行的到底是临时Pause还是彻底摧毁</em></p><h2 id=button-view的onclick回调的条件>button view的onClick()回调的条件</h2><ol><li>public</li><li>void</li><li>A View as the only parameter (it is the View object that was clicked)</li></ol><h2 id=启动child-activity并获得返回值>启动child activity并获得返回值</h2><p>startActivityForResult(Intent intent, int requestCode);
onActivityResult(int requestCode, int resultCode, Intent data);</p><p><em>requestCode用来在回调中区分同一个Activity发出的不同调用，通常使用主调Activity中设置的static final int来增加可读性</em></p><p>如果child activity失败了，主调activity的回调会收到resultCode = <code>RESULT_CANCELED</code>(0)
成功则收到<code>RESULT_OK</code>(-1)
<em>成功是-1，失败是0 &mldr; weird</em></p><p>被调activity必须返回一个returnCode，此外可以返回一个可选的intent对象来返回额外的数据。
所以setResult()有2个重载：</p><div class=codeblock-hook><pre tabindex=0><code>public final void setResult(int resultCode);
public final void setResult(int resultCode, Intent data);</code></pre><button>copy</button></div><h2 id=主调activity和被调activity的合作>主调activity和被调activity的合作</h2><p>调用关系发生时，主调activity和被调activity都会经历lifecycle transition
假设A调用B，回调发生的顺序是：</p><ol><li>A的onPause()</li><li>B的onCreate(), onStart(), onResume()依次执行</li><li>如果A不再可见，则A的onStop()执行</li></ol><h2 id=onsaveinstancestate>onSaveInstanceState()</h2><p>&ldquo;Activity进入Destroyed的两种不同情况"中提到了activity可能被意外杀死，此时会调用onSaveInstanceState()，给Activity一次机会保存自己的状态。
<em>Activity的正常终结不会调用该方法，因为正常终结的activity代表着该activity实例已没有用了，就算用户又回到该页面，那也应该是一个新的activity instance</em></p><p>在activity进入stop状态之前(after onPause() and before onStop() ?)，系统会调用onSaveInstanceState()，该方法默认只会保存整个view hierarchy的状态（每个View对象），诸如已经键入EditText的文字，ListView滚动条的位置都会默认保存，并不需要开发者编写任何代码。但是仅此而已，如果想要保存更多的状态，诸如Activity的某些field，则需要重载onSaveInstanceState()。
// 重载不要忘记调用超类，否则基本的view hierarchy的状态也不会存储。</p><p><em>这里的关键是理解：系统认为意外杀死的activity是值得恢复的，而主动退出的activity直接扔了就完了。</em></p><h2 id=然而bundle对象并不适合保存过重的信息q-因为仍然在内存中>然而Bundle对象并不适合保存过重的信息（Q: 因为仍然在内存中？）</h2><p>如果需要全面的UI恢复解决方案，需要配合使用persistent local storage, onSaveInstanceState()回调，以及ViewModel类。</p><p>See: <a href=https://developer.android.com/topic/libraries/architecture/saving-states.html>https://developer.android.com/topic/libraries/architecture/saving-states.html</a>
for more info about saving & restoring UI</p><h2 id=explicit-intent>Explicit Intent</h2><p>设定了ComponentName的Intent是Explicit Intent:</p><ol><li>通过Intent的Constructor</li><li>setComponent()</li><li>setClass()</li><li>setClassName()</li></ol></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>