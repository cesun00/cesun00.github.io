<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Introduction to Java 9 Module | Infinity Architect</title>
<link rel=stylesheet href=/main.css><script type=importmap>
  {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.167.1/+esm"
      }
  }
  </script><script type=module src=/theme.mjs></script><style>.tag-android{background-color:hsl(0deg 80% 70%)}.dark .tag-android{background-color:hsl(0deg 80% 20%)}.tag-annotation{background-color:hsl(50deg 80% 70%)}.dark .tag-annotation{background-color:hsl(50deg 80% 20%)}.tag-assembly{background-color:hsl(100deg 80% 70%)}.dark .tag-assembly{background-color:hsl(100deg 80% 20%)}.tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 70%)}.dark .tag-asymmetrical-cryptography{background-color:hsl(150deg 80% 20%)}.tag-awk{background-color:hsl(200deg 80% 70%)}.dark .tag-awk{background-color:hsl(200deg 80% 20%)}.tag-bootloader{background-color:hsl(250deg 80% 70%)}.dark .tag-bootloader{background-color:hsl(250deg 80% 20%)}.tag-bytecode{background-color:hsl(300deg 80% 70%)}.dark .tag-bytecode{background-color:hsl(300deg 80% 20%)}.tag-c{background-color:hsl(350deg 80% 70%)}.dark .tag-c{background-color:hsl(350deg 80% 20%)}.tag-cxx{background-color:hsl(40deg 80% 70%)}.dark .tag-cxx{background-color:hsl(40deg 80% 20%)}.tag-cxx-stl{background-color:hsl(90deg 80% 70%)}.dark .tag-cxx-stl{background-color:hsl(90deg 80% 20%)}.tag-cgroup{background-color:hsl(140deg 80% 70%)}.dark .tag-cgroup{background-color:hsl(140deg 80% 20%)}.tag-cheetsheet{background-color:hsl(190deg 80% 70%)}.dark .tag-cheetsheet{background-color:hsl(190deg 80% 20%)}.tag-clang{background-color:hsl(240deg 80% 70%)}.dark .tag-clang{background-color:hsl(240deg 80% 20%)}.tag-coding-theory{background-color:hsl(290deg 80% 70%)}.dark .tag-coding-theory{background-color:hsl(290deg 80% 20%)}.tag-compression{background-color:hsl(340deg 80% 70%)}.dark .tag-compression{background-color:hsl(340deg 80% 20%)}.tag-concept{background-color:hsl(30deg 80% 70%)}.dark .tag-concept{background-color:hsl(30deg 80% 20%)}.tag-cpu{background-color:hsl(80deg 80% 70%)}.dark .tag-cpu{background-color:hsl(80deg 80% 20%)}.tag-crawler{background-color:hsl(130deg 80% 70%)}.dark .tag-crawler{background-color:hsl(130deg 80% 20%)}.tag-cryptography{background-color:hsl(180deg 80% 70%)}.dark .tag-cryptography{background-color:hsl(180deg 80% 20%)}.tag-css{background-color:hsl(230deg 80% 70%)}.dark .tag-css{background-color:hsl(230deg 80% 20%)}.tag-database{background-color:hsl(280deg 80% 70%)}.dark .tag-database{background-color:hsl(280deg 80% 20%)}.tag-deflate{background-color:hsl(330deg 80% 70%)}.dark .tag-deflate{background-color:hsl(330deg 80% 20%)}.tag-design{background-color:hsl(20deg 80% 70%)}.dark .tag-design{background-color:hsl(20deg 80% 20%)}.tag-dns{background-color:hsl(70deg 80% 70%)}.dark .tag-dns{background-color:hsl(70deg 80% 20%)}.tag-dom{background-color:hsl(120deg 80% 70%)}.dark .tag-dom{background-color:hsl(120deg 80% 20%)}.tag-driver{background-color:hsl(170deg 80% 70%)}.dark .tag-driver{background-color:hsl(170deg 80% 20%)}.tag-elastic{background-color:hsl(220deg 80% 70%)}.dark .tag-elastic{background-color:hsl(220deg 80% 20%)}.tag-elf{background-color:hsl(270deg 80% 70%)}.dark .tag-elf{background-color:hsl(270deg 80% 20%)}.tag-elk{background-color:hsl(320deg 80% 70%)}.dark .tag-elk{background-color:hsl(320deg 80% 20%)}.tag-flex{background-color:hsl(10deg 80% 70%)}.dark .tag-flex{background-color:hsl(10deg 80% 20%)}.tag-gc{background-color:hsl(60deg 80% 70%)}.dark .tag-gc{background-color:hsl(60deg 80% 20%)}.tag-gcc{background-color:hsl(110deg 80% 70%)}.dark .tag-gcc{background-color:hsl(110deg 80% 20%)}.tag-gnu{background-color:hsl(160deg 80% 70%)}.dark .tag-gnu{background-color:hsl(160deg 80% 20%)}.tag-go{background-color:hsl(210deg 80% 70%)}.dark .tag-go{background-color:hsl(210deg 80% 20%)}.tag-gzip{background-color:hsl(260deg 80% 70%)}.dark .tag-gzip{background-color:hsl(260deg 80% 20%)}.tag-hash{background-color:hsl(310deg 80% 70%)}.dark .tag-hash{background-color:hsl(310deg 80% 20%)}.tag-http{background-color:hsl(0deg 80% 70%)}.dark .tag-http{background-color:hsl(0deg 80% 20%)}.tag-huffman{background-color:hsl(50deg 80% 70%)}.dark .tag-huffman{background-color:hsl(50deg 80% 20%)}.tag-java{background-color:hsl(100deg 80% 70%)}.dark .tag-java{background-color:hsl(100deg 80% 20%)}.tag-java-module{background-color:hsl(150deg 80% 70%)}.dark .tag-java-module{background-color:hsl(150deg 80% 20%)}.tag-javascript{background-color:hsl(200deg 80% 70%)}.dark .tag-javascript{background-color:hsl(200deg 80% 20%)}.tag-jdk{background-color:hsl(250deg 80% 70%)}.dark .tag-jdk{background-color:hsl(250deg 80% 20%)}.tag-js{background-color:hsl(300deg 80% 70%)}.dark .tag-js{background-color:hsl(300deg 80% 20%)}.tag-jvm{background-color:hsl(350deg 80% 70%)}.dark .tag-jvm{background-color:hsl(350deg 80% 20%)}.tag-kernel{background-color:hsl(40deg 80% 70%)}.dark .tag-kernel{background-color:hsl(40deg 80% 20%)}.tag-lexer{background-color:hsl(90deg 80% 70%)}.dark .tag-lexer{background-color:hsl(90deg 80% 20%)}.tag-linux{background-color:hsl(140deg 80% 70%)}.dark .tag-linux{background-color:hsl(140deg 80% 20%)}.tag-log4j2{background-color:hsl(190deg 80% 70%)}.dark .tag-log4j2{background-color:hsl(190deg 80% 20%)}.tag-lz77{background-color:hsl(240deg 80% 70%)}.dark .tag-lz77{background-color:hsl(240deg 80% 20%)}.tag-make{background-color:hsl(290deg 80% 70%)}.dark .tag-make{background-color:hsl(290deg 80% 20%)}.tag-makefile{background-color:hsl(340deg 80% 70%)}.dark .tag-makefile{background-color:hsl(340deg 80% 20%)}.tag-maven{background-color:hsl(30deg 80% 70%)}.dark .tag-maven{background-color:hsl(30deg 80% 20%)}.tag-memory{background-color:hsl(80deg 80% 70%)}.dark .tag-memory{background-color:hsl(80deg 80% 20%)}.tag-multithreading{background-color:hsl(130deg 80% 70%)}.dark .tag-multithreading{background-color:hsl(130deg 80% 20%)}.tag-mybatis{background-color:hsl(180deg 80% 70%)}.dark .tag-mybatis{background-color:hsl(180deg 80% 20%)}.tag-mysql{background-color:hsl(230deg 80% 70%)}.dark .tag-mysql{background-color:hsl(230deg 80% 20%)}.tag-nasm{background-color:hsl(280deg 80% 70%)}.dark .tag-nasm{background-color:hsl(280deg 80% 20%)}.tag-node{background-color:hsl(330deg 80% 70%)}.dark .tag-node{background-color:hsl(330deg 80% 20%)}.tag-nodejs{background-color:hsl(20deg 80% 70%)}.dark .tag-nodejs{background-color:hsl(20deg 80% 20%)}.tag-openssl{background-color:hsl(70deg 80% 70%)}.dark .tag-openssl{background-color:hsl(70deg 80% 20%)}.tag-playwright{background-color:hsl(120deg 80% 70%)}.dark .tag-playwright{background-color:hsl(120deg 80% 20%)}.tag-posix{background-color:hsl(170deg 80% 70%)}.dark .tag-posix{background-color:hsl(170deg 80% 20%)}.tag-powershell{background-color:hsl(220deg 80% 70%)}.dark .tag-powershell{background-color:hsl(220deg 80% 20%)}.tag-programming-langauge{background-color:hsl(270deg 80% 70%)}.dark .tag-programming-langauge{background-color:hsl(270deg 80% 20%)}.tag-programming-language{background-color:hsl(320deg 80% 70%)}.dark .tag-programming-language{background-color:hsl(320deg 80% 20%)}.tag-qemu{background-color:hsl(10deg 80% 70%)}.dark .tag-qemu{background-color:hsl(10deg 80% 20%)}.tag-redis{background-color:hsl(60deg 80% 70%)}.dark .tag-redis{background-color:hsl(60deg 80% 20%)}.tag-retrocomputing{background-color:hsl(110deg 80% 70%)}.dark .tag-retrocomputing{background-color:hsl(110deg 80% 20%)}.tag-rfc{background-color:hsl(160deg 80% 70%)}.dark .tag-rfc{background-color:hsl(160deg 80% 20%)}.tag-sdram{background-color:hsl(210deg 80% 70%)}.dark .tag-sdram{background-color:hsl(210deg 80% 20%)}.tag-sed{background-color:hsl(260deg 80% 70%)}.dark .tag-sed{background-color:hsl(260deg 80% 20%)}.tag-slf4j{background-color:hsl(310deg 80% 70%)}.dark .tag-slf4j{background-color:hsl(310deg 80% 20%)}.tag-spring{background-color:hsl(0deg 80% 70%)}.dark .tag-spring{background-color:hsl(0deg 80% 20%)}.tag-spring-boot{background-color:hsl(50deg 80% 70%)}.dark .tag-spring-boot{background-color:hsl(50deg 80% 20%)}.tag-spring-data{background-color:hsl(100deg 80% 70%)}.dark .tag-spring-data{background-color:hsl(100deg 80% 20%)}.tag-spring-ioc{background-color:hsl(150deg 80% 70%)}.dark .tag-spring-ioc{background-color:hsl(150deg 80% 20%)}.tag-sql{background-color:hsl(200deg 80% 70%)}.dark .tag-sql{background-color:hsl(200deg 80% 20%)}.tag-streaming{background-color:hsl(250deg 80% 70%)}.dark .tag-streaming{background-color:hsl(250deg 80% 20%)}.tag-template{background-color:hsl(300deg 80% 70%)}.dark .tag-template{background-color:hsl(300deg 80% 20%)}.tag-testing{background-color:hsl(350deg 80% 70%)}.dark .tag-testing{background-color:hsl(350deg 80% 20%)}.tag-thymeleaf{background-color:hsl(40deg 80% 70%)}.dark .tag-thymeleaf{background-color:hsl(40deg 80% 20%)}.tag-tls{background-color:hsl(90deg 80% 70%)}.dark .tag-tls{background-color:hsl(90deg 80% 20%)}.tag-tomcat{background-color:hsl(140deg 80% 70%)}.dark .tag-tomcat{background-color:hsl(140deg 80% 20%)}.tag-transaction{background-color:hsl(190deg 80% 70%)}.dark .tag-transaction{background-color:hsl(190deg 80% 20%)}.tag-transistor{background-color:hsl(240deg 80% 70%)}.dark .tag-transistor{background-color:hsl(240deg 80% 20%)}.tag-ts{background-color:hsl(290deg 80% 70%)}.dark .tag-ts{background-color:hsl(290deg 80% 20%)}.tag-typescript{background-color:hsl(340deg 80% 70%)}.dark .tag-typescript{background-color:hsl(340deg 80% 20%)}.tag-unix{background-color:hsl(30deg 80% 70%)}.dark .tag-unix{background-color:hsl(30deg 80% 20%)}.tag-web{background-color:hsl(80deg 80% 70%)}.dark .tag-web{background-color:hsl(80deg 80% 20%)}.tag-x86{background-color:hsl(130deg 80% 70%)}.dark .tag-x86{background-color:hsl(130deg 80% 20%)}.tag-x86_64{background-color:hsl(180deg 80% 70%)}.dark .tag-x86_64{background-color:hsl(180deg 80% 20%)}.tag-x86-64{background-color:hsl(230deg 80% 70%)}.dark .tag-x86-64{background-color:hsl(230deg 80% 20%)}.tag-xpath{background-color:hsl(280deg 80% 70%)}.dark .tag-xpath{background-color:hsl(280deg 80% 20%)}.tag-zlib{background-color:hsl(330deg 80% 70%)}.dark .tag-zlib{background-color:hsl(330deg 80% 20%)}</style></head><body><script>localStorage.getItem("dark-theme")&&document.body.classList.add("dark")</script><header><h2 id=banner><a href=/>Infinity Architect</a></h2><div id=top-sections><a href=/android/ class=hoverable>Android </a><a href=/cxx/ class=hoverable>C/C++ </a><a href=/compression/ class=hoverable>Compression </a><a href=/cpu/ class=hoverable>CPU </a><a href=/crypto/ class=hoverable>Cryptography </a><a href=/db/ class=hoverable>Database </a><a href=/ee/ class=hoverable>Electronic Engineering </a><a href=/linux/ class=hoverable>GNU/Linux </a><a href=/go/ class=hoverable>Golang </a><a href=/java/ class=active>Java </a><a href=/microservice/ class=hoverable>Microservice </a><a href=/net/ class=hoverable>Network & Protocol </a><a href=/physics/ class=hoverable>Physics </a><a href=/retro/ class=hoverable>Retro-Computing </a><a href=/toy/ class=hoverable>Toys </a><a href=/windev/ class=hoverable>Window</a></div><div class=theme-switch style="align-self:center;margin:auto 20px"><input type=checkbox id=theme-checkbox>
<label for=theme-checkbox><div></div><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path fill-rule="evenodd" d="M9.528 1.718a.75.75.0 01.162.819A8.97 8.97.0 009 6a9 9 0 009 9 8.97 8.97.0 003.463-.69.75.75.0 01.981.98 10.503 10.503.0 01-9.694 6.46c-5.799.0-10.5-4.701-10.5-10.5.0-4.368 2.667-8.112 6.46-9.694a.75.75.0 01.818.162z" clip-rule="evenodd"/></svg>
</span><span><svg viewBox="0 0 24 24" fill="currentcolor" class="w-6 h-6"><path d="M12 2.25a.75.75.0 01.75.75v2.25a.75.75.0 01-1.5.0V3a.75.75.0 01.75-.75zM7.5 12a4.5 4.5.0 119 0 4.5 4.5.0 01-9 0zM18.894 6.166a.75.75.0 00-1.06-1.06l-1.591 1.59a.75.75.0 101.06 1.061l1.591-1.59zM21.75 12a.75.75.0 01-.75.75h-2.25a.75.75.0 010-1.5H21a.75.75.0 01.75.75zm-3.916 6.894a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 10-1.061 1.06l1.59 1.591zM12 18a.75.75.0 01.75.75V21a.75.75.0 01-1.5.0v-2.25A.75.75.0 0112 18zM7.758 17.303a.75.75.0 00-1.061-1.06l-1.591 1.59a.75.75.0 001.06 1.061l1.591-1.59zM6 12a.75.75.0 01-.75.75H3a.75.75.0 010-1.5h2.25A.75.75.0 016 12zm.697-4.243a.75.75.0 001.06-1.06l-1.59-1.591a.75.75.0 00-1.061 1.06l1.59 1.591z"/></svg></span></label></div></header><main><article class=basic-text><div style=font-family:monospace;font-size:1.5em><div class=basic-text>/<a href=/>HOME</a>/<a href=/java/>Java</a>/<a href=/java/lang/>The Java Language</a>/
$</div></div><div style=margin-bottom:60px><h1 style=margin-bottom:0>Introduction to Java 9 Module</h1><p class=aux-text style=margin-top:0>Published at: December 7, 2023
| Last modification: July 28, 2024</p><div style=line-height:2em><span class="page-tag tag-java">Java</span>
<span class="page-tag tag-java-module">Java module</span></div></div><div><p>Java 9 introduced a modularization system and used it to modularize the JDK itself.
This article aims to provide all the information necessary for a Java developer to work with the module system.</p><p>We will first pretend Java 9 is a new language where modules are the only development paradigm.
After a quick demonstration of the module workflow, we&rsquo;ll discuss how module works in detail, and introducing the mechanics underneath.
Finally, we&rsquo;ll take a step back to the reality and discuss how non-module legacy Java 8 codes are handled by the Java 9 toolchains.</p><h2 id=java-9-as-a-new-module-based-language>Java 9 as a new module-based language</h2><p>The source of the demo in this chapter is available <a href=https://github.com/cesun00/cesunio-java-9-module-demo>here</a>.</p><p>A Java 9 program is organized as classes.
Classes are grouped into packages, and packages are grouped into modules.
A module is one of the following structures:</p><ol><li>a JAR or JMOD file whose root has a <code>module-info.class</code> file. (known as a module artifact)</li><li>a directory with a <code>module-info.class</code> file. (known as an exploded-module directory)</li></ol><h3 id=1-develop-modules>1. Develop modules</h3><p>A module is the minimal unit of development.
We will use the following structure, where 2 modules are developed:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e># tree -I .git -a --gitignore</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>.
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>├── .gitignore
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>├── Makefile
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>├── README.txt
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>└── src
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    ├── com.foo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    │   ├── com
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    │   │   └── foo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    │   │       └── app
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    │   │           └── App.java
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    │   └── module-info.java
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    └── org.bar
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>        ├── module-info.java
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>        └── org
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>            └── bar
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>                └── libfoo
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>                    └── PathFinder.java
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#ae81ff>10</span> directories, <span style=color:#ae81ff>7</span> files</span></span></code></pre></div><button>copy</button></div><p>Conventionally, a module is named in reverse-domain style like packages. The name of the containing directory of a module must be identical to the module name, i.e. the name declared in <code>module-info.java</code>. Thus it&rsquo;s an error to nest modules like <code>src/com/foo/module-info.java</code>. You simply create <code>com.foo/</code> and directories of other modules at the same top level.</p><p>Any type defined in other modules must be visible to your module before you can mention it in your source.
This is done by:</p><ol><li>the external module&rsquo;s <code>module-info.java</code> declares an <code>exports</code> for the package containing that type; and</li><li>your <code>module-info.java</code> declares a <code>requires</code> on that external module.</li></ol><p>In the example above, <code>class App</code> calls a method in <code>PathFinder</code>, so the following config is mandatory:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e>// com.foo/module-info.java</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>module com.<span style=color:#a6e22e>foo</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    requires org.<span style=color:#a6e22e>bar</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#75715e>// org.bar/module-info.java</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>module org.<span style=color:#a6e22e>bar</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span> exports org.<span style=color:#a6e22e>bar</span>.<span style=color:#a6e22e>libfoo</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>}</span></span></code></pre></div><button>copy</button></div><h3 id=2-compile>2. compile</h3><p>A module is the minimal unit of compilation.
Invoke the following to compile your modules:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>javac -d out --module-source-path src -m com.foo,org.bar &lt;options&gt;</span></span></code></pre></div><button>copy</button></div><p>where</p><ul><li><code>-d</code> specifies the output directory,</li><li><code>--module-source-path</code> specifies where to find project source modules, and</li><li><code>-m</code> stipulates which modules to compile.</li></ul><p>It&rsquo;s an undefined behavior if any of these 3 options are missing.</p><h3 id=3-package>3. Package</h3><p>This stage is mandatory for an executable module, but optional for other modules if you will only them as libraries and keep them as an exploded directory.</p><p>An executable module is a module whose <code>module-info.class</code> encodes the main class name, thus can be executed by JVM without specifying a main class over CLI.</p><p>You can always package each module by:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>jar -c -f app.jar --main-class com.foo.app.App -C out/com.foo .
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>jar -c -f lib.jar -C out/org.bar .</span></span></code></pre></div><button>copy</button></div><p>If you decide not to package <code>lib.jar</code>, you can replace its appearance below with <code>out/org.bar</code>.</p><p>If you decide to link your own custom JRE in the next section, you have the option to, instead of packing modules in vanilla JAR format, pack them in the new JMOD format:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>jmod create --class-path out/com.foo --main-class com.foo.app.App app.jmod
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>jmod create --class-path out/org.bar lib.jmod</span></span></code></pre></div><button>copy</button></div><p>By design, the JVM doesn&rsquo;t understand the JMOD format,
JMOD is designed to be a compile-time- and link-time-only storage format, and can&rsquo;t be used at runtime.
You should not use JMOD packages unless you are going to build your own JRE.</p><h3 id=4-optional-link>4. (optional) link</h3><p>The link stage aims to create a custom minimal JRE that is barely large enough to run specific application modules.
This is done by invoking the <code>jlink</code> tool:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>jlink --module-path app.jmod:lib.jmod --add-modules com.foo,org.bar --output myimage</span></span></code></pre></div><button>copy</button></div><p>Once the image is built, the <code>myimage</code> directory can be moved anywhere, and will still work.</p><h3 id=5-run>5. run</h3><p>Running a Java 9 program means running an executable module, which will execute the <code>main()</code> method of the declared <code>ModuleMainClass</code>:</p><ul><li><p>If you omitted the link stage, and are using the stock image of a standard JDK release, you can do this by:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>java -p app.jar:lib.jar -m com.foo</span></span></code></pre></div><button>copy</button></div></li><li><p>If you&rsquo;ve generated your own JDK image, the command can be simplified since our 2 modules are merged into its <code>lib/modules</code>:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>myimage/bin/java -m com.foo</span></span></code></pre></div><button>copy</button></div></li></ul><h2 id=module-in-depth-the-mechanics>Module in Depth: The Mechanics</h2><p>Let&rsquo;s still pretend that non-modular code doesn&rsquo;t exist for now.</p><h3 id=module-descriptor>Module Descriptor</h3><p>In our previous demo, perhaps the most conspicuous file is the <code>module-info.java</code>.</p><p>The whole Java 9 module system rotates around module metadata declared in a special file located at the root of each module. The file must be named <code>module-info.class</code>, and must be compiled from a source file named <code>module-info.java</code> by the <code>javac</code> compiler during the compilation of a whole module. The term <em>module descriptor</em> refers to either the source or compiled binary, depending on the context.</p><p>The module descriptor source (i.e. <code>module-info.java</code>) conforms to <a href=https://docs.oracle.com/javase/specs/jls/se21/html/jls-7.html#jls-ModuleDeclaration>the <code>ModuleDeclaration</code> non-terminal as defined by JLS</a>, where each semicolon-terminated java-statement-alike line is known as <code>ModuleDirectives</code>. This article will use the term &ldquo;directive&rdquo; for such lines.</p><p>The allowed syntaxes of each directive are listed below. Comments should suffice in explaining <code>requires</code>, <code>exports</code> and <code>opens</code>.
See <a href=https://cesun.info/java/lang/spi/>this article</a> for a memo on SPI, and how <code>provides</code> and <code>uses</code> are laced into modern SPI workflow.</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#75715e> * A `open` keyword at the module level `opens` every package in the module.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#f92672>[</span>open<span style=color:#f92672>]</span> module module.<span style=color:#a6e22e>A</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#75715e>     * `requires` and `exports` are counterpart to each other.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#75715e>     * The `requires` directive declares that code in this module will use types from `exports`-ed package of another module.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#75715e>     * The `requires`-ed module must be found at both compile time (by `javac`) and at run time (by JVM).
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#75715e>     * 2 modifiers are allowed before the module name:
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#75715e>     * 1. `static` indicates this is a compile-time-only dependency.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#75715e>     * 2. `transitive`
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    requires module.<span style=color:#a6e22e>B</span>;                      
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    requires <span style=color:#66d9ef>static</span> module.<span style=color:#a6e22e>B</span>;               
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    requires transitive module.<span style=color:#a6e22e>B</span>;           
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    requires <span style=color:#66d9ef>static</span> transitive module.<span style=color:#a6e22e>B</span>;    
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#75715e>     * `requires` and `exports` are counterpart to each other.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#75715e>     * `exports` makes a certain package in this module available to code in
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#75715e>     * 1. every other modules, or
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#75715e>     * 2. only specified modules
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#75715e>     * that `requires` this module.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>    exports package.<span style=color:#a6e22e>X</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>    exports package.<span style=color:#a6e22e>Y</span> to module.<span style=color:#a6e22e>B</span>, module.<span style=color:#a6e22e>C</span>, ...;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#75715e>     * `provides` and `uses` are counterpart to each other in the modern SPI workflow; see below.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#75715e>     * `provides` declares that this module provide an implementation of service.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>    provides qualified.<span style=color:#a6e22e>iface</span>.<span style=color:#a6e22e>name</span> with qualified.<span style=color:#a6e22e>implclass</span>.<span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#75715e>     * `provides` and `uses` are counterpart to each other in the modern SPI workflow; see below.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:#75715e>     * `uses` declares that this module must consume a service in order to work.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>    uses qualified.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>name</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span><span style=color:#75715e>     * `opens` declares that classes in a package in this module can be inspected at runtime by reflection,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#75715e>     * by code in either any module, or only certain modules.
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>    opens package.<span style=color:#a6e22e>X</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>    opens package.<span style=color:#a6e22e>X</span> to module.<span style=color:#a6e22e>B</span>, module.<span style=color:#a6e22e>C</span>, ...;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>    opens module module.<span style=color:#a6e22e>A</span> { ... };
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>}</span></span></code></pre></div><button>copy</button></div><p>These directives are stored in the <code>module-info.class</code> binary classfile as class-level attributes.
See the <code>attribute_info</code> table in <a href=https://cesun.info/java/jvm/classfile/>JVM Classfile Format</a> for details.</p><h3 id=rules-that-governing-module-interactions>Rules that Governing Module Interactions</h3><p>The term <em>module definition</em> refers to either</p><ol><li>a JAR or JMOD archive holding a module; or</li><li>an exploded directory of such a JAR or JMOD</li></ol><p>since the use of either is interchangeable in the Java 9 toolchains.</p><h4 id=module-path--the-universe-of-observable-modules>Module Path & The Universe of Observable Modules</h4><p>The invocation of <code>javac</code>, <code>jlink</code>, and <code>java</code> marks 3 phases in the lifespan of a Java module, namely the compile time, link time, and run time.
For all these tools to work properly, a set of directories, under which modules directory structure can be found, must be given first.
Similar to classpath, the set of directories is given in the form of a string known as the <em>module path</em>.</p><p>A module path is a colon-separated (semicolon-separated on Windows) string where each element is either</p><ol><li>a path to a module definition (i.e. the JAR or exploded directory); or</li><li>a path to a directory that directly contains module definitions; In this case, it&rsquo;s an error to have 2 modules of the same name in the directory.</li></ol><p>For example, for a directory <code>lib/</code> containing <code>foo.jar</code> and <code>bar.jar</code>, the following are equivalent:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>javac --module-source-path lib/foo.jar:lib/bar.jar
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>javac --module-source-path lib/</span></span></code></pre></div><button>copy</button></div><p>Elements in a module path are inspected from left to right when searched for a module by its name,
and the first occurrence will take precedence.</p><p>Some of the tools have more than 1 module path, specified by different CLI options, among which precedence exists.
A module is searched in the following order:</p><ol><li><code>--module-source-path</code>, <strong>must</strong> be a directory whose direct children are module definitions. (i.e. the 2nd definition of module path)</li><li><code>--upgrade-module-path</code>, if given. This module path is used to shadow certain modules over system modules.</li><li><em>system modules</em>, defined as either<ol><li><code>--system &lt;path></code>, if given; otherwise</li><li>the default module image shipped with the JDK release will be used; in all current JDKs I&rsquo;m aware of, it&rsquo;s the <code>lib/modules</code> file.</li></ol></li><li><code>--module-path</code>, if given. This module path is used to reference all compiled library modules.</li></ol><ul><li><code>javac</code> supports all these options</li><li><code>jlink</code> supports only <code>--module-path</code>, and</li><li><code>java</code> supports <code>--upgrade-module-path</code> and <code>--module-path</code>.</li></ul><p>Given an invocation of a specific tool, the phrase <em>the universe of observable modules</em> refers to all visible modules found on the module paths after precedence applies.</p><h4 id=the-compiler-javac>The Compiler <code>javac</code></h4><p>An invocation of the compile follows the patterns:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>javac   --module-source-path ...    <span style=color:#ae81ff>\ </span>      <span style=color:#75715e># mandatory, the *compilation module path*</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>        --upgrade-module-path ...   <span style=color:#ae81ff>\ </span>      <span style=color:#75715e># optional, the *upgrade module path*</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>        --system ...                <span style=color:#ae81ff>\ </span>      <span style=color:#75715e># optional, use alternative system module image</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>        --module-path ...           <span style=color:#ae81ff>\ </span>      <span style=color:#75715e># optional, the *application module path*</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        -m ...</span></span></code></pre></div><button>copy</button></div><p>where the 4 first options specify the <em>compile-time module paths</em>, and <code>-m</code> specifies the module to be compiled.
These module paths define the compile-time universe of observable modules.</p><p>For each module to be compiled, an exhaustive list of its dependencies is first computed, before any class sources are parsed. The module to be compiled is known as the <em>compile-time root module</em>, and its <code>module-info.java</code> is parsed for all <code>requires</code> directives. Note that <a href=https://docs.oracle.com/javase/specs/jls/se21/html/jls-7.html#jls-7.7.1>the <code>java.se</code> module is always <code>requires</code>-ed by default</a>:</p><blockquote><p>If the declaration of a module does not express a dependence on the java.base module, and the module is not itself java.base, then the module has an implicitly declared dependence on the java.base module.</p></blockquote><p>For each <code>requires</code>-ed module name, its module definition must be found in the universe; They are added into the list of dependencies, and their <code>module-info.{java|class}</code> are also read for <code>requires</code> directives. This happens recursively for the dependencies of dependencies, until no new module can be reached and added to the list. This well-known algorithm has a name for computing the <a href=https://en.wikipedia.org/wiki/Transitive_closure><em>transitive closure</em></a>.</p><p>Then <code>javac</code> begins to compile each <code>.java</code> source in the module into class files.
It&rsquo;s a compile-time error if any type mentioned in the sources is from a package that is not <code>exports</code>-ed by any module in the transitive closure.</p><h4 id=the-linker-jlink>The &ldquo;Linker&rdquo; <code>jlink</code></h4><p>Despite its name, <a href=https://openjdk.org/jeps/282>the Java linker</a> <code>jlink</code> is very different from a native OS object file linker. Given a compiled executable module, the only purpose of <code>jlink</code> is to create a standalone minimal JRE directory that contains everything you need to run that module.</p><p>An invocation of <code>jlink</code> takes the following form:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>jlink   --module-path ... <span style=color:#ae81ff>\ </span>        <span style=color:#75715e># mandatory, the only module path</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>        --add-module a,b,c,... <span style=color:#ae81ff>\ </span>   <span style=color:#75715e># mandatory, the root modules</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>        --output dirname            <span style=color:#75715e># mandatory, the output directory</span></span></span></code></pre></div><button>copy</button></div><p>Transitive closure is first computed in the same way as discussed above, where
<code>--add-module</code> specifies the <em>link-time root modules</em>, i.e. starting points of the algorithm.</p><p>The output directory is mostly formed by simply copying files from the JDK release <code>jlink</code> belongs to,
including the <code>java</code> executable and other runtime libraries crucial for JVM. The exception, and the
essential reason one wants to create a customized JRE, is the <code>lib/modules</code> <a href>module image file</a>. Only modules in the computed transitive closure get into the module image,
meaning that there is a good chance unused JDK modules are excluded:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>$ du -h myimage/lib/modules <span style=color:#66d9ef>$(</span>dirname <span style=color:#66d9ef>$(</span>which java<span style=color:#66d9ef>))</span>/../lib/modules
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>29M	    myimage/lib/modules
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>136M	/home/user/.jdks/azul-21.0.1/bin/../lib/modules</span></span></code></pre></div><button>copy</button></div><h4 id=the-jvm-launcher-java--executable-module>The JVM launcher <code>java</code> & Executable Module</h4><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>java    --module-path ... <span style=color:#ae81ff>\ </span>            <span style=color:#75715e># application module path</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>        --upgrade-module-path ... <span style=color:#ae81ff>\ </span>    <span style=color:#75715e># upgrade module path</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>        -m executable.module            <span style=color:#75715e># the executable module to run</span></span></span></code></pre></div><button>copy</button></div><p>Any Java program starts running from a main method whose containing class is known as a main class.
There is a problem fitting this class-grained practice into our module-oriented Java 9+, because we want to keep the
consistency and say &ldquo;Just run a module&rdquo;.</p><p>Java 9+ provides 2 solutions:</p><div class=columns-flex-container><div style=flex:1><p>The first is to break the module encapsulation and specify the main class of the module on the command line.
Though breaking consistency, seems to be more popular these days, since it only requires typing on the CLI:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#75715e># java -m module.name/class.name</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>java -m com.foo/com.foo.app.App</span></span></code></pre></div><button>copy</button></div></div><div style=flex:1><p>The second is to specify the main class of a module somewhere along with the module release;
running a module would then be running that main class.</p><p>But the support for this in the current JDK 21 is somewhat peculiar.
As you may have guessed, <a href=https://docs.oracle.com/javase/specs/jvms/se21/html/jvms-4.html#jvms-4.7.27><code>module-info.class</code> can store the full qualified main class name of the module</a>, and will be respected by JVM when CLI invocation doesn&rsquo;t give a main class:</p><div class=codeblock-hook><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>java -m com.foo</span></span></code></pre></div><button>copy</button></div><p>In the binary classfile of <code>module-info.class</code>, the main class name is given by a <a href=https://cesun.info/java/jvm/classfile/><code>ModuleMainClass</code> attribute</a> which must appear at the class level. A module jar with such an attribute is said to be an executable module, and can be run directly by the <code>java -m</code> syntax.</p><p>The problem is that neither has <code>module-info.java</code> a directive to specify a main class, nor does <code>javac</code> provide an option to specify one at compile time. As of JDK 21, the only way to create such an attribute is to use the <code>jar</code> or <code>jmod</code> tool with the <code>--main-class</code> option, meaning that you must package a jar or jmod file if you want to execute a module from a certain <code>main()</code> method in one of its classes.</p><p>It turned out that this is by design, and there is a discussion on openjdk&rsquo;s maillist about this: <a href=https://mail.openjdk.org/pipermail/jigsaw-dev/2017-February/011464.html>https://mail.openjdk.org/pipermail/jigsaw-dev/2017-February/011464.html</a></p></div></div><h2 id=the-imperfect-world-mixing-modules-and-non-module-source--binary-in-java-9>The Imperfect World: Mixing Modules and Non-Module Source & Binary in Java 9</h2><p>Let&rsquo;s take a step back to the reality, where non-modular practices exist and discuss how they are handled in Java 9.
Non-modular code exists for 2 major reasons:</p><ol><li>legacy Java 8-oriented projects; legacy libraries exist and people must be allowed to use them on Java 9.</li><li>developers are unwilling to write modules in Java 9 (due to team decisions or personal preference).</li></ol><p>Despite that, Java 9 is completely module-oriented: the module system creates a module from every JAR it finds at all of compile time, link time, and run time. To accommodate non-modular JARs into the module system, 2 mechanics are introduced, namely <em>the unnamed module</em> and <em>automatic modules</em>.</p><h3 id=the-unnamed-module>The Unnamed Module</h3><p>If any classes are loaded via the old <code>--classpath</code> manner, they are put into a module known as the <em>unnamed module</em>, so that
they fit into <em>the universe of observable modules</em>, instead of as individual classes.</p><p>Such non-modular code doesn&rsquo;t have a <code>module-info.java</code>.
To cooperate with the module system, some rules apply:</p><ol><li><p>The unnamed module <code>requires</code> every other observable module.</p><p>This allows module-unaware code to use all <code>exports</code>-ed API from modules, including the modular JDK.</p></li><li><p>The unnamed module <code>exports</code> and <code>opens</code> all of its packages.</p><blockquote><p>It does not, however, mean that code in a named module can access types in the unnamed module.
A named module cannot, in fact, even declare a dependence upon the unnamed module.</p></blockquote></li></ol><h3 id=automatic-modules>Automatic Modules</h3><p>If a non-modular jar, exploded or not, is loaded into the universe of observable modules by <code>--module-path</code> or alike,
it becomes a module automatically, known as an automatic module.</p><p>The name of an automatic module is determined by:</p><ol><li>the jar file&rsquo;s <code>Automatic-Module-Name</code> header, if any; or</li><li>deriving from the jar file name on the filesystem</li></ol><p>An automatic module</p><ol><li><code>requires</code> every other observable module, including the unnamed one</li><li><code>exports</code> and <code>opens</code> all of its packages.</li></ol></div></article></main><footer>Unless otherwise noted, content of this site is licensed under
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ style=text-decoration:underline>the CC BY-NC-SA 4.0</a>.<br>cesun.info copyright 2024.</footer></body></html>